<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/resolve/test/resolver_sync.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/resolve/test/resolver_sync.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">64.28</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">731</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">81.60</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">7.00</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var path = require(&#039;path&#039;);
var fs = require(&#039;fs&#039;);
var test = require(&#039;tape&#039;);

var resolve = require(&#039;../&#039;);
var sync = require(&#039;../sync&#039;);

var requireResolveSupportsPaths = require.resolve.length &gt; 1
    &amp;&amp; !(/^v12\.[012]\./).test(process.version); // broken in v12.0-12.2, see https://github.com/nodejs/node/issues/27794

var requireResolveDefaultPathsBroken = (/^v8\.9\.|^v9\.[01]\.0|^v9\.2\./).test(process.version);
// broken in node v8.9.x, v9.0, v9.1, v9.2.x. see https://github.com/nodejs/node/pull/17113

test(&#039;`./sync` entry point&#039;, function (t) {
    t.equal(resolve.sync, sync, &#039;`./sync` entry point is the same as `.sync` on `main`&#039;);
    t.end();
});

test(&#039;foo&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    t.equal(
        resolve.sync(&#039;./foo&#039;, { basedir: dir }),
        path.join(dir, &#039;foo.js&#039;),
        &#039;./foo&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./foo&#039;, { basedir: dir }),
            require.resolve(&#039;./foo&#039;, { paths: [dir] }),
            &#039;./foo: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(&#039;./foo.js&#039;, { basedir: dir }),
        path.join(dir, &#039;foo.js&#039;),
        &#039;./foo.js&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./foo.js&#039;, { basedir: dir }),
            require.resolve(&#039;./foo.js&#039;, { paths: [dir] }),
            &#039;./foo.js: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(&#039;./foo.js&#039;, { basedir: dir, filename: path.join(dir, &#039;bar.js&#039;) }),
        path.join(dir, &#039;foo.js&#039;)
    );

    t.throws(function () {
        resolve.sync(&#039;foo&#039;, { basedir: dir });
    });

    // Test that filename is reported as the &quot;from&quot; value when passed.
    t.throws(
        function () {
            resolve.sync(&#039;foo&#039;, { basedir: dir, filename: path.join(dir, &#039;bar.js&#039;) });
        },
        {
            name: &#039;Error&#039;,
            message: &quot;Cannot find module &#039;foo&#039; from &#039;&quot; + path.join(dir, &#039;bar.js&#039;) + &quot;&#039;&quot;
        }
    );

    t.end();
});

test(&#039;bar&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    var basedir = path.join(dir, &#039;bar&#039;);

    t.equal(
        resolve.sync(&#039;foo&#039;, { basedir: basedir }),
        path.join(dir, &#039;bar/node_modules/foo/index.js&#039;),
        &#039;foo in bar&#039;
    );
    if (!requireResolveDefaultPathsBroken &amp;&amp; requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;foo&#039;, { basedir: basedir }),
            require.resolve(&#039;foo&#039;, { paths: [basedir] }),
            &#039;foo in bar: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;baz&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    t.equal(
        resolve.sync(&#039;./baz&#039;, { basedir: dir }),
        path.join(dir, &#039;baz/quux.js&#039;),
        &#039;./baz&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./baz&#039;, { basedir: dir }),
            require.resolve(&#039;./baz&#039;, { paths: [dir] }),
            &#039;./baz: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;biz&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver/biz/node_modules&#039;);

    t.equal(
        resolve.sync(&#039;./grux&#039;, { basedir: dir }),
        path.join(dir, &#039;grux/index.js&#039;)
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./grux&#039;, { basedir: dir }),
            require.resolve(&#039;./grux&#039;, { paths: [dir] }),
            &#039;./grux: resolve.sync === require.resolve&#039;
        );
    }

    var tivDir = path.join(dir, &#039;grux&#039;);
    t.equal(
        resolve.sync(&#039;tiv&#039;, { basedir: tivDir }),
        path.join(dir, &#039;tiv/index.js&#039;)
    );
    if (!requireResolveDefaultPathsBroken &amp;&amp; requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;tiv&#039;, { basedir: tivDir }),
            require.resolve(&#039;tiv&#039;, { paths: [tivDir] }),
            &#039;tiv: resolve.sync === require.resolve&#039;
        );
    }

    var gruxDir = path.join(dir, &#039;tiv&#039;);
    t.equal(
        resolve.sync(&#039;grux&#039;, { basedir: gruxDir }),
        path.join(dir, &#039;grux/index.js&#039;)
    );
    if (!requireResolveDefaultPathsBroken &amp;&amp; requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;grux&#039;, { basedir: gruxDir }),
            require.resolve(&#039;grux&#039;, { paths: [gruxDir] }),
            &#039;grux: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;normalize&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver/biz/node_modules/grux&#039;);

    t.equal(
        resolve.sync(&#039;../grux&#039;, { basedir: dir }),
        path.join(dir, &#039;index.js&#039;)
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;../grux&#039;, { basedir: dir }),
            require.resolve(&#039;../grux&#039;, { paths: [dir] }),
            &#039;../grux: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;cup&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    t.equal(
        resolve.sync(&#039;./cup&#039;, {
            basedir: dir,
            extensions: [&#039;.js&#039;, &#039;.coffee&#039;]
        }),
        path.join(dir, &#039;cup.coffee&#039;),
        &#039;./cup -&gt; ./cup.coffee&#039;
    );

    t.equal(
        resolve.sync(&#039;./cup.coffee&#039;, { basedir: dir }),
        path.join(dir, &#039;cup.coffee&#039;),
        &#039;./cup.coffee&#039;
    );

    t.throws(function () {
        resolve.sync(&#039;./cup&#039;, {
            basedir: dir,
            extensions: [&#039;.js&#039;]
        });
    });

    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./cup.coffee&#039;, { basedir: dir, extensions: [&#039;.js&#039;, &#039;.coffee&#039;] }),
            require.resolve(&#039;./cup.coffee&#039;, { paths: [dir] }),
            &#039;./cup.coffee: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;mug&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    t.equal(
        resolve.sync(&#039;./mug&#039;, { basedir: dir }),
        path.join(dir, &#039;mug.js&#039;),
        &#039;./mug -&gt; ./mug.js&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./mug&#039;, { basedir: dir }),
            require.resolve(&#039;./mug&#039;, { paths: [dir] }),
            &#039;./mug: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(&#039;./mug&#039;, {
            basedir: dir,
            extensions: [&#039;.coffee&#039;, &#039;.js&#039;]
        }),
        path.join(dir, &#039;mug.coffee&#039;),
        &#039;./mug -&gt; ./mug.coffee&#039;
    );

    t.equal(
        resolve.sync(&#039;./mug&#039;, {
            basedir: dir,
            extensions: [&#039;.js&#039;, &#039;.coffee&#039;]
        }),
        path.join(dir, &#039;mug.js&#039;),
        &#039;./mug -&gt; ./mug.js&#039;
    );

    t.end();
});

test(&#039;other path&#039;, function (t) {
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(resolverDir, &#039;bar&#039;);
    var otherDir = path.join(resolverDir, &#039;other_path&#039;);

    t.equal(
        resolve.sync(&#039;root&#039;, {
            basedir: dir,
            paths: [otherDir]
        }),
        path.join(resolverDir, &#039;other_path/root.js&#039;)
    );

    t.equal(
        resolve.sync(&#039;lib/other-lib&#039;, {
            basedir: dir,
            paths: [otherDir]
        }),
        path.join(resolverDir, &#039;other_path/lib/other-lib.js&#039;)
    );

    t.throws(function () {
        resolve.sync(&#039;root&#039;, { basedir: dir });
    });

    t.throws(function () {
        resolve.sync(&#039;zzz&#039;, {
            basedir: dir,
            paths: [otherDir]
        });
    });

    t.end();
});

test(&#039;path iterator&#039;, function (t) {
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    var exactIterator = function (x, start, getPackageCandidates, opts) {
        return [path.join(resolverDir, x)];
    };

    t.equal(
        resolve.sync(&#039;baz&#039;, { packageIterator: exactIterator }),
        path.join(resolverDir, &#039;baz/quux.js&#039;)
    );

    t.end();
});

test(&#039;incorrect main&#039;, function (t) {
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(resolverDir, &#039;incorrect_main&#039;);

    t.equal(
        resolve.sync(&#039;./incorrect_main&#039;, { basedir: resolverDir }),
        path.join(dir, &#039;index.js&#039;)
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./incorrect_main&#039;, { basedir: resolverDir }),
            require.resolve(&#039;./incorrect_main&#039;, { paths: [resolverDir] }),
            &#039;./incorrect_main: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;missing index&#039;, function (t) {
    t.plan(requireResolveSupportsPaths ? 2 : 1);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    try {
        resolve.sync(&#039;./missing_index&#039;, { basedir: resolverDir });
        t.fail(&#039;did not fail&#039;);
    } catch (err) {
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    }
    if (requireResolveSupportsPaths) {
        try {
            require.resolve(&#039;./missing_index&#039;, { basedir: resolverDir });
            t.fail(&#039;require.resolve did not fail&#039;);
        } catch (err) {
            t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
        }
    }
});

test(&#039;missing main&#039;, function (t) {
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    try {
        resolve.sync(&#039;./missing_main&#039;, { basedir: resolverDir });
        t.fail(&#039;require.resolve did not fail&#039;);
    } catch (err) {
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    }
    if (requireResolveSupportsPaths) {
        try {
            resolve.sync(&#039;./missing_main&#039;, { basedir: resolverDir });
            t.fail(&#039;require.resolve did not fail&#039;);
        } catch (err) {
            t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
        }
    }

    t.end();
});

test(&#039;null main&#039;, function (t) {
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    try {
        resolve.sync(&#039;./null_main&#039;, { basedir: resolverDir });
        t.fail(&#039;require.resolve did not fail&#039;);
    } catch (err) {
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    }
    if (requireResolveSupportsPaths) {
        try {
            resolve.sync(&#039;./null_main&#039;, { basedir: resolverDir });
            t.fail(&#039;require.resolve did not fail&#039;);
        } catch (err) {
            t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
        }
    }

    t.end();
});

test(&#039;main: false&#039;, function (t) {
    var basedir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(basedir, &#039;false_main&#039;);
    t.equal(
        resolve.sync(&#039;./false_main&#039;, { basedir: basedir }),
        path.join(dir, &#039;index.js&#039;),
        &#039;`&quot;main&quot;: false`: resolves to `index.js`&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./false_main&#039;, { basedir: basedir }),
            require.resolve(&#039;./false_main&#039;, { paths: [basedir] }),
            &#039;`&quot;main&quot;: false`: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

var stubStatSync = function stubStatSync(fn) {
    var statSync = fs.statSync;
    try {
        fs.statSync = function () {
            throw new EvalError(&#039;Unknown Error&#039;);
        };
        return fn();
    } finally {
        fs.statSync = statSync;
    }
};

test(&#039;#79 - re-throw non ENOENT errors from stat&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);

    stubStatSync(function () {
        t.throws(function () {
            resolve.sync(&#039;foo&#039;, { basedir: dir });
        }, /Unknown Error/);
    });

    t.end();
});

test(&#039;#52 - incorrectly resolves module-paths like &quot;./someFolder/&quot; when there is a file of the same name&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);
    var basedir = path.join(dir, &#039;same_names&#039;);

    t.equal(
        resolve.sync(&#039;./foo&#039;, { basedir: basedir }),
        path.join(dir, &#039;same_names/foo.js&#039;)
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./foo&#039;, { basedir: basedir }),
            require.resolve(&#039;./foo&#039;, { paths: [basedir] }),
            &#039;./foo: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(&#039;./foo/&#039;, { basedir: basedir }),
        path.join(dir, &#039;same_names/foo/index.js&#039;)
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./foo/&#039;, { basedir: basedir }),
            require.resolve(&#039;./foo/&#039;, { paths: [basedir] }),
            &#039;./foo/: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

test(&#039;#211 - incorrectly resolves module-paths like &quot;.&quot; when from inside a folder with a sibling file of the same name&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);
    var basedir = path.join(dir, &#039;same_names/foo&#039;);

    t.equal(
        resolve.sync(&#039;./&#039;, { basedir: basedir }),
        path.join(dir, &#039;same_names/foo/index.js&#039;),
        &#039;./&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./&#039;, { basedir: basedir }),
            require.resolve(&#039;./&#039;, { paths: [basedir] }),
            &#039;./: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(&#039;.&#039;, { basedir: basedir }),
        path.join(dir, &#039;same_names/foo/index.js&#039;),
        &#039;.&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;.&#039;, { basedir: basedir }),
            require.resolve(&#039;.&#039;, { paths: [basedir] }),
            &#039;.: resolve.sync === require.resolve&#039;,
            { todo: true }
        );
    }

    t.end();
});

test(&#039;sync: #121 - treating an existing file as a dir when no basedir&#039;, function (t) {
    var testFile = path.basename(__filename);

    t.test(&#039;sanity check&#039;, function (st) {
        st.equal(
            resolve.sync(&#039;./&#039; + testFile),
            __filename,
            &#039;sanity check&#039;
        );
        st.equal(
            resolve.sync(&#039;./&#039; + testFile),
            require.resolve(&#039;./&#039; + testFile),
            &#039;sanity check: resolve.sync === require.resolve&#039;
        );

        st.end();
    });

    t.test(&#039;with a fake directory&#039;, function (st) {
        function run() { return resolve.sync(&#039;./&#039; + testFile + &#039;/blah&#039;); }

        st.throws(run, &#039;throws an error&#039;);

        try {
            run();
        } catch (e) {
            st.equal(e.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error code matches require.resolve&#039;);
            st.equal(
                e.message,
                &#039;Cannot find module \&#039;./&#039; + testFile + &#039;/blah\&#039; from \&#039;&#039; + __dirname + &#039;\&#039;&#039;,
                &#039;can not find nonexistent module&#039;
            );
        }

        st.end();
    });

    t.end();
});

test(&#039;sync dot main&#039;, function (t) {
    var start = new Date();

    t.equal(
        resolve.sync(&#039;./resolver/dot_main&#039;),
        path.join(__dirname, &#039;resolver/dot_main/index.js&#039;),
        &#039;./resolver/dot_main&#039;
    );
    t.equal(
        resolve.sync(&#039;./resolver/dot_main&#039;),
        require.resolve(&#039;./resolver/dot_main&#039;),
        &#039;./resolver/dot_main: resolve.sync === require.resolve&#039;
    );

    t.ok(new Date() - start &lt; 50, &#039;resolve.sync timedout&#039;);

    t.end();
});

test(&#039;sync dot slash main&#039;, function (t) {
    var start = new Date();

    t.equal(
        resolve.sync(&#039;./resolver/dot_slash_main&#039;),
        path.join(__dirname, &#039;resolver/dot_slash_main/index.js&#039;)
    );
    t.equal(
        resolve.sync(&#039;./resolver/dot_slash_main&#039;),
        require.resolve(&#039;./resolver/dot_slash_main&#039;),
        &#039;./resolver/dot_slash_main: resolve.sync === require.resolve&#039;
    );

    t.ok(new Date() - start &lt; 50, &#039;resolve.sync timedout&#039;);

    t.end();
});

test(&#039;not a directory&#039;, function (t) {
    var path = &#039;./foo&#039;;
    try {
        resolve.sync(path, { basedir: __filename });
        t.fail();
    } catch (err) {
        t.ok(err, &#039;a non-directory errors&#039;);
        t.equal(err &amp;&amp; err.message, &#039;Cannot find module \&#039;&#039; + path + &quot;&#039; from &#039;&quot; + __filename + &quot;&#039;&quot;);
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;);
    }
    t.end();
});

test(&#039;non-string &quot;main&quot; field in package.json&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);
    try {
        var result = resolve.sync(&#039;./invalid_main&#039;, { basedir: dir });
        t.equal(result, undefined, &#039;result should not exist&#039;);
        t.fail(&#039;should not get here&#039;);
    } catch (err) {
        t.ok(err, &#039;errors on non-string main&#039;);
        t.equal(err.message, &#039;package “invalid_main” `main` must be a string&#039;);
        t.equal(err.code, &#039;INVALID_PACKAGE_MAIN&#039;);
    }
    t.end();
});

test(&#039;non-string &quot;main&quot; field in package.json&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);
    try {
        var result = resolve.sync(&#039;./invalid_main&#039;, { basedir: dir });
        t.equal(result, undefined, &#039;result should not exist&#039;);
        t.fail(&#039;should not get here&#039;);
    } catch (err) {
        t.ok(err, &#039;errors on non-string main&#039;);
        t.equal(err.message, &#039;package “invalid_main” `main` must be a string&#039;);
        t.equal(err.code, &#039;INVALID_PACKAGE_MAIN&#039;);
    }
    t.end();
});

test(&#039;browser field in package.json&#039;, function (t) {
    var dir = path.join(__dirname, &#039;resolver&#039;);
    var res = resolve.sync(&#039;./browser_field&#039;, {
        basedir: dir,
        packageFilter: function packageFilter(pkg) {
            if (pkg.browser) {
                pkg.main = pkg.browser; // eslint-disable-line no-param-reassign
                delete pkg.browser; // eslint-disable-line no-param-reassign
            }
            return pkg;
        }
    });
    t.equal(res, path.join(dir, &#039;browser_field&#039;, &#039;b.js&#039;));
    t.end();
});

test(&#039;absolute paths&#039;, function (t) {
    var extensionless = __filename.slice(0, -path.extname(__filename).length);

    t.equal(
        resolve.sync(__filename),
        __filename,
        &#039;absolute path to this file resolves&#039;
    );
    t.equal(
        resolve.sync(__filename),
        require.resolve(__filename),
        &#039;absolute path to this file: resolve.sync === require.resolve&#039;
    );

    t.equal(
        resolve.sync(extensionless),
        __filename,
        &#039;extensionless absolute path to this file resolves&#039;
    );
    t.equal(
        resolve.sync(__filename),
        require.resolve(__filename),
        &#039;absolute path to this file: resolve.sync === require.resolve&#039;
    );

    t.equal(
        resolve.sync(__filename, { basedir: process.cwd() }),
        __filename,
        &#039;absolute path to this file with a basedir resolves&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(__filename, { basedir: process.cwd() }),
            require.resolve(__filename, { paths: [process.cwd()] }),
            &#039;absolute path to this file + basedir: resolve.sync === require.resolve&#039;
        );
    }

    t.equal(
        resolve.sync(extensionless, { basedir: process.cwd() }),
        __filename,
        &#039;extensionless absolute path to this file with a basedir resolves&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(extensionless, { basedir: process.cwd() }),
            require.resolve(extensionless, { paths: [process.cwd()] }),
            &#039;extensionless absolute path to this file + basedir: resolve.sync === require.resolve&#039;
        );
    }

    t.end();
});

var malformedDir = path.join(__dirname, &#039;resolver/malformed_package_json&#039;);
test(&#039;malformed package.json&#039;, { skip: !fs.existsSync(malformedDir) }, function (t) {
    t.plan(5 + (requireResolveSupportsPaths ? 1 : 0));

    var basedir = malformedDir;
    var expected = path.join(basedir, &#039;index.js&#039;);

    t.equal(
        resolve.sync(&#039;./index.js&#039;, { basedir: basedir }),
        expected,
        &#039;malformed package.json is silently ignored&#039;
    );
    if (requireResolveSupportsPaths) {
        t.equal(
            resolve.sync(&#039;./index.js&#039;, { basedir: basedir }),
            require.resolve(&#039;./index.js&#039;, { paths: [basedir] }),
            &#039;malformed package.json: resolve.sync === require.resolve&#039;
        );
    }

    var res1 = resolve.sync(
        &#039;./index.js&#039;,
        {
            basedir: basedir,
            packageFilter: function (pkg, pkgfile, dir) {
                t.fail(&#039;should not reach here&#039;);
            }
        }
    );

    t.equal(
        res1,
        expected,
        &#039;with packageFilter: malformed package.json is silently ignored&#039;
    );

    var res2 = resolve.sync(
        &#039;./index.js&#039;,
        {
            basedir: basedir,
            readPackageSync: function (readFileSync, pkgfile) {
                t.equal(pkgfile, path.join(basedir, &#039;package.json&#039;), &#039;readPackageSync: `pkgfile` is package.json path&#039;);
                var result = String(readFileSync(pkgfile));
                try {
                    return JSON.parse(result);
                } catch (e) {
                    t.ok(e instanceof SyntaxError, &#039;readPackageSync: malformed package.json parses as a syntax error&#039;);
                }
            }
        }
    );

    t.equal(
        res2,
        expected,
        &#039;with readPackageSync: malformed package.json is silently ignored&#039;
    );
});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
