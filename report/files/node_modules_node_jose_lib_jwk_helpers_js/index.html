<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/node-jose/lib/jwk/helpers.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/node-jose/lib/jwk/helpers.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">62.60</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">386</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">58.75</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.34</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*!
 * jwk/helpers.js - JWK Internal Helper Functions and Constants
 *
 * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.
 */
&quot;use strict&quot;;

var clone = require(&quot;lodash/clone&quot;),
    util = require(&quot;../util&quot;),
    forge = require(&quot;../deps/forge&quot;);

var ALGORITHMS = require(&quot;../algorithms&quot;);

// ### ASN.1 Validators
// Adapted from digitalbazaar/node-forge/js/asn1.js
// PrivateKeyInfo
var privateKeyValidator = {
  name: &quot;PrivateKeyInfo&quot;,
  tagClass: forge.asn1.Class.UNIVERSAL,
  type: forge.asn1.Type.SEQUENCE,
  constructed: true,
  value: [
    {
      // Version (INTEGER)
      name: &quot;PrivateKeyInfo.version&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.INTEGER,
      constructed: false,
      capture: &quot;keyVersion&quot;
    },
    {
      name: &quot;PrivateKeyInfo.privateKeyAlgorithm&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.SEQUENCE,
      constructed: true,
      value: [
        {
          name: &quot;AlgorithmIdentifier.algorithm&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.OID,
          constructed: false,
          capture: &quot;keyOid&quot;
        },
        {
          name: &quot;AlgorithmIdentifier.parameters&quot;,
          captureAsn1: &quot;keyParams&quot;
        }
      ]
    },
    {
      name: &quot;PrivateKeyInfo&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.OCTETSTRING,
      constructed: false,
      capture: &quot;keyValue&quot;
    }
  ]
};
// Adapted from digitalbazaar/node-forge/x509.js
var publicKeyValidator = {
  name: &quot;SubjectPublicKeyInfo&quot;,
  tagClass: forge.asn1.Class.UNIVERSAL,
  type: forge.asn1.Type.SEQUENCE,
  constructed: true,
  value: [
    {
      name: &quot;SubjectPublicKeyInfo.AlgorithmIdentifier&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.SEQUENCE,
      constructed: true,
      value: [
        {
          name: &quot;AlgorithmIdentifier.algorithm&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.OID,
          constructed: false,
          capture: &quot;keyOid&quot;
        },
        {
          name: &quot;AlgorithmIdentifier.parameters&quot;,
          captureAsn1: &quot;keyParams&quot;
        }
      ]
    },
    {
      name: &quot;SubjectPublicKeyInfo.subjectPublicKey&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.BITSTRING,
      constructed: false,
      capture: &quot;keyValue&quot;
    }
  ]
};
// Adapted from digitalbazaar/node-forge/x509.js
var X509CertificateValidator = {
  name: &quot;Certificate&quot;,
  tagClass: forge.asn1.Class.UNIVERSAL,
  type: forge.asn1.Type.SEQUENCE,
  constructed: true,
  value: [
    {
      name: &quot;Certificate.TBSCertificate&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.SEQUENCE,
      constructed: true,
      captureAsn1: &quot;certificate&quot;,
      value: [
        {
          name: &quot;Certificate.TBSCertificate.version&quot;,
          tagClass: forge.asn1.Class.CONTEXT_SPECIFIC,
          type: 0,
          constructed: true,
          optional: true,
          value: [
            {
              name: &quot;Certificate.TBSCertificate.version.integer&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.INTEGER,
              constructed: false,
              capture: &quot;certVersion&quot;
            }
          ]
        },
        {
          name: &quot;Certificate.TBSCertificate.serialNumber&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.INTEGER,
          constructed: false,
          capture: &quot;certSerialNumber&quot;
        },
        {
          name: &quot;Certificate.TBSCertificate.signature&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.SEQUENCE,
          constructed: true,
          value: [
            {
              name: &quot;Certificate.TBSCertificate.signature.algorithm&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.OID,
              constructed: false,
              capture: &quot;certSignatureOid&quot;
            }, {
              name: &quot;Certificate.TBSCertificate.signature.parameters&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              optional: true,
              captureAsn1: &quot;certSignatureParams&quot;
            }
          ]
        },
        {
          name: &quot;Certificate.TBSCertificate.issuer&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.SEQUENCE,
          constructed: true,
          captureAsn1: &quot;certIssuer&quot;
        },
        {
          name: &quot;Certificate.TBSCertificate.validity&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.SEQUENCE,
          constructed: true,
          // Note: UTC and generalized times may both appear so the capture
          // names are based on their detected order, the names used below
          // are only for the common case, which validity time really means
          // &quot;notBefore&quot; and which means &quot;notAfter&quot; will be determined by order
          value: [
            {
              // notBefore (Time) (UTC time case)
              name: &quot;Certificate.TBSCertificate.validity.notBefore (utc)&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.UTCTIME,
              constructed: false,
              optional: true,
              capture: &quot;certValidity1UTCTime&quot;
            },
            {
              // notBefore (Time) (generalized time case)
              name: &quot;Certificate.TBSCertificate.validity.notBefore (generalized)&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.GENERALIZEDTIME,
              constructed: false,
              optional: true,
              capture: &quot;certValidity2GeneralizedTime&quot;
            },
            {
              // notAfter (Time) (only UTC time is supported)
              name: &quot;Certificate.TBSCertificate.validity.notAfter (utc)&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.UTCTIME,
              constructed: false,
              optional: true,
              capture: &quot;certValidity3UTCTime&quot;
            },
            {
              // notAfter (Time) (only UTC time is supported)
              name: &quot;Certificate.TBSCertificate.validity.notAfter (generalized)&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.GENERALIZEDTIME,
              constructed: false,
              optional: true,
              capture: &quot;certValidity4GeneralizedTime&quot;
            }
          ]
        }, {
          // Name (subject) (RDNSequence)
          name: &quot;Certificate.TBSCertificate.subject&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.SEQUENCE,
          constructed: true,
          captureAsn1: &quot;certSubject&quot;
        },
        // SubjectPublicKeyInfo
        publicKeyValidator,
        {
          // issuerUniqueID (optional)
          name: &quot;Certificate.TBSCertificate.issuerUniqueID&quot;,
          tagClass: forge.asn1.Class.CONTEXT_SPECIFIC,
          type: 1,
          constructed: true,
          optional: true,
          value: [
            {
              name: &quot;Certificate.TBSCertificate.issuerUniqueID.id&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.BITSTRING,
              constructed: false,
              capture: &quot;certIssuerUniqueId&quot;
            }
          ]
        },
        {
          // subjectUniqueID (optional)
          name: &quot;Certificate.TBSCertificate.subjectUniqueID&quot;,
          tagClass: forge.asn1.Class.CONTEXT_SPECIFIC,
          type: 2,
          constructed: true,
          optional: true,
          value: [
            {
              name: &quot;Certificate.TBSCertificate.subjectUniqueID.id&quot;,
              tagClass: forge.asn1.Class.UNIVERSAL,
              type: forge.asn1.Type.BITSTRING,
              constructed: false,
              capture: &quot;certSubjectUniqueId&quot;
            }
          ]
        },
        {
          // Extensions (optional)
          name: &quot;Certificate.TBSCertificate.extensions&quot;,
          tagClass: forge.asn1.Class.CONTEXT_SPECIFIC,
          type: 3,
          constructed: true,
          captureAsn1: &quot;certExtensions&quot;,
          optional: true
        }
      ]
    },
    {
      // AlgorithmIdentifier (signature algorithm)
      name: &quot;Certificate.signatureAlgorithm&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.SEQUENCE,
      constructed: true,
      value: [
        {
          // algorithm
          name: &quot;Certificate.signatureAlgorithm.algorithm&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          type: forge.asn1.Type.OID,
          constructed: false,
          capture: &quot;certSignatureOid&quot;
        },
        {
          name: &quot;Certificate.TBSCertificate.signature.parameters&quot;,
          tagClass: forge.asn1.Class.UNIVERSAL,
          optional: true,
          captureAsn1: &quot;certSignatureParams&quot;
        }
      ]
    },
    {
      // SignatureValue
      name: &quot;Certificate.signatureValue&quot;,
      tagClass: forge.asn1.Class.UNIVERSAL,
      type: forge.asn1.Type.BITSTRING,
      constructed: false,
      capture: &quot;certSignature&quot;
    }
  ]
};

var INTERNALS = {
  THUMBPRINT_KEY: &quot;internal\u0000thumbprint&quot;,
  THUMBPRINT_HASH: &quot;SHA-256&quot;
};

module.exports = {
  validators: {
    privateKey: privateKeyValidator,
    publicKey: publicKeyValidator,
    certificate: X509CertificateValidator
  },

  thumbprint: function(cfg, json, hash) {
    if (&quot;function&quot; !== typeof cfg.thumbprint) {
      return Promise.reject(new Error(&quot;thumbprint not supported&quot;));
    }

    hash = (hash || INTERNALS.THUMBPRINT_HASH).toUpperCase();
    var fields = cfg.thumbprint(json);
    var input = Object.keys(fields).
                sort().
                map(function(k) {
      var v = fields[k];
      if (Buffer.isBuffer(v)) {
        v = util.base64url.encode(v);
      }
      return JSON.stringify(k) + &quot;:&quot; + JSON.stringify(v);
    });
    input = &quot;{&quot; + input.join(&quot;,&quot;) + &quot;}&quot;;
    try {
      return ALGORITHMS.digest(hash, Buffer.from(input, &quot;utf8&quot;));
    } catch (err) {
      return Promise.reject(err);
    }
  },
  unpackProps: function(props, allowed) {
    var output;

    // apply all of the existing values
    allowed.forEach(function(cfg) {
      if (!(cfg.name in props)) {
        return;
      }
      output = output || {};
      var value = props[cfg.name];
      switch (cfg.type) {
        case &quot;binary&quot;:
          if (Buffer.isBuffer(value)) {
            props[cfg.name] = util.base64url.encode(value);
          } else {
            value = util.base64url.decode(value);
          }
          break;
        case &quot;string&quot;:
        case &quot;number&quot;:
        case &quot;boolean&quot;:
          break;
        case &quot;array&quot;:
          value = [].concat(value);
          break;
        case &quot;object&quot;:
          value = clone(value);
          break;
        default:
          // TODO: deep clone?
          break;
      }
      output[cfg.name] = value;
    });

    // remove any from json that didn&#039;t apply
    var check = output || {};
    Object.keys(props).
           forEach(function(n) {
              if (n in check) { return; }
              delete props[n];
           });

    return output;
  },
  COMMON_PROPS: [
    {name: &quot;kty&quot;, type: &quot;string&quot;},
    {name: &quot;kid&quot;, type: &quot;string&quot;},
    {name: &quot;use&quot;, type: &quot;string&quot;},
    {name: &quot;alg&quot;, type: &quot;string&quot;},
    {name: &quot;x5c&quot;, type: &quot;array&quot;},
    {name: &quot;x5t&quot;, type: &quot;binary&quot;},
    {name: &quot;x5u&quot;, type: &quot;string&quot;},
    {name: &quot;key_ops&quot;, type: &quot;array&quot;}
  ],
  INTERNALS: INTERNALS
};
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
