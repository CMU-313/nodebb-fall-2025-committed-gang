<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/mocha/lib/reporters/base.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/mocha/lib/reporters/base.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">66.92</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">592</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">64.09</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.29</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;
/**
 * @module Base
 */
/**
 * Module dependencies.
 */

var diff = require(&#039;diff&#039;);
var milliseconds = require(&#039;ms&#039;);
var utils = require(&#039;../utils&#039;);
var supportsColor = require(&#039;supports-color&#039;);
var symbols = require(&#039;log-symbols&#039;);
var constants = require(&#039;../runner&#039;).constants;
var EVENT_TEST_PASS = constants.EVENT_TEST_PASS;
var EVENT_TEST_FAIL = constants.EVENT_TEST_FAIL;

const isBrowser = utils.isBrowser();

function getBrowserWindowSize() {
  if (&#039;innerHeight&#039; in global) {
    return [global.innerHeight, global.innerWidth];
  }
  // In a Web Worker, the DOM Window is not available.
  return [640, 480];
}

/**
 * Expose `Base`.
 */

exports = module.exports = Base;

/**
 * Check if both stdio streams are associated with a tty.
 */

var isatty = isBrowser || (process.stdout.isTTY &amp;&amp; process.stderr.isTTY);

/**
 * Save log references to avoid tests interfering (see GH-3604).
 */
var consoleLog = console.log;

/**
 * Enable coloring by default, except in the browser interface.
 */

exports.useColors =
  !isBrowser &amp;&amp;
  (supportsColor.stdout || process.env.MOCHA_COLORS !== undefined);

/**
 * Inline diffs instead of +/-
 */

exports.inlineDiffs = false;

/**
 * Truncate diffs longer than this value to avoid slow performance
 */
exports.maxDiffSize = 8192;

/**
 * Default color map.
 */

exports.colors = {
  pass: 90,
  fail: 31,
  &#039;bright pass&#039;: 92,
  &#039;bright fail&#039;: 91,
  &#039;bright yellow&#039;: 93,
  pending: 36,
  suite: 0,
  &#039;error title&#039;: 0,
  &#039;error message&#039;: 31,
  &#039;error stack&#039;: 90,
  checkmark: 32,
  fast: 90,
  medium: 33,
  slow: 31,
  green: 32,
  light: 90,
  &#039;diff gutter&#039;: 90,
  &#039;diff added&#039;: 32,
  &#039;diff removed&#039;: 31,
  &#039;diff added inline&#039;: &#039;30;42&#039;,
  &#039;diff removed inline&#039;: &#039;30;41&#039;
};

/**
 * Default symbol map.
 */

exports.symbols = {
  ok: symbols.success,
  err: symbols.error,
  dot: &#039;.&#039;,
  comma: &#039;,&#039;,
  bang: &#039;!&#039;
};

/**
 * Color `str` with the given `type`,
 * allowing colors to be disabled,
 * as well as user-defined color
 * schemes.
 *
 * @private
 * @param {string} type
 * @param {string} str
 * @return {string}
 */
var color = (exports.color = function (type, str) {
  if (!exports.useColors) {
    return String(str);
  }
  return &#039;\u001b[&#039; + exports.colors[type] + &#039;m&#039; + str + &#039;\u001b[0m&#039;;
});

/**
 * Expose term window size, with some defaults for when stderr is not a tty.
 */

exports.window = {
  width: 75
};

if (isatty) {
  if (isBrowser) {
    exports.window.width = getBrowserWindowSize()[1];
  } else {
    exports.window.width = process.stdout.getWindowSize(1)[0];
  }
}

/**
 * Expose some basic cursor interactions that are common among reporters.
 */

exports.cursor = {
  hide: function () {
    isatty &amp;&amp; process.stdout.write(&#039;\u001b[?25l&#039;);
  },

  show: function () {
    isatty &amp;&amp; process.stdout.write(&#039;\u001b[?25h&#039;);
  },

  deleteLine: function () {
    isatty &amp;&amp; process.stdout.write(&#039;\u001b[2K&#039;);
  },

  beginningOfLine: function () {
    isatty &amp;&amp; process.stdout.write(&#039;\u001b[0G&#039;);
  },

  CR: function () {
    if (isatty) {
      exports.cursor.deleteLine();
      exports.cursor.beginningOfLine();
    } else {
      process.stdout.write(&#039;\r&#039;);
    }
  }
};

var showDiff = (exports.showDiff = function (err) {
  return (
    err &amp;&amp;
    err.showDiff !== false &amp;&amp;
    sameType(err.actual, err.expected) &amp;&amp;
    err.expected !== undefined
  );
});

function stringifyDiffObjs(err) {
  if (!utils.isString(err.actual) || !utils.isString(err.expected)) {
    err.actual = utils.stringify(err.actual);
    err.expected = utils.stringify(err.expected);
  }
}

/**
 * Returns a diff between 2 strings with coloured ANSI output.
 *
 * @description
 * The diff will be either inline or unified dependent on the value
 * of `Base.inlineDiff`.
 *
 * @param {string} actual
 * @param {string} expected
 * @return {string} Diff
 */

var generateDiff = (exports.generateDiff = function (actual, expected) {
  try {
    var maxLen = exports.maxDiffSize;
    var skipped = 0;
    if (maxLen &gt; 0) {
      skipped = Math.max(actual.length - maxLen, expected.length - maxLen);
      actual = actual.slice(0, maxLen);
      expected = expected.slice(0, maxLen);
    }
    let result = exports.inlineDiffs
      ? inlineDiff(actual, expected)
      : unifiedDiff(actual, expected);
    if (skipped &gt; 0) {
      result = `${result}\n      [mocha] output truncated to ${maxLen} characters, see &quot;maxDiffSize&quot; reporter-option\n`;
    }
    return result;
  } catch (err) {
    var msg =
      &#039;\n      &#039; +
      color(&#039;diff added&#039;, &#039;+ expected&#039;) +
      &#039; &#039; +
      color(&#039;diff removed&#039;, &#039;- actual:  failed to generate Mocha diff&#039;) +
      &#039;\n&#039;;
    return msg;
  }
});

/**
 * Traverses err.cause and returns all stack traces
 *
 * @private
 * @param {Error} err
 * @param {Set&lt;Error&gt;} [seen]
 * @return {FullErrorStack}
 */
var getFullErrorStack = function (err, seen) {
  if (seen &amp;&amp; seen.has(err)) {
    return { message: &#039;&#039;, msg: &#039;&lt;circular&gt;&#039;, stack: &#039;&#039; };
  }

  var message;

  if (typeof err.inspect === &#039;function&#039;) {
    message = err.inspect() + &#039;&#039;;
  } else if (err.message &amp;&amp; typeof err.message.toString === &#039;function&#039;) {
    message = err.message + &#039;&#039;;
  } else {
    message = &#039;&#039;;
  }

  var msg;
  var stack = err.stack || message;
  var index = message ? stack.indexOf(message) : -1;

  if (index === -1) {
    msg = message;
  } else {
    index += message.length;
    msg = stack.slice(0, index);
    // remove msg from stack
    stack = stack.slice(index + 1);

    if (err.cause) {
      seen = seen || new Set();
      seen.add(err);
      const causeStack = getFullErrorStack(err.cause, seen)
      stack += &#039;\n   Caused by: &#039; + causeStack.msg + (causeStack.stack ? &#039;\n&#039; + causeStack.stack : &#039;&#039;);
    }
  }

  return {
    message,
    msg,
    stack
  };
};

/**
 * Outputs the given `failures` as a list.
 *
 * @public
 * @memberof Mocha.reporters.Base
 * @variation 1
 * @param {Object[]} failures - Each is Test instance with corresponding
 *     Error property
 */
exports.list = function (failures) {
  var multipleErr, multipleTest;
  Base.consoleLog();
  failures.forEach(function (test, i) {
    // format
    var fmt =
      color(&#039;error title&#039;, &#039;  %s) %s:\n&#039;) +
      color(&#039;error message&#039;, &#039;     %s&#039;) +
      color(&#039;error stack&#039;, &#039;\n%s\n&#039;);

    // msg
    var err;
    if (test.err &amp;&amp; test.err.multiple) {
      if (multipleTest !== test) {
        multipleTest = test;
        multipleErr = [test.err].concat(test.err.multiple);
      }
      err = multipleErr.shift();
    } else {
      err = test.err;
    }

    var { message, msg, stack } = getFullErrorStack(err);

    // uncaught
    if (err.uncaught) {
      msg = &#039;Uncaught &#039; + msg;
    }
    // explicitly show diff
    if (!exports.hideDiff &amp;&amp; showDiff(err)) {
      stringifyDiffObjs(err);
      fmt =
        color(&#039;error title&#039;, &#039;  %s) %s:\n%s&#039;) + color(&#039;error stack&#039;, &#039;\n%s\n&#039;);
      var match = message.match(/^([^:]+): expected/);
      msg = &#039;\n      &#039; + color(&#039;error message&#039;, match ? match[1] : msg);

      msg += generateDiff(err.actual, err.expected);
    }

    // indent stack trace
    stack = stack.replace(/^/gm, &#039;  &#039;);

    // indented test title
    var testTitle = &#039;&#039;;
    test.titlePath().forEach(function (str, index) {
      if (index !== 0) {
        testTitle += &#039;\n     &#039;;
      }
      for (var i = 0; i &lt; index; i++) {
        testTitle += &#039;  &#039;;
      }
      testTitle += str;
    });

    Base.consoleLog(fmt, i + 1, testTitle, msg, stack);
  });
};

/**
 * Constructs a new `Base` reporter instance.
 *
 * @description
 * All other reporters generally inherit from this reporter.
 *
 * @public
 * @class
 * @memberof Mocha.reporters
 * @param {Runner} runner - Instance triggers reporter actions.
 * @param {Object} [options] - runner options
 */
function Base(runner, options) {
  var failures = (this.failures = []);

  if (!runner) {
    throw new TypeError(&#039;Missing runner argument&#039;);
  }
  this.options = options || {};
  this.runner = runner;
  this.stats = runner.stats; // assigned so Reporters keep a closer reference

  var maxDiffSizeOpt =
    this.options.reporterOption &amp;&amp; this.options.reporterOption.maxDiffSize;
  if (maxDiffSizeOpt !== undefined &amp;&amp; !isNaN(Number(maxDiffSizeOpt))) {
    exports.maxDiffSize = Number(maxDiffSizeOpt);
  }

  runner.on(EVENT_TEST_PASS, function (test) {
    if (test.duration &gt; test.slow()) {
      test.speed = &#039;slow&#039;;
    } else if (test.duration &gt; test.slow() / 2) {
      test.speed = &#039;medium&#039;;
    } else {
      test.speed = &#039;fast&#039;;
    }
  });

  runner.on(EVENT_TEST_FAIL, function (test, err) {
    if (showDiff(err)) {
      stringifyDiffObjs(err);
    }
    // more than one error per test
    if (test.err &amp;&amp; err instanceof Error) {
      test.err.multiple = (test.err.multiple || []).concat(err);
    } else {
      test.err = err;
    }
    failures.push(test);
  });
}

/**
 * Outputs common epilogue used by many of the bundled reporters.
 *
 * @public
 * @memberof Mocha.reporters
 */
Base.prototype.epilogue = function () {
  var stats = this.stats;
  var fmt;

  Base.consoleLog();

  // passes
  fmt =
    color(&#039;bright pass&#039;, &#039; &#039;) +
    color(&#039;green&#039;, &#039; %d passing&#039;) +
    color(&#039;light&#039;, &#039; (%s)&#039;);

  Base.consoleLog(fmt, stats.passes || 0, milliseconds(stats.duration));

  // pending
  if (stats.pending) {
    fmt = color(&#039;pending&#039;, &#039; &#039;) + color(&#039;pending&#039;, &#039; %d pending&#039;);

    Base.consoleLog(fmt, stats.pending);
  }

  // failures
  if (stats.failures) {
    fmt = color(&#039;fail&#039;, &#039;  %d failing&#039;);

    Base.consoleLog(fmt, stats.failures);

    Base.list(this.failures);
    Base.consoleLog();
  }

  Base.consoleLog();
};

/**
 * Pads the given `str` to `len`.
 *
 * @private
 * @param {string} str
 * @param {string} len
 * @return {string}
 */
function pad(str, len) {
  str = String(str);
  return Array(len - str.length + 1).join(&#039; &#039;) + str;
}

/**
 * Returns inline diff between 2 strings with coloured ANSI output.
 *
 * @private
 * @param {String} actual
 * @param {String} expected
 * @return {string} Diff
 */
function inlineDiff(actual, expected) {
  var msg = errorDiff(actual, expected);

  // linenos
  var lines = msg.split(&#039;\n&#039;);
  if (lines.length &gt; 4) {
    var width = String(lines.length).length;
    msg = lines
      .map(function (str, i) {
        return pad(++i, width) + &#039; |&#039; + &#039; &#039; + str;
      })
      .join(&#039;\n&#039;);
  }

  // legend
  msg =
    &#039;\n&#039; +
    color(&#039;diff removed inline&#039;, &#039;actual&#039;) +
    &#039; &#039; +
    color(&#039;diff added inline&#039;, &#039;expected&#039;) +
    &#039;\n\n&#039; +
    msg +
    &#039;\n&#039;;

  // indent
  msg = msg.replace(/^/gm, &#039;      &#039;);
  return msg;
}

/**
 * Returns unified diff between two strings with coloured ANSI output.
 *
 * @private
 * @param {String} actual
 * @param {String} expected
 * @return {string} The diff.
 */
function unifiedDiff(actual, expected) {
  var indent = &#039;      &#039;;
  function cleanUp(line) {
    if (line[0] === &#039;+&#039;) {
      return indent + colorLines(&#039;diff added&#039;, line);
    }
    if (line[0] === &#039;-&#039;) {
      return indent + colorLines(&#039;diff removed&#039;, line);
    }
    if (line.match(/@@/)) {
      return &#039;--&#039;;
    }
    if (line.match(/\\ No newline/)) {
      return null;
    }
    return indent + line;
  }
  function notBlank(line) {
    return typeof line !== &#039;undefined&#039; &amp;&amp; line !== null;
  }
  var msg = diff.createPatch(&#039;string&#039;, actual, expected);
  var lines = msg.split(&#039;\n&#039;).splice(5);
  return (
    &#039;\n      &#039; +
    colorLines(&#039;diff added&#039;, &#039;+ expected&#039;) +
    &#039; &#039; +
    colorLines(&#039;diff removed&#039;, &#039;- actual&#039;) +
    &#039;\n\n&#039; +
    lines.map(cleanUp).filter(notBlank).join(&#039;\n&#039;)
  );
}

/**
 * Returns character diff for `err`.
 *
 * @private
 * @param {String} actual
 * @param {String} expected
 * @return {string} the diff
 */
function errorDiff(actual, expected) {
  return diff
    .diffWordsWithSpace(actual, expected)
    .map(function (str) {
      if (str.added) {
        return colorLines(&#039;diff added inline&#039;, str.value);
      }
      if (str.removed) {
        return colorLines(&#039;diff removed inline&#039;, str.value);
      }
      return str.value;
    })
    .join(&#039;&#039;);
}

/**
 * Colors lines for `str`, using the color `name`.
 *
 * @private
 * @param {string} name
 * @param {string} str
 * @return {string}
 */
function colorLines(name, str) {
  return str
    .split(&#039;\n&#039;)
    .map(function (str) {
      return color(name, str);
    })
    .join(&#039;\n&#039;);
}

/**
 * Object#toString reference.
 */
var objToString = Object.prototype.toString;

/**
 * Checks that a / b have the same type.
 *
 * @private
 * @param {Object} a
 * @param {Object} b
 * @return {boolean}
 */
function sameType(a, b) {
  return objToString.call(a) === objToString.call(b);
}

Base.consoleLog = consoleLog;

Base.abstract = true;

/**
 * An object with all stack traces recursively mounted from each err.cause
 * @memberof module:lib/reporters/base
 * @typedef {Object} FullErrorStack
 * @property {string} message
 * @property {string} msg
 * @property {string} stack
 */
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
