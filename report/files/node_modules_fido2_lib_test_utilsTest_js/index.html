<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/fido2-lib/test/utilsTest.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/fido2-lib/test/utilsTest.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">81.04</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">595</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">30.05</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">6.02</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&quot;use strict&quot;;

const utils = require(&quot;../lib/utils&quot;);
const {
	checkOrigin,
	checkRpId,
	checkUrl,
	checkDomainOrUrl,
	coerceToBase64,
	coerceToBase64Url,
	coerceToArrayBuffer,
	ab2str,
	str2ab,
	isBase64Url,
	isPem,
	pemToBase64,
	printHex,
	bufEqual,
	jsObjectToB64,
} = utils;
var assert = require(&quot;chai&quot;).assert;
const h = require(&quot;fido2-helpers&quot;);
const {
	abEqual,
} = h.functions;

describe(&quot;utils&quot;, function() {
	it(&quot;is object&quot;, function() {
		assert.isObject(utils);
	});

	describe(&quot;checkOrigin&quot;, function() {
		it(&quot;throws on invalid eTLD+1&quot;, function() {
			assert.throws(() =&gt; {
				checkOrigin(&quot;https://s3.dualstack.eu-west-1.amazonaws.com&quot;);
			}, Error, &quot;origin is not a valid eTLD+1&quot;);
		});

		it(&quot;throws on undefined origin&quot;, function() {
			assert.throws(() =&gt; {
				checkOrigin(undefined);
			}, Error, &quot;Invalid URL&quot;);
		});

		it(&quot;throws invalid url&quot;, function() {
			assert.throws(() =&gt; {
				checkOrigin(&quot;qwertyasdf&quot;);
			}, Error, &quot;Invalid URL&quot;);
		});

		it(&quot;allows localhost&quot;, function() {
			var ret = checkOrigin(&quot;https://localhost:8443&quot;);
			assert.strictEqual(ret, &quot;https://localhost:8443&quot;);
		});

		it(&quot;throws on non-https&quot;, function() {
			assert.throws(() =&gt; {
				checkOrigin(&quot;http://webauthn.bin.coffee:8080&quot;);
			}, Error, &quot;origin should be https&quot;);
		});

		it.skip(&quot;allows international domain&quot;, function() {
			var ret = checkOrigin(&quot;https://www.食狮.公司.cn:8080&quot;);
			assert.isTrue(ret);
		});

		it(&quot;throws error if origin contains URL path&quot;);
		it(&quot;returns true when origin contains port 443&quot;);
		it(&quot;throws when origin is just a domain&quot;);
		it(&quot;rejects invalid eTLD+1 international domain&quot;);
		it(&quot;allows punycoded domain&quot;);
		it(&quot;correctly compares punycoded and international domain&quot;);
	});

	describe(&quot;checkRpId&quot;, function() {
		it(&quot;throws on invalid eTLD+1&quot;, function() {
			assert.throws(() =&gt; {
				checkRpId(&quot;test&quot;);
			}, Error, &quot;rpId is not a valid eTLD+1/url&quot;);
		});

		it(&quot;throws on undefined rpId&quot;, function() {
			assert.throws(() =&gt; {
				checkRpId(undefined);
			}, Error, &quot;rpId must be a string&quot;);
		});

		it(&quot;allows localhost&quot;, function() {
			var ret = checkRpId(&quot;test.localhost&quot;);
			assert.strictEqual(ret, &quot;test.localhost&quot;);
		});

		it(&quot;allows fully qualified urls&quot;, function() {
			var ret = checkRpId(&quot;https://test.com&quot;);
			assert.strictEqual(ret, &quot;https://test.com&quot;);
		});

		it(&quot;rejects http urls&quot;, function() {
			assert.throws(() =&gt; {
				checkRpId(&quot;http://test.com&quot;);
			}, Error, &quot;rpId should be https&quot;);
		});

		it(&quot;rejects urls that have pathes&quot;, function() {
			assert.throws(() =&gt; {
				checkRpId(&quot;https://test.com/foo/bar&quot;);
			}, Error, &quot;rpId should not include path in url&quot;);

			assert.throws(() =&gt; {
				checkRpId(&quot;https://test.com/&quot;);
			}, Error, &quot;rpId should not include path in url&quot;);
		});
	});

	describe(&quot;checkUrl&quot;, () =&gt; {
		it(&quot;exists&quot;, () =&gt; {
			assert.isFunction(checkUrl);
		});

		it(&quot;should throw when name param is not specified&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;https://test.com/&quot;);
			}, Error, &quot;name not specified in checkUrl&quot;);
		});

		it(&quot;should throw when value is not string&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(123, &quot;test&quot;);
			}, Error, &quot;test must be a string&quot;);
		});

		it(&quot;should throw when value is not a valid url&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;test.com&quot;, &quot;test&quot;);
			}, Error, &quot;test is not a valid eTLD+1/url&quot;);
		});

		it(&quot;should throw when url is not http&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;file:///home/myuser/files/test.html&quot;, &quot;test&quot;);
			}, Error, &quot;test must be http protocol&quot;);
		});

		it(&quot;should throw when url is not https&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;http://www.test.com&quot;, &quot;test&quot;);
			}, Error, &quot;test should be https&quot;);
		});

		it(&quot;should throw when url has path&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;https://www.test.com/&quot;, &quot;test&quot;);
			}, Error, &quot;test should not include path in url&quot;);

			assert.throws(() =&gt; {
				checkUrl(&quot;https://www.test.com/foo/bar&quot;, &quot;test&quot;);
			}, Error, &quot;test should not include path in url&quot;);
		});

		it(&quot;should throw when url has hash&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;https://www.test.com#foo&quot;, &quot;test&quot;);
			}, Error, &quot;test should not include hash in url&quot;);
		});

		it(&quot;should throw when url has credentials&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;https://user:pass@www.test.com&quot;, &quot;test&quot;);
			}, Error, &quot;test should not include credentials in url&quot;);
		});

		it(&quot;should throw when url has query string&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkUrl(&quot;https://www.test.com?foo=bar&quot;, &quot;test&quot;);
			}, Error, &quot;test should not include query string in url&quot;);
		});

		it(&quot;should return value when value is valid url&quot;, () =&gt; {
			var ret = checkUrl(&quot;https://www.test.com&quot;, &quot;test&quot;);
			assert.strictEqual(ret, &quot;https://www.test.com&quot;);
		});

		it(&quot;should allow http when specified in rules&quot;, () =&gt; {
			var ret = checkUrl(&quot;http://www.test.com&quot;, &quot;test&quot;, { allowHttp: true });
			assert.strictEqual(ret, &quot;http://www.test.com&quot;);
		});

		it(&quot;should allow path when specified in rules&quot;, () =&gt; {
			var ret = checkUrl(&quot;https://www.test.com/&quot;, &quot;test&quot;, { allowPath: true });
			assert.strictEqual(ret, &quot;https://www.test.com/&quot;);

			ret = checkUrl(&quot;https://www.test.com/foo/bar&quot;, &quot;test&quot;, { allowPath: true });
			assert.strictEqual(ret, &quot;https://www.test.com/foo/bar&quot;);
		});

		it(&quot;should allow hash when specified in rules&quot;, () =&gt; {
			var ret = checkUrl(&quot;https://www.test.com#foo&quot;, &quot;test&quot;, { allowHash: true });
			assert.strictEqual(ret, &quot;https://www.test.com#foo&quot;);
		});

		it(&quot;should allow credentials when specified in rules&quot;, () =&gt; {
			var ret = checkUrl(&quot;https://user:pass@www.test.com&quot;, &quot;test&quot;, { allowCred: true });
			assert.strictEqual(ret, &quot;https://user:pass@www.test.com&quot;);
		});

		it(&quot;should allow query string when specified in rules&quot;, () =&gt; {
			var ret = checkUrl(&quot;https://www.test.com?foo=bar&quot;, &quot;test&quot;, { allowQuery: true });
			assert.strictEqual(ret, &quot;https://www.test.com?foo=bar&quot;);
		});
	});

	describe(&quot;checkDomainOrUrl&quot;, () =&gt; {
		it(&quot;exists&quot;, () =&gt; {
			assert.isFunction(checkDomainOrUrl);
		});

		it(&quot;should throw when name param is not specified&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkDomainOrUrl(&quot;https://test.com/&quot;);
			}, Error, &quot;name not specified in checkDomainOrUrl&quot;);
		});

		it(&quot;should throw when value is not string&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkDomainOrUrl(123, &quot;test&quot;);
			}, Error, &quot;test must be a string&quot;);
		});

		it(&quot;should throw when value is not a valid domain or url&quot;, () =&gt; {
			assert.throws(() =&gt; {
				checkDomainOrUrl(&quot;test&quot;, &quot;test&quot;);
			}, Error, &quot;test is not a valid eTLD+1/url&quot;);
		});

		it(&quot;should return value when value is valid domain&quot;, () =&gt; {
			var ret = checkDomainOrUrl(&quot;test.com&quot;, &quot;test&quot;);
			assert.strictEqual(ret, &quot;test.com&quot;);
		});

		it(&quot;should return value when value is valid url&quot;, () =&gt; {
			var ret = checkDomainOrUrl(&quot;https://www.test.com&quot;, &quot;test&quot;);
			assert.strictEqual(ret, &quot;https://www.test.com&quot;);
		});
	});

	describe(&quot;coerceToBase64Url&quot;, () =&gt; {
		it(&quot;exists&quot;, () =&gt; {
			assert.isFunction(coerceToBase64Url);
		});

		it(&quot;coerce ArrayBuffer to base64url&quot;, () =&gt; {
			var ab = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			var res = coerceToBase64Url(ab, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;);
		});

		it(&quot;coerce Uint8Array to base64url&quot;, () =&gt; {
			var buf = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]);
			var res = coerceToBase64Url(buf, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;);
		});

		it(&quot;coerce Buffer to base64url&quot;, () =&gt; {
			assert.strictEqual(coerceToBase64Url(Buffer.from(&quot;testing!&quot;), &quot;test&quot;), &quot;dGVzdGluZyE&quot;);
		});

		it(&quot;coerce Array to base64url&quot;, () =&gt; {
			var arr = [
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			];
			var res = coerceToBase64Url(arr, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;);
		});

		it(&quot;coerce base64 to base64url&quot;, () =&gt; {
			var b64 = &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;;
			var res = coerceToBase64Url(b64, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;);
		});

		it(&quot;coerce base64url to base64url&quot;, () =&gt; {
			var b64url = &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;;
			var res = coerceToBase64Url(b64url, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;);
		});

		it(&quot;throws on incompatible: number&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToBase64Url(42, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to string&quot;);
		});

		it(&quot;throws on incompatible: undefined&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToBase64Url(undefined, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to string&quot;);
		});

		it(&quot;throws if no name specified&quot;, () =&gt; {
			assert.throws(coerceToBase64Url, Error, &quot;name not specified in coerceToBase64&quot;);
		});
	});

	describe(&quot;coerceToBase64&quot;, () =&gt; {
		it(&quot;exists&quot;, () =&gt; {
			assert.isFunction(coerceToBase64Url);
		});

		it(&quot;coerce ArrayBuffer to base64&quot;, () =&gt; {
			var ab = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			var res = coerceToBase64(ab, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;);
		});

		it(&quot;coerce Uint8Array to base64&quot;, () =&gt; {
			var buf = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]);
			var res = coerceToBase64(buf, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;);
		});

		it(&quot;coerce Buffer to base64&quot;, () =&gt; {
			assert.strictEqual(coerceToBase64(Buffer.from(&quot;testing!&quot;), &quot;test&quot;), Buffer.from(&quot;testing!&quot;).toString(&quot;base64&quot;));
		});

		it(&quot;coerce Array to base64&quot;, () =&gt; {
			var arr = [
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			];
			var res = coerceToBase64(arr, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;);
		});

		it(&quot;coerce base64 to base64&quot;, () =&gt; {
			var b64 = &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;;
			var res = coerceToBase64(b64, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;);
		});

		it.skip(&quot;coerce base64url to base64&quot;, () =&gt; {
			var b64url = &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;;
			var res = coerceToBase64(b64url, &quot;test&quot;);
			assert.isString(res);
			assert.strictEqual(res, &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;);
		});

		it(&quot;throws on incompatible: number&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToBase64(42, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to string&quot;);
		});

		it(&quot;throws on incompatible: undefined&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToBase64(undefined, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to string&quot;);
		});

		it(&quot;throws if no name specified&quot;, () =&gt; {
			assert.throws(coerceToBase64, Error, &quot;name not specified in coerceToBase64&quot;);
		});
	});

	describe(&quot;coerceToArrayBuffer&quot;, () =&gt; {
		it(&quot;exists&quot;, () =&gt; {
			assert.isFunction(coerceToArrayBuffer);
		});

		it(&quot;coerce base64url to ArrayBuffer&quot;, () =&gt; {
			var b64url = &quot;AAECAwQFBgcJCgsMDQ4_-A&quot;;
			var res = coerceToArrayBuffer(b64url, &quot;test&quot;);
			assert.instanceOf(res, ArrayBuffer);
			var expectedAb = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			assert.isTrue(abEqual(res, expectedAb), &quot;got expected ArrayBuffer value&quot;);
		});

		it(&quot;coerce base64 to ArrayBuffer&quot;, () =&gt; {
			var b64 = &quot;AAECAwQFBgcJCgsMDQ4/+A==&quot;;
			var res = coerceToArrayBuffer(b64, &quot;test&quot;);
			assert.instanceOf(res, ArrayBuffer);
			var expectedAb = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			assert.isTrue(abEqual(res, expectedAb), &quot;got expected ArrayBuffer value&quot;);
		});

		it(&quot;coerce Array to ArrayBuffer&quot;, () =&gt; {
			var arr = [
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			];
			var res = coerceToArrayBuffer(arr, &quot;test&quot;);
			assert.instanceOf(res, ArrayBuffer);
			var expectedAb = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			assert.isTrue(abEqual(res, expectedAb), &quot;got expected ArrayBuffer value&quot;);
		});

		it(&quot;coerce Buffer to ArrayBuffer&quot;);

		it(&quot;coerce Uint8Array to ArrayBuffer&quot;, () =&gt; {
			var buf = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]);
			var res = coerceToArrayBuffer(buf, &quot;test&quot;);
			assert.instanceOf(res, ArrayBuffer);
			var expectedAb = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			assert.isTrue(abEqual(res, expectedAb), &quot;got expected ArrayBuffer value&quot;);
		});

		it(&quot;coerce ArrayBuffer to ArrayBuffer&quot;, () =&gt; {
			var ab = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			var res = coerceToArrayBuffer(ab, &quot;test&quot;);
			assert.instanceOf(res, ArrayBuffer);
			var expectedAb = Uint8Array.from([
				0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
				0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x3F, 0xF8,
			]).buffer;
			assert.isTrue(abEqual(res, expectedAb), &quot;got expected ArrayBuffer value&quot;);
		});

		it(&quot;throws on incompatible: number&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToArrayBuffer(42, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to ArrayBuffer&quot;);
		});

		it(&quot;throws on incompatible: undefined&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToArrayBuffer(undefined, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to ArrayBuffer&quot;);
		});

		it(&quot;throws on incompatible: object&quot;, () =&gt; {
			assert.throws(() =&gt; {
				coerceToArrayBuffer({}, &quot;test.number&quot;);
			}, Error, &quot;could not coerce &#039;test.number&#039; to ArrayBuffer&quot;);
		});

		it(&quot;throws if no name specified&quot;, () =&gt; {
			assert.throws(coerceToArrayBuffer, Error, &quot;name not specified in coerceToArrayBuffer&quot;);
		});
	});

	describe(&quot;ab2str&quot;, function() {
		it(&quot;converts ArrayBuffer to string&quot;);
	});

	describe(&quot;str2ab&quot;, function() {
		it(&quot;converts string to ArrayBuffer&quot;, function() {
			var ab = str2ab(&quot;abc123&quot;);

			var expectedAb = new Uint8Array([
				0x61, 0x62, 0x63, 0x31, 0x32, 0x33,
			]).buffer;

			assert.isTrue(abEqual(ab, expectedAb), &quot;expected result from str2ab&quot;);
		});
	});

	describe(&quot;jsObjectToB64&quot;, function() {
		it(&quot;converts Object to base64 string&quot;, function() {
			assert.strictEqual(jsObjectToB64({ test: true }), &quot;eyJ0ZXN0Ijp0cnVlfQ==&quot;);
		});

		it(&quot;removes non UTF-8 characters&quot;, function() {
			assert.strictEqual(jsObjectToB64({ alternativeDescriptions: { &quot;ru-RU&quot;: &quot;FIDO2 Key SDK - Ð¾Ñ\x82 Hideez&quot; } }), jsObjectToB64({ alternativeDescriptions: { &quot;ru-RU&quot;: &quot;FIDO2 Key SDK -  Hideez&quot; } }));
		});
	});

	describe(&quot;bufEqual&quot;, function() {
		it(&quot;compare Buffer with Buffer&quot;, function() {
			var ab = Buffer.from(str2ab(&quot;ciao&quot;));

			var expectedAb = Buffer.from(&quot;ciao&quot;);

			assert.isTrue(bufEqual(ab, expectedAb), &quot;expected result from bufEqual&quot;);
		});

		it(&quot;compare Buffer with ArrayBuffer&quot;, function() {
			var ab = str2ab(&quot;ciao&quot;);

			var expectedAb = Buffer.from(&quot;ciao&quot;);

			assert.isFalse(bufEqual(ab, expectedAb), &quot;expected result from bufEqual&quot;);
		});
	});

	describe(&quot;isPem&quot;, function() {
		it(&quot;detects mdsSigningCert&quot;, function() {
			assert.isTrue(isPem(h.mds.mdsSigningCert), &quot;correctly detects mdsSigningCert&quot;);
		});

		it(&quot;detects mdsRootCrl&quot;, function() {
			assert.isTrue(isPem(h.mds.mdsRootCrl), &quot;correctly detects mdsRootCrl&quot;);
		});

		it(&quot;detects assnPublicKey&quot;, function() {
			assert.isTrue(isPem(h.lib.assnPublicKey), &quot;correctly detects assnPublicKey&quot;);
		});

		it(&quot;returns false on undefined input&quot;, function() {
			assert.isFalse(isPem(), &quot;false on undefined string&quot;);
		});

		it(&quot;returns false on bad string&quot;, function() {
			assert.isFalse(isPem(&quot;foobar&quot;), &quot;false on bad string&quot;);
		});
		it(&quot;returns false on empty string&quot;, function() {
			assert.isFalse(isPem(&quot;&quot;), &quot;false on empty string&quot;);
		});
	});

	describe(&quot;pemToBase64&quot;, function() {
		it(&quot;converts mdsSigningCert&quot;, function() {
			var ret = pemToBase64(h.mds.mdsSigningCert);
			assert.strictEqual(ret, &quot;MIICnTCCAkOgAwIBAgIORvCM1auU6FYVXUebJHcwCgYIKoZIzj0EAwIwUzELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUZJRE8gQWxsaWFuY2UxHTAbBgNVBAsTFE1ldGFkYXRhIFRPQyBTaWduaW5nMQ0wCwYDVQQDEwRDQS0xMB4XDTE1MDgxOTAwMDAwMFoXDTE4MDgxOTAwMDAwMFowZDELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUZJRE8gQWxsaWFuY2UxHTAbBgNVBAsTFE1ldGFkYXRhIFRPQyBTaWduaW5nMR4wHAYDVQQDExVNZXRhZGF0YSBUT0MgU2lnbmVyIDMwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASKX+p3W2j1GV4lQwn7HXNj4lh9e2wAa6J9tBIQhbQTkqMvNZGnHxOn7yTZ3NpYO5ZGVgr/XC66qli7BWA8jgTfo4HpMIHmMA4GA1UdDwEB/wQEAwIGwDAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRckNF+zzxMuLvm+qRjLeJQf0DwyzAfBgNVHSMEGDAWgBRpEV4taWSFnZa41v9czb88dc9MGDA1BgNVHR8ELjAsMCqgKKAmhiRodHRwOi8vbWRzLmZpZG9hbGxpYW5jZS5vcmcvQ0EtMS5jcmwwTwYDVR0gBEgwRjBEBgsrBgEEAYLlHAEDATA1MDMGCCsGAQUFBwIBFidodHRwczovL21kcy5maWRvYWxsaWFuY2Uub3JnL3JlcG9zaXRvcnkwCgYIKoZIzj0EAwIDSAAwRQIhALLbYjBrbhPkwrn3mQjCERIwkMNNT/lfkpNXH+4zjUXEAiBas2lP6jp44Bh4X+tBXqY7y61ijGRIZCaAF1KIlgub0g==&quot;);
		});

		it(&quot;converts mdsRootCrl&quot;, function() {
			var ret = pemToBase64(h.mds.mdsRootCrl);
			assert.strictEqual(ret, &quot;MIIBLTCBswIBATAKBggqhkjOPQQDAzBTMQswCQYDVQQGEwJVUzEWMBQGA1UEChMNRklETyBBbGxpYW5jZTEdMBsGA1UECxMUTWV0YWRhdGEgVE9DIFNpZ25pbmcxDTALBgNVBAMTBFJvb3QXDTE4MDQwNzAwMDAwMFoXDTE4MDcxNTAwMDAwMFqgLzAtMAoGA1UdFAQDAgEMMB8GA1UdIwQYMBaAFNKlHwun9mLIQNTYvbnXjtFUu7xGMAoGCCqGSM49BAMDA2kAMGYCMQCnXSfNppE9vpsGtY9DsPWyR3aVVSPs6i5/3A21a1+rCNoa1cJNWKZJ7IV4cdjIXVUCMQCDh8U8OekdTnuvcG3FaoMJO0y0C0FS5dbTzcuiADjyVbAQeaSsCauVySzyB3lVVgE=&quot;);
		});

		it(&quot;converts assnPublicKey&quot;, function() {
			var ret = pemToBase64(h.lib.assnPublicKey);
			assert.strictEqual(ret, &quot;MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAERez9aO2wBAWO54MuGbEqSdWahSnGMAg35BCNkaE3j8Q+O/ZhhKqTeIKm7El70EG6ejt4sg1ZaoQ5ELg8k3ywTg==&quot;);
		});

		it(&quot;throws on empty string&quot;, function() {
			assert.throws(function() {
				pemToBase64(&quot;&quot;);
			});
		}, Error, &quot;expected PEM string as input&quot;);

		it(&quot;throws on non-PEM string&quot;, function() {
			assert.throws(function() {
				pemToBase64(&quot;&quot;);
			});
		}, Error, &quot;expected PEM string as input&quot;);

		it(&quot;throws on undefined&quot;, function() {
			assert.throws(function() {
				pemToBase64();
			});
		}, Error, &quot;expected PEM string as input&quot;);
	});

	describe(&quot;isBase64Url&quot;, function() {
		it(&quot;returns true for base64url string&quot;, () =&gt; {
			assert.isTrue(isBase64Url(&quot;dGVzdGluZyE&quot;), &quot;true on base64url string&quot;);
		});

		it(&quot;returns false for base64 string&quot;);
		it(&quot;returns false for arbitrary string&quot;);
		it(&quot;returns false for undefined&quot;);
		it(&quot;returns false for non-string&quot;);
	});
});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
