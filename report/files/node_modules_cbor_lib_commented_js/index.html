<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/cbor/lib/commented.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/cbor/lib/commented.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">59.02</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">346</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">62.58</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.88</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;

const stream = require(&#039;stream&#039;)
const util = require(&#039;util&#039;)
const utils = require(&#039;./utils&#039;)
const Simple = require(&#039;./simple&#039;)
const Decoder = require(&#039;./decoder&#039;)
const constants = require(&#039;./constants&#039;)
const bignumber = require(&#039;bignumber.js&#039;).BigNumber
const NoFilter = require(&#039;nofilter&#039;)

const MT = constants.MT
const NUMBYTES = constants.NUMBYTES
const SYMS = constants.SYMS

function plural(c) {
  if (c &gt; 1) {
    return &#039;s&#039;
  } else {
    return &#039;&#039;
  }
}

/**
 * Generate the expanded format of RFC 7049, section 2.2.1
 *
 * @extends {stream.Transform}
 */
class Commented extends stream.Transform {
  /**
   * Create a CBOR commenter.
   *
   * @param {object} [options={}] - Stream options
   * @param {number} [options.max_depth=10] - how many times to indent
   *   the dashes
   */
  constructor(options) {
    const opts = Object.assign({
      max_depth: 10
    }, options, {
      readableObjectMode: false,
      writableObjectMode: false
    })
    const max_depth = opts.max_depth
    delete opts.max_depth
    super(opts)

    this.depth = 1
    this.max_depth = max_depth
    this.all = new NoFilter()
    this.parser = new Decoder(opts)
    this.parser.on(&#039;value&#039;, this._on_value.bind(this))
    this.parser.on(&#039;start&#039;, this._on_start.bind(this))
    this.parser.on(&#039;start-string&#039;, this._on_start_string.bind(this))
    this.parser.on(&#039;stop&#039;, this._on_stop.bind(this))
    this.parser.on(&#039;more-bytes&#039;, this._on_more.bind(this))
    this.parser.on(&#039;error&#039;, this._on_error.bind(this))
    this.parser.on(&#039;data&#039;, this._on_data.bind(this))
    this.parser.bs.on(&#039;read&#039;, this._on_read.bind(this))
  }

  /**
   * @private
   */
  _transform(fresh, encoding, cb) {
    this.parser.write(fresh, encoding, cb)
  }

  /**
   * @private
   */
  _flush(cb) {
    // TODO: find the test that covers this, and look at the return value
    return this.parser._flush(cb)
  }

  /**
   * @callback commentCallback
   * @param {Error} [error] - if one was generated
   * @param {string} [commented] - the comment string
   */

  /**
   * @typedef CommentOptions
   * @property {number} [max_depth=10] how many times to indent the dashes
   * @property {string} [encoding=&#039;hex&#039;] encoding of the input
   */
  /**
   * Comment on an input Buffer or string, creating a string passed to the
   * callback.  If callback not specified, a promise is returned.
   *
   * @static
   * @param {string|Buffer} input
   * @param {CommentOptions|commentCallback|string} [options] or callback
   * @param {commentCallback=} cb
   * @returns {Promise} if cb not specified
   */
  static comment(input, options, cb) {
    if (input == null) {
      throw new Error(&#039;input required&#039;)
    }
    let encoding = (typeof input === &#039;string&#039;) ? &#039;hex&#039; : void 0
    let max_depth = 10
    switch (typeof options) {
      case &#039;function&#039;:
        cb = options
        break
      case &#039;string&#039;:
        encoding = options
        break
      case &#039;number&#039;:
        max_depth = options
        break
      case &#039;object&#039;:
        const ref1 = options.encoding
        const ref2 = options.max_depth
        encoding = (ref1 != null) ? ref1 : encoding
        max_depth = (ref2 != null) ? ref2 : max_depth
        break
      case &#039;undefined&#039;:
        break
      default:
        throw new Error(&#039;Unknown option type&#039;)
    }
    const bs = new NoFilter()
    const d = new Commented({
      max_depth
    })
    let p = null
    if (typeof cb === &#039;function&#039;) {
      d.on(&#039;end&#039;, () =&gt; {
        cb(null, bs.toString(&#039;utf8&#039;))
      })
      d.on(&#039;error&#039;, cb)
    } else {
      p = new Promise((resolve, reject) =&gt; {
        d.on(&#039;end&#039;, () =&gt; {
          resolve(bs.toString(&#039;utf8&#039;))
        })
        return d.on(&#039;error&#039;, reject)
      })
    }
    d.pipe(bs)
    d.end(input, encoding)
    return p
  }

  /**
   * @private
   */
  _on_error(er) {
    return this.push(&#039;ERROR: &#039;) &amp;&amp;
      this.push(er.toString()) &amp;&amp;
      this.push(&#039;\n&#039;)
  }

  /**
   * @private
   */
  _on_read(buf) {
    this.all.write(buf)
    const hex = buf.toString(&#039;hex&#039;)
    this.push(new Array(this.depth + 1).join(&#039;  &#039;))
    this.push(hex)
    let ind = (this.max_depth - this.depth) * 2
    ind -= hex.length
    if (ind &lt; 1) {
      ind = 1
    }
    this.push(new Array(ind + 1).join(&#039; &#039;))
    return this.push(&#039;-- &#039;)
  }

  /**
   * @private
   */
  _on_more(mt, len, parent_mt, pos) {
    this.depth++
    let desc = &#039;&#039;
    switch (mt) {
      case MT.POS_INT:
        desc = &#039;Positive number,&#039;
        break
      case MT.NEG_INT:
        desc = &#039;Negative number,&#039;
        break
      case MT.ARRAY:
        desc = &#039;Array, length&#039;
        break
      case MT.MAP:
        desc = &#039;Map, count&#039;
        break
      case MT.BYTE_STRING:
        desc = &#039;Bytes, length&#039;
        break
      case MT.UTF8_STRING:
        desc = &#039;String, length&#039;
        break
      case MT.SIMPLE_FLOAT:
        if (len === 1) {
          desc = &#039;Simple value,&#039;
        } else {
          desc = &#039;Float,&#039;
        }
        break
    }
    return this.push(desc + &#039; next &#039; + len + &#039; byte&#039; + (plural(len)) + &#039;\n&#039;)
  }

  /**
   * @private
   */
  _on_start_string(mt, tag, parent_mt, pos) {
    this.depth++
    let desc = &#039;&#039;
    switch (mt) {
      case MT.BYTE_STRING:
        desc = &#039;Bytes, length: &#039; + tag
        break
      case MT.UTF8_STRING:
        desc = &#039;String, length: &#039; + (tag.toString())
        break
    }
    return this.push(desc + &#039;\n&#039;)
  }

  /**
   * @private
   */
  _on_start(mt, tag, parent_mt, pos) {
    this.depth++
    if (tag !== SYMS.BREAK) {
      switch (parent_mt) {
        case MT.ARRAY:
          this.push(`[${pos}], `)
          break
        case MT.MAP:
          if (pos % 2) {
            this.push(`{Val:${Math.floor(pos / 2)}}, `)
          } else {
            this.push(`{Key:${Math.floor(pos / 2)}}, `)
          }
          break
      }
    }
    switch (mt) {
      case MT.TAG:
        this.push(`Tag #${tag}`)
        break
      case MT.ARRAY:
        if (tag === SYMS.STREAM) {
          this.push(&#039;Array (streaming)&#039;)
        } else {
          this.push(`Array, ${tag} item${plural(tag)}`)
        }
        break
      case MT.MAP:
        if (tag === SYMS.STREAM) {
          this.push(&#039;Map (streaming)&#039;)
        } else {
          this.push(`Map, ${tag} pair${plural(tag)}`)
        }
        break
      case MT.BYTE_STRING:
        this.push(&#039;Bytes (streaming)&#039;)
        break
      case MT.UTF8_STRING:
        this.push(&#039;String (streaming)&#039;)
        break
    }
    return this.push(&#039;\n&#039;)
  }

  /**
   * @private
   */
  _on_stop(mt) {
    return this.depth--
  }

  /**
   * @private
   */
  _on_value(val, parent_mt, pos, ai) {
    if (val !== SYMS.BREAK) {
      switch (parent_mt) {
        case MT.ARRAY:
          this.push(`[${pos}], `)
          break
        case MT.MAP:
          if (pos % 2) {
            this.push(`{Val:${Math.floor(pos / 2)}}, `)
          } else {
            this.push(`{Key:${Math.floor(pos / 2)}}, `)
          }
          break
      }
    }

    if (val === SYMS.BREAK) {
      this.push(&#039;BREAK\n&#039;)
    } else if (val === SYMS.NULL) {
      this.push(&#039;null\n&#039;)
    } else if (val === SYMS.UNDEFINED) {
      this.push(&#039;undefined\n&#039;)
    } else if (typeof val === &#039;string&#039;) {
      this.depth--
      if (val.length &gt; 0 ) {
        this.push(JSON.stringify(val))
        this.push(&#039;\n&#039;)
      }
    } else if (Buffer.isBuffer(val)) {
      this.depth--
      if (val.length &gt; 0) {
        this.push(val.toString(&#039;hex&#039;))
        this.push(&#039;\n&#039;)
      }
    } else if (val instanceof bignumber) {
      this.push(val.toString())
      this.push(&#039;\n&#039;)
    } else {
      this.push(util.inspect(val))
      this.push(&#039;\n&#039;)
    }

    switch (ai) {
      case NUMBYTES.ONE:
      case NUMBYTES.TWO:
      case NUMBYTES.FOUR:
      case NUMBYTES.EIGHT:
        this.depth--
    }
  }

  /**
   * @private
   */
  _on_data() {
    this.push(&#039;0x&#039;)
    this.push(this.all.read().toString(&#039;hex&#039;))
    return this.push(&#039;\n&#039;)
  }
}

module.exports = Commented
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
