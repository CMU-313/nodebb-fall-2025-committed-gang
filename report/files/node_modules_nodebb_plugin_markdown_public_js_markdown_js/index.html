<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/nodebb-plugin-markdown/public/js/markdown.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/nodebb-plugin-markdown/public/js/markdown.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">68.27</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">344</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">58.24</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.16</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

export function capturePaste(targetEl) {
	targetEl.on(&#039;paste&#039;, function (e) {
		var triggers = [/^&gt;\s*/, /^\s*\*\s+/, /^\s*\d+\.\s+/, /^\s{4,}/];
		var start = e.target.selectionStart;
		var line = getLine(targetEl.val(), start);

		var trigger = triggers.reduce(function (regexp, cur) {
			if (regexp) {
				return regexp;
			}

			return cur.test(line) ? cur : false;
		}, false);

		var prefix = line.match(trigger);
		if (prefix) {
			prefix = prefix.shift();

			var payload = e.originalEvent.clipboardData.getData(&#039;text&#039;);
			var fixed = payload.replace(/^/gm, prefix).slice(prefix.length);

			setTimeout(function () {
				var replacement = targetEl.val().slice(0, start) + fixed + targetEl.val().slice(start + payload.length);
				targetEl.val(replacement);
			}, 0);
		}
	});

	function getLine(text, selectionStart) {
		// Break apart into lines, return the line the cursor is in
		var lines = text.split(&#039;\n&#039;);

		return lines.reduce(function (memo, cur) {
			if (typeof memo !== &#039;number&#039;) {
				return memo;
			} if (selectionStart &gt; (memo + cur.length)) {
				return memo + cur.length + 1;
			}

			return cur;
		}, 0);
	}
};

export function prepareFormattingTools() {
	require([
		&#039;composer/formatting&#039;,
		&#039;composer/controls&#039;,
		&#039;translator&#039;,
	], function (formatting, controls, translator) {
		if (formatting &amp;&amp; controls) {
			translator.getTranslations(window.config.userLang || window.config.defaultLang, &#039;markdown&#039;, function (strings) {
				// used for h1,h2...h6
				function formatHeading(heading, textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						controls.insertIntoTextarea(textarea, `${heading} ${strings.heading}`);

						controls.updateTextareaSelection(
							textarea,
							selectionStart + heading.length + 1,
							selectionStart + strings.heading.length + heading.length + 1
						);
					} else {
						const selectedText = $(textarea).val().substring(selectionStart, selectionEnd);
						const newText = `${heading} ${selectedText}`;
						controls.replaceSelectionInTextareaWith(textarea, newText);
						controls.updateTextareaSelection(
							textarea,
							selectionStart + (heading.length + 1),
							selectionEnd + (newText.length - selectedText.length)
						);
					}
				}


				formatting.addButtonDispatch(&#039;bold&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						var block = controls.getBlockData(textarea, &#039;**&#039;, selectionStart);

						if (block.in &amp;&amp; block.atEnd) {
							// At end of bolded string, move cursor past delimiters
							controls.updateTextareaSelection(textarea, selectionStart + 2, selectionStart + 2);
						} else {
							controls.insertIntoTextarea(textarea, &#039;**&#039; + strings.bold + &#039;**&#039;);
							controls.updateTextareaSelection(
								textarea, selectionStart + 2, selectionStart + strings.bold.length + 2
							);
						}
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;**&#039;);
						controls.updateTextareaSelection(
							textarea, selectionStart + 2 + wrapDelta[0], selectionEnd + 2 - wrapDelta[1]
						);
					}
				});

				formatting.addButtonDispatch(&#039;italic&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						var block = controls.getBlockData(textarea, &#039;*&#039;, selectionStart);

						if (block.in &amp;&amp; block.atEnd) {
							// At end of italicised string, move cursor past delimiters
							controls.updateTextareaSelection(textarea, selectionStart + 1, selectionStart + 1);
						} else {
							controls.insertIntoTextarea(textarea, &#039;*&#039; + strings.italic + &#039;*&#039;);
							controls.updateTextareaSelection(
								textarea, selectionStart + 1, selectionStart + strings.italic.length + 1
							);
						}
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;*&#039;);
						controls.updateTextareaSelection(
							textarea, selectionStart + 1 + wrapDelta[0], selectionEnd + 1 - wrapDelta[1]
						);
					}
				});

				[1, 2, 3, 4, 5, 6].forEach((size) =&gt; {
					formatting.addButtonDispatch(`heading${size}`, function (textarea, selectionStart, selectionEnd) {
						formatHeading(new Array(size).fill(&#039;#&#039;).join(&#039;&#039;), textarea, selectionStart, selectionEnd);
					});
				});

				formatting.addButtonDispatch(&#039;list&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						controls.insertIntoTextarea(textarea, &#039;\n* &#039; + strings[&#039;list-item&#039;]);

						// Highlight &quot;list item&quot;
						controls.updateTextareaSelection(
							textarea, selectionStart + 3, selectionStart + strings[&#039;list-item&#039;].length + 3
						);
					} else {
						const selectedText = $(textarea).val().substring(selectionStart, selectionEnd);
						const newText = &#039;* &#039; + selectedText.split(&#039;\n&#039;).join(&#039;\n* &#039;);
						controls.replaceSelectionInTextareaWith(textarea, newText);
						controls.updateTextareaSelection(
							textarea, selectionStart + 2, selectionEnd + (newText.length - selectedText.length)
						);
					}
				});

				formatting.addButtonDispatch(&#039;strikethrough&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						var block = controls.getBlockData(textarea, &#039;~~&#039;, selectionStart);

						if (block.in &amp;&amp; block.atEnd) {
							// At end of bolded string, move cursor past delimiters
							controls.updateTextareaSelection(textarea, selectionStart + 2, selectionStart + 2);
						} else {
							controls.insertIntoTextarea(textarea, &#039;~~&#039; + strings[&#039;strikethrough-text&#039;] + &#039;~~&#039;);
							controls.updateTextareaSelection(
								textarea, selectionStart + 2, selectionEnd + strings[&#039;strikethrough-text&#039;].length + 2
							);
						}
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;~~&#039;, &#039;~~&#039;);
						controls.updateTextareaSelection(
							textarea, selectionStart + 2 + wrapDelta[0], selectionEnd + 2 - wrapDelta[1]
						);
					}
				});

				formatting.addButtonDispatch(&#039;code&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						controls.insertIntoTextarea(textarea, &#039;```\n&#039; + strings[&#039;code-text&#039;] + &#039;\n```&#039;);
						controls.updateTextareaSelection(
							textarea, selectionStart + 4, selectionEnd + strings[&#039;code-text&#039;].length + 4
						);
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;```\n&#039;, &#039;\n```&#039;);
						controls.updateTextareaSelection(
							textarea, selectionStart + 4 + wrapDelta[0], selectionEnd + 4 - wrapDelta[1]
						);
					}
				});

				formatting.addButtonDispatch(&#039;link&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						controls.insertIntoTextarea(textarea, &#039;[&#039; + strings[&#039;link-text&#039;] + &#039;](&#039; + strings[&#039;link-url&#039;] + &#039;)&#039;);
						controls.updateTextareaSelection(
							textarea,
							selectionStart + strings[&#039;link-text&#039;].length + 3,
							selectionEnd + strings[&#039;link-text&#039;].length + strings[&#039;link-url&#039;].length + 3
						);
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;[&#039;, &#039;](&#039; + strings[&#039;link-url&#039;] + &#039;)&#039;);
						controls.updateTextareaSelection(
							textarea, selectionEnd + 3 - wrapDelta[1], selectionEnd + strings[&#039;link-url&#039;].length + 3 - wrapDelta[1]
						);
					}
				});

				formatting.addButtonDispatch(&#039;picture-o&#039;, function (textarea, selectionStart, selectionEnd) {
					if (selectionStart === selectionEnd) {
						controls.insertIntoTextarea(textarea, &#039;![&#039; + strings[&#039;picture-text&#039;] + &#039;](&#039; + strings[&#039;picture-url&#039;] + &#039;)&#039;);
						controls.updateTextareaSelection(
							textarea,
							selectionStart + strings[&#039;picture-text&#039;].length + 4,
							selectionEnd + strings[&#039;picture-text&#039;].length + strings[&#039;picture-url&#039;].length + 4
						);
					} else {
						var wrapDelta = controls.wrapSelectionInTextareaWith(textarea, &#039;![&#039;, &#039;](&#039; + strings[&#039;picture-url&#039;] + &#039;)&#039;);
						controls.updateTextareaSelection(
							textarea, selectionEnd + 4 - wrapDelta[1], selectionEnd + strings[&#039;picture-url&#039;].length + 4 - wrapDelta[1]
						);
					}
				});
			});
		}
	});
};

export function markExternalLinks() {
	if (!config.markdown.externalMark) {
		return;
	}

	const anchorEls = document.querySelectorAll(&#039;[component=&quot;post/content&quot;] a&#039;);
	anchorEls.forEach((anchorEl) =&gt; {
		// Do nothing if the anchor contains only an image
		if (anchorEl.childElementCount === 1 &amp;&amp; anchorEl.querySelector(&#039;img&#039;) &amp;&amp; !anchorEl.text) {
			return;
		}

		// Otherwise, mark external links with icon
		const parsed = new URL(anchorEl.href, document.location.href);
		if (parsed.host != document.location.host) {
			const iconEl = document.createElement(&#039;i&#039;);
			iconEl.classList.add(&#039;fa&#039;, &#039;fa-external-link&#039;, &#039;small&#039;);
			anchorEl.append(&#039; &#039;, iconEl);
		}
	});
}

export function enhanceCheckbox(ev, data) {
	if (!data.posts &amp;&amp; !data.post) {
		return;
	} if (data.hasOwnProperty(&#039;post&#039;)) {
		data.posts = [data.post];
	}

	var disable;
	var checkboxEls;
	data.posts.forEach(function (post) {
		disable = !post.display_edit_tools;
		checkboxEls = $(&#039;.posts li[data-pid=&quot;&#039; + post.pid + &#039;&quot;] .content div.plugin-markdown input[type=&quot;checkbox&quot;]&#039;);

		checkboxEls.on(&#039;click&#039;, function (e) {
			if (disable) {
				// Find the post&#039;s checkboxes in DOM and make them readonly
				e.preventDefault();
			}

			// Otherwise, edit the post to reflect state change
			var _this = this;
			var pid = $(this).parents(&#039;li[data-pid]&#039;).attr(&#039;data-pid&#039;);
			var index = $(this).parents(&#039;.content&#039;).find(&#039;input[type=&quot;checkbox&quot;]&#039;).toArray()
				.reduce(function (memo, cur, index) {
					if (cur === _this) {
						memo = index;
					}

					return memo;
				}, null);

			socket.emit(&#039;plugins.markdown.checkbox.edit&#039;, {
				pid: pid,
				index: index,
				state: $(_this).prop(&#039;checked&#039;),
			});
		});
	});
};

export function highlight(data) {
	if (data instanceof jQuery.Event) {
		processHighlight($(data.data.selector));
	} else {
		processHighlight(data);
	}
};

const aliasMap = new Map();

export function buildAliasMap() {
	if (window.hljs) {
		const hljs = window.hljs;
		hljs.listLanguages().forEach((language) =&gt; {
			const { aliases } = hljs.getLanguage(language);
			if (aliases &amp;&amp; Array.isArray(aliases)) {
				aliases.forEach((alias) =&gt; {
					aliasMap.set(alias, language);
				});
			}

			aliasMap.set(language, language);
		});
	}
}

async function processHighlight(elements) {
	if (parseInt(config.markdown.highlight, 10)) {
		const hljs = window.hljs;
		if (!hljs) {
			console.debug(`[plugins/markdown] Tryin to highlight without initializing hljs`);
			return;
		}

		console.debug(`[plugins/markdown] Loading support for line numbers`);

		require(&#039;highlightjs-line-numbers.js&#039;);

		elements.each(function (i, block) {
			const parentNode = $(block.parentNode);
			if (parentNode.hasClass(&#039;markdown-highlight&#039;)) {
				return;
			}
			parentNode.addClass(&#039;markdown-highlight&#039;);

			// Default language if set in ACP
			if (!Array.prototype.some.call(block.classList, (className) =&gt; className.startsWith(&#039;language-&#039;)) &amp;&amp; config.markdown.defaultHighlightLanguage) {
				block.classList.add(`language-${config.markdown.defaultHighlightLanguage}`);
			}

			window.hljs.highlightElement(block);

			// Check detected language against whitelist and add lines if enabled
			const classIterator = block.classList.values();
			for (const className of classIterator) {
				if (className.startsWith(&#039;language-&#039;)) {
					const language = className.split(&#039;-&#039;)[1];
					const list = config.markdown.highlightLinesLanguageList;
					if (aliasMap.has(language) &amp;&amp; list &amp;&amp; list.includes(aliasMap.get(language))) {
						$(block).attr(&#039;data-lines&#039;, 1);
						window.hljs.lineNumbersBlock(block);
					}
					break;
				}
			}
		});
	}
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
