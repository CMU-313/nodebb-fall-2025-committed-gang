<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/v8flags/index.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/v8flags/index.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">75.22</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">187</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">31.35</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.33</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// this entire module is depressing. i should have spent my time learning
// how to patch v8 so that these options would just be available on the
// process object.

var os = require(&#039;os&#039;);
var fs = require(&#039;fs&#039;);
var path = require(&#039;path&#039;);
var crypto = require(&#039;crypto&#039;);
var execFile = require(&#039;child_process&#039;).execFile;
var configPath = require(&#039;./config-path.js&#039;)(process.platform);
var version = require(&#039;./package.json&#039;).version;
var env = process.env;
var user = env.LOGNAME || env.USER || env.LNAME || env.USERNAME || &#039;&#039;;
var exclusions = [&#039;--help&#039;, &#039;--completion_bash&#039;];

// This number must be incremented whenever the generated cache file changes.
var CACHE_VERSION = 2;

var configfile = &#039;.v8flags-&#039; + CACHE_VERSION + &#039;-&#039; + process.versions.v8 + &#039;.&#039; + crypto.createHash(&#039;md5&#039;).update(user).digest(&#039;hex&#039;) + &#039;.json&#039;;

var failureMessage = [
  &#039;Unable to cache a config file for v8flags to your home directory&#039;,
  &#039;or a temporary folder. To fix this problem, please correct your&#039;,
  &#039;environment by setting HOME=/path/to/home or TEMP=/path/to/temp.&#039;,
  &#039;NOTE: the user running this must be able to access provided path.&#039;,
  &#039;If all else fails, please open an issue here:&#039;,
  &#039;http://github.com/tkellen/js-v8flags&#039;,
].join(&#039;\n&#039;);

function fail(err) {
  err.message += &#039;\n\n&#039; + failureMessage;
  return err;
}

function openConfig(cb) {
  fs.mkdir(configPath, function() {
    tryOpenConfig(path.join(configPath, configfile), function(err, fd) {
      if (err) {
        return tryOpenConfig(path.join(os.tmpdir(), configfile), cb);
      }
      return cb(null, fd);
    });
  });
}

function tryOpenConfig(configpath, cb) {
  try {
    // if the config file is valid, it should be json and therefore
    // node should be able to require it directly. if this doesn&#039;t
    // throw, we&#039;re done!
    var content = require(configpath);
    process.nextTick(function() {
      cb(null, content);
    });
  } catch (e) {
    // if requiring the config file failed, maybe it doesn&#039;t exist, or
    // perhaps it has become corrupted. instead of calling back with the
    // content of the file, call back with a file descriptor that we can
    // write the cached data to
    fs.open(configpath, &#039;w+&#039;, function(err, fd) {
      if (err) {
        return cb(err);
      }
      return cb(null, fd);
    });
  }
}

// Node &lt;= 9 outputs _ in flags with multiple words, while node 10
// uses -. Both ways are accepted anyway, so always use `_` for better
// compatibility.
// We must not replace the first two --.
function normalizeFlagName(flag) {
  return &#039;--&#039; + flag.slice(4).replace(/-/g, &#039;_&#039;);
}

// i can&#039;t wait for the day this whole module is obsolete because these
// options are available on the process object. this executes node with
// `--v8-options` and parses the result, returning an array of command
// line flags.
function getFlags(cb) {
  var errored = false;
  var pending = 0;
  var flags = [];

  runNode(&#039;--help&#039;);
  runNode(&#039;--v8-options&#039;);

  function runNode(option) {
    pending++;
    execFile(process.execPath, [option], function(execErr, result) {
      if (execErr || errored) {
        if (!errored) {
          errored = true;
          cb(execErr);
        }
        return;
      }

      var index = result.indexOf(&#039;\nOptions:&#039;);
      if (index &gt;= 0) {
        var regexp = /^\s\s--[\w-]+/gm;
        regexp.lastIndex = index;
        var matchedFlags = result.match(regexp);
        if (matchedFlags) {
          flags = flags.concat(matchedFlags
            .map(normalizeFlagName)
            .filter(function(name) {
              return exclusions.indexOf(name) === -1;
            })
          );
        }
      }

      if (--pending === 0) {
        cb(null, flags);
      }
    });
  }
}

// write some json to a file descriptor. if this fails, call back
// with both the error and the data that was meant to be written.
function writeConfig(fd, flags, cb) {
  var json = JSON.stringify(flags);
  var buf;
  if (Buffer.from &amp;&amp; Buffer.from !== Uint8Array.from) {
    // Node.js 4.5.0 or newer
    buf = Buffer.from(json);
  } else {
    // Old Node.js versions
    // The typeof safeguard below is mostly against accidental copy-pasting
    // and code rewrite, it never happens as json is always a string here.
    if (typeof json === &#039;number&#039;) {
      throw new Error(&#039;Unexpected type number&#039;);
    }
    buf = new Buffer(json);
  }
  return fs.write(fd, buf, 0, buf.length, 0 , function(writeErr) {
    fs.close(fd, function(closeErr) {
      var err = writeErr || closeErr;
      if (err) {
        return cb(fail(err), flags);
      }
      return cb(null, flags);
    });
  });
}

module.exports = function(cb) {
  // bail early if this is not node
  var isElectron = process.versions &amp;&amp; process.versions.electron;
  if (isElectron) {
    return process.nextTick(function() {
      cb(null, []);
    });
  }

  // attempt to open/read cache file
  openConfig(function(openErr, result) {
    if (!openErr &amp;&amp; typeof result !== &#039;number&#039;) {
      return cb(null, result);
    }
    // if the result is not an array, we need to go fetch
    // the flags by invoking node with `--v8-options`
    getFlags(function(flagsErr, flags) {
      // if there was an error fetching the flags, bail immediately
      if (flagsErr) {
        return cb(flagsErr);
      }
      // if there was a problem opening the config file for writing
      // throw an error but include the flags anyway so that users
      // can continue to execute (at the expense of having to fetch
      // flags on every run until they fix the underyling problem).
      if (openErr) {
        return cb(fail(openErr), flags);
      }
      // write the config file to disk so subsequent runs can read
      // flags out of a cache file.
      return writeConfig(result, flags, cb);
    });
  });
};

module.exports.configfile = configfile;
module.exports.configPath = configPath;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
