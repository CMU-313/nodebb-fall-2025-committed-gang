<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/mocha/lib/reporters/html.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/mocha/lib/reporters/html.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">65.34</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">421</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">49.78</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.49</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

/* eslint-env browser */
/**
 * @module HTML
 */
/**
 * Module dependencies.
 */

var Base = require(&#039;./base&#039;);
var utils = require(&#039;../utils&#039;);
var escapeRe = require(&#039;escape-string-regexp&#039;);
var constants = require(&#039;../runner&#039;).constants;
var EVENT_TEST_PASS = constants.EVENT_TEST_PASS;
var EVENT_TEST_FAIL = constants.EVENT_TEST_FAIL;
var EVENT_SUITE_BEGIN = constants.EVENT_SUITE_BEGIN;
var EVENT_SUITE_END = constants.EVENT_SUITE_END;
var EVENT_TEST_PENDING = constants.EVENT_TEST_PENDING;
var escape = utils.escape;

/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */

var Date = global.Date;

/**
 * Expose `HTML`.
 */

exports = module.exports = HTML;

/**
 * Stats template: Result, progress, passes, failures, and duration.
 */

var statsTemplate =
  &#039;&lt;ul id=&quot;mocha-stats&quot;&gt;&#039; +
  &#039;&lt;li class=&quot;result&quot;&gt;&lt;/li&gt;&#039; +
  &#039;&lt;li class=&quot;progress-contain&quot;&gt;&lt;progress class=&quot;progress-element&quot; max=&quot;100&quot; value=&quot;0&quot;&gt;&lt;/progress&gt;&lt;svg class=&quot;progress-ring&quot;&gt;&lt;circle class=&quot;ring-flatlight&quot; stroke-dasharray=&quot;100%,0%&quot;/&gt;&lt;circle class=&quot;ring-highlight&quot; stroke-dasharray=&quot;0%,100%&quot;/&gt;&lt;/svg&gt;&lt;div class=&quot;progress-text&quot;&gt;0%&lt;/div&gt;&lt;/li&gt;&#039; +
  &#039;&lt;li class=&quot;passes&quot;&gt;&lt;a href=&quot;javascript:void(0);&quot;&gt;passes:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;&#039; +
  &#039;&lt;li class=&quot;failures&quot;&gt;&lt;a href=&quot;javascript:void(0);&quot;&gt;failures:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;&#039; +
  &#039;&lt;li class=&quot;duration&quot;&gt;duration: &lt;em&gt;0&lt;/em&gt;s&lt;/li&gt;&#039; +
  &#039;&lt;/ul&gt;&#039;;

var playIcon = &#039;&amp;#x2023;&#039;;

/**
 * Constructs a new `HTML` reporter instance.
 *
 * @public
 * @class
 * @memberof Mocha.reporters
 * @extends Mocha.reporters.Base
 * @param {Runner} runner - Instance triggers reporter actions.
 * @param {Object} [options] - runner options
 */
function HTML(runner, options) {
  Base.call(this, runner, options);

  var self = this;
  var stats = this.stats;
  var stat = fragment(statsTemplate);
  var items = stat.getElementsByTagName(&#039;li&#039;);
  const resultIndex = 0;
  const progressIndex = 1;
  const passesIndex = 2;
  const failuresIndex = 3;
  const durationIndex = 4;
  /** Stat item containing the root suite pass or fail indicator (hasFailures ? &#039;✖&#039; : &#039;✓&#039;) */
  var resultIndicator = items[resultIndex];
  /** Passes text and count */
  const passesStat = items[passesIndex];
  /** Stat item containing the pass count (not the word, just the number) */
  const passesCount = passesStat.getElementsByTagName(&#039;em&#039;)[0];
  /** Stat item linking to filter to show only passing tests */
  const passesLink = passesStat.getElementsByTagName(&#039;a&#039;)[0];
  /** Failures text and count */
  const failuresStat = items[failuresIndex];
  /** Stat item containing the failure count (not the word, just the number) */
  const failuresCount = failuresStat.getElementsByTagName(&#039;em&#039;)[0];
  /** Stat item linking to filter to show only failing tests */
  const failuresLink = failuresStat.getElementsByTagName(&#039;a&#039;)[0];
  /** Stat item linking to the duration time (not the word or unit, just the number) */
  var duration = items[durationIndex].getElementsByTagName(&#039;em&#039;)[0];
  var report = fragment(&#039;&lt;ul id=&quot;mocha-report&quot;&gt;&lt;/ul&gt;&#039;);
  var stack = [report];
  var progressText = items[progressIndex].getElementsByTagName(&#039;div&#039;)[0];
  var progressBar = items[progressIndex].getElementsByTagName(&#039;progress&#039;)[0];
  var progressRing = [
    items[progressIndex].getElementsByClassName(&#039;ring-flatlight&#039;)[0],
    items[progressIndex].getElementsByClassName(&#039;ring-highlight&#039;)[0]
  ];
  var progressRingRadius = null; // computed CSS unavailable now, so set later
  var root = document.getElementById(&#039;mocha&#039;);

  if (!root) {
    return error(&#039;#mocha div missing, add it to your document&#039;);
  }

  // pass toggle
  on(passesLink, &#039;click&#039;, function (evt) {
    evt.preventDefault();
    unhide();
    var name = /pass/.test(report.className) ? &#039;&#039; : &#039; pass&#039;;
    report.className = report.className.replace(/fail|pass/g, &#039;&#039;) + name;
    if (report.className.trim()) {
      hideSuitesWithout(&#039;test pass&#039;);
    }
  });

  // failure toggle
  on(failuresLink, &#039;click&#039;, function (evt) {
    evt.preventDefault();
    unhide();
    var name = /fail/.test(report.className) ? &#039;&#039; : &#039; fail&#039;;
    report.className = report.className.replace(/fail|pass/g, &#039;&#039;) + name;
    if (report.className.trim()) {
      hideSuitesWithout(&#039;test fail&#039;);
    }
  });

  root.appendChild(stat);
  root.appendChild(report);

  runner.on(EVENT_SUITE_BEGIN, function (suite) {
    if (suite.root) {
      return;
    }

    // suite
    var url = self.suiteURL(suite);
    var el = fragment(
      &#039;&lt;li class=&quot;suite&quot;&gt;&lt;h1&gt;&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/h1&gt;&lt;/li&gt;&#039;,
      url,
      escape(suite.title)
    );

    // container
    stack[0].appendChild(el);
    stack.unshift(document.createElement(&#039;ul&#039;));
    el.appendChild(stack[0]);
  });

  runner.on(EVENT_SUITE_END, function (suite) {
    if (suite.root) {
      if (stats.failures === 0) {
        text(resultIndicator, &#039;✓&#039;);
        stat.className += &#039; pass&#039;;
      }
      updateStats();
      return;
    }
    stack.shift();
  });

  runner.on(EVENT_TEST_PASS, function (test) {
    var url = self.testURL(test);
    var markup =
      &#039;&lt;li class=&quot;test pass %e&quot;&gt;&lt;h2&gt;%e&lt;span class=&quot;duration&quot;&gt;%ems&lt;/span&gt; &#039; +
      &#039;&lt;a href=&quot;%s&quot; class=&quot;replay&quot;&gt;&#039; +
      playIcon +
      &#039;&lt;/a&gt;&lt;/h2&gt;&lt;/li&gt;&#039;;
    var el = fragment(markup, test.speed, test.title, test.duration, url);
    self.addCodeToggle(el, test.body);
    appendToStack(el);
    updateStats();
  });

  runner.on(EVENT_TEST_FAIL, function (test) {
    // Update stat items
    text(resultIndicator, &#039;✖&#039;);
    stat.className += &#039; fail&#039;;

    var el = fragment(
      &#039;&lt;li class=&quot;test fail&quot;&gt;&lt;h2&gt;%e &lt;a href=&quot;%e&quot; class=&quot;replay&quot;&gt;&#039; +
        playIcon +
        &#039;&lt;/a&gt;&lt;/h2&gt;&lt;/li&gt;&#039;,
      test.title,
      self.testURL(test)
    );
    var stackString; // Note: Includes leading newline
    var message = test.err.toString();

    // &lt;=IE7 stringifies to [Object Error]. Since it can be overloaded, we
    // check for the result of the stringifying.
    if (message === &#039;[object Error]&#039;) {
      message = test.err.message;
    }

    if (test.err.stack) {
      var indexOfMessage = test.err.stack.indexOf(test.err.message);
      if (indexOfMessage === -1) {
        stackString = test.err.stack;
      } else {
        stackString = test.err.stack.slice(
          test.err.message.length + indexOfMessage
        );
      }
    } else if (test.err.sourceURL &amp;&amp; test.err.line !== undefined) {
      // Safari doesn&#039;t give you a stack. Let&#039;s at least provide a source line.
      stackString = &#039;\n(&#039; + test.err.sourceURL + &#039;:&#039; + test.err.line + &#039;)&#039;;
    }

    stackString = stackString || &#039;&#039;;

    if (test.err.htmlMessage &amp;&amp; stackString) {
      el.appendChild(
        fragment(
          &#039;&lt;div class=&quot;html-error&quot;&gt;%s\n&lt;pre class=&quot;error&quot;&gt;%e&lt;/pre&gt;&lt;/div&gt;&#039;,
          test.err.htmlMessage,
          stackString
        )
      );
    } else if (test.err.htmlMessage) {
      el.appendChild(
        fragment(&#039;&lt;div class=&quot;html-error&quot;&gt;%s&lt;/div&gt;&#039;, test.err.htmlMessage)
      );
    } else {
      el.appendChild(
        fragment(&#039;&lt;pre class=&quot;error&quot;&gt;%e%e&lt;/pre&gt;&#039;, message, stackString)
      );
    }

    self.addCodeToggle(el, test.body);
    appendToStack(el);
    updateStats();
  });

  runner.on(EVENT_TEST_PENDING, function (test) {
    var el = fragment(
      &#039;&lt;li class=&quot;test pass pending&quot;&gt;&lt;h2&gt;%e&lt;/h2&gt;&lt;/li&gt;&#039;,
      test.title
    );
    appendToStack(el);
    updateStats();
  });

  function appendToStack(el) {
    // Don&#039;t call .appendChild if #mocha-report was already .shift()&#039;ed off the stack.
    if (stack[0]) {
      stack[0].appendChild(el);
    }
  }

  function updateStats() {
    var percent = ((stats.tests / runner.total) * 100) | 0;
    progressBar.value = percent;
    if (progressText) {
      // setting a toFixed that is too low, makes small changes to progress not shown
      // setting it too high, makes the progress text longer then it needs to
      // to address this, calculate the toFixed based on the magnitude of total
      var decimalPlaces = Math.ceil(Math.log10(runner.total / 100));
      text(
        progressText,
        percent.toFixed(Math.min(Math.max(decimalPlaces, 0), 100)) + &#039;%&#039;
      );
    }
    if (progressRing) {
      var radius = parseFloat(getComputedStyle(progressRing[0]).getPropertyValue(&#039;r&#039;));
      var wholeArc = Math.PI * 2 * radius;
      var highlightArc = percent * (wholeArc / 100);
      // The progress ring is in 2 parts, the flatlight color and highlight color.
      // Rendering both on top of the other, seems to make a 3rd color on the edges.
      // To create 1 whole ring with 2 colors, both parts are inverse of the other.
      progressRing[0].style[&#039;stroke-dasharray&#039;] = `0,${highlightArc}px,${wholeArc}px`;
      progressRing[1].style[&#039;stroke-dasharray&#039;] = `${highlightArc}px,${wholeArc}px`;
    }

    // update stats
    var ms = new Date() - stats.start;
    text(passesCount, stats.passes);
    text(failuresCount, stats.failures);
    text(duration, (ms / 1000).toFixed(2));
  }
}

/**
 * Makes a URL, preserving querystring (&quot;search&quot;) parameters.
 *
 * @param {string} s
 * @return {string} A new URL.
 */
function makeUrl(s) {
  var search = window.location.search;

  // Remove previous {grep, fgrep, invert} query parameters if present
  if (search) {
    search = search.replace(/[?&amp;](?:f?grep|invert)=[^&amp;\s]*/g, &#039;&#039;).replace(/^&amp;/, &#039;?&#039;);
  }

  return (
    window.location.pathname +
    (search ? search + &#039;&amp;&#039; : &#039;?&#039;) +
    &#039;grep=&#039; +
    encodeURIComponent(s)
  );
}

/**
 * Provide suite URL.
 *
 * @param {Object} [suite]
 */
HTML.prototype.suiteURL = function (suite) {
  return makeUrl(&#039;^&#039; + escapeRe(suite.fullTitle()) + &#039; &#039;);
};

/**
 * Provide test URL.
 *
 * @param {Object} [test]
 */
HTML.prototype.testURL = function (test) {
  return makeUrl(&#039;^&#039; + escapeRe(test.fullTitle()) + &#039;$&#039;);
};

/**
 * Adds code toggle functionality for the provided test&#039;s list element.
 *
 * @param {HTMLLIElement} el
 * @param {string} contents
 */
HTML.prototype.addCodeToggle = function (el, contents) {
  var h2 = el.getElementsByTagName(&#039;h2&#039;)[0];

  on(h2, &#039;click&#039;, function () {
    pre.style.display = pre.style.display === &#039;none&#039; ? &#039;block&#039; : &#039;none&#039;;
  });

  var pre = fragment(&#039;&lt;pre&gt;&lt;code&gt;%e&lt;/code&gt;&lt;/pre&gt;&#039;, utils.clean(contents));
  el.appendChild(pre);
  pre.style.display = &#039;none&#039;;
};

/**
 * Display error `msg`.
 *
 * @param {string} msg
 */
function error(msg) {
  document.body.appendChild(fragment(&#039;&lt;div id=&quot;mocha-error&quot;&gt;%s&lt;/div&gt;&#039;, msg));
}

/**
 * Return a DOM fragment from `html`.
 *
 * @param {string} html
 */
function fragment(html) {
  var args = arguments;
  var div = document.createElement(&#039;div&#039;);
  var i = 1;

  div.innerHTML = html.replace(/%([se])/g, function (_, type) {
    switch (type) {
      case &#039;s&#039;:
        return String(args[i++]);
      case &#039;e&#039;:
        return escape(args[i++]);
      // no default
    }
  });

  return div.firstChild;
}

/**
 * Check for suites that do not have elements
 * with `classname`, and hide them.
 *
 * @param {text} classname
 */
function hideSuitesWithout(classname) {
  var suites = document.getElementsByClassName(&#039;suite&#039;);
  for (var i = 0; i &lt; suites.length; i++) {
    var els = suites[i].getElementsByClassName(classname);
    if (!els.length) {
      suites[i].className += &#039; hidden&#039;;
    }
  }
}

/**
 * Unhide .hidden suites.
 */
function unhide() {
  var els = document.getElementsByClassName(&#039;suite hidden&#039;);
  while (els.length &gt; 0) {
    els[0].className = els[0].className.replace(&#039;suite hidden&#039;, &#039;suite&#039;);
  }
}

/**
 * Set an element&#039;s text contents.
 *
 * @param {HTMLElement} el
 * @param {string} contents
 */
function text(el, contents) {
  if (el.textContent) {
    el.textContent = contents;
  } else {
    el.innerText = contents;
  }
}

/**
 * Listen on `event` with callback `fn`.
 */
function on(el, event, fn) {
  if (el.addEventListener) {
    el.addEventListener(event, fn, false);
  } else {
    el.attachEvent(&#039;on&#039; + event, fn);
  }
}

HTML.browserOnly = true;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
