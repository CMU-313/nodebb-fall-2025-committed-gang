<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - test/utils.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>test/utils.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">74.21</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">572</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">49.13</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">6.77</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;


const assert = require(&#039;assert&#039;);
const validator = require(&#039;validator&#039;);
const { JSDOM } = require(&#039;jsdom&#039;);
const slugify = require(&#039;../src/slugify&#039;);
const db = require(&#039;./mocks/databasemock&#039;);

describe(&#039;Utility Methods&#039;, () =&gt; {
	// https://gist.github.com/robballou/9ee108758dc5e0e2d028
	// create some jsdom magic to allow jQuery to work
	const dom = new JSDOM(&#039;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&#039;);
	global.window = dom.window;
	global.document = dom.window.document;
	global.jQuery = require(&#039;jquery&#039;);
	global.$ = global.jQuery;
	const { $ } = global;

	const utils = require(&#039;../public/src/utils&#039;);

	// https://github.com/jprichardson/string.js/blob/master/test/string.test.js
	it(&#039;should decode HTML entities&#039;, (done) =&gt; {
		assert.strictEqual(
			utils.decodeHTMLEntities(&#039;Ken Thompson &amp;amp; Dennis Ritchie&#039;),
			&#039;Ken Thompson &amp; Dennis Ritchie&#039;
		);
		assert.strictEqual(
			utils.decodeHTMLEntities(&#039;3 &amp;lt; 4&#039;),
			&#039;3 &lt; 4&#039;
		);
		assert.strictEqual(
			utils.decodeHTMLEntities(&#039;http:&amp;#47;&amp;#47;&#039;),
			&#039;http://&#039;
		);
		done();
	});

	it(&#039;should strip HTML tags&#039;, (done) =&gt; {
		assert.strictEqual(utils.stripHTMLTags(&#039;&lt;p&gt;just &lt;b&gt;some&lt;/b&gt; text&lt;/p&gt;&#039;), &#039;just some text&#039;);
		assert.strictEqual(utils.stripHTMLTags(&#039;&lt;p&gt;just &lt;b&gt;some&lt;/b&gt; text&lt;/p&gt;&#039;, [&#039;p&#039;]), &#039;just &lt;b&gt;some&lt;/b&gt; text&#039;);
		assert.strictEqual(utils.stripHTMLTags(&#039;&lt;i&gt;just&lt;/i&gt; some &lt;image/&gt; text&#039;, [&#039;i&#039;]), &#039;just some &lt;image/&gt; text&#039;);
		assert.strictEqual(utils.stripHTMLTags(&#039;&lt;i&gt;just&lt;/i&gt; some &lt;image/&gt; &lt;div&gt;text&lt;/div&gt;&#039;, [&#039;i&#039;, &#039;div&#039;]), &#039;just some &lt;image/&gt; text&#039;);
		done();
	});

	it(&#039;should preserve case if requested&#039;, (done) =&gt; {
		assert.strictEqual(slugify(&#039;UPPER CASE&#039;, true), &#039;UPPER-CASE&#039;);
		done();
	});

	it(&#039;should work if a number is passed in&#039;, (done) =&gt; {
		assert.strictEqual(slugify(12345), &#039;12345&#039;);
		done();
	});

	describe(&#039;username validation&#039;, () =&gt; {
		it(&#039;accepts latin-1 characters&#039;, () =&gt; {
			const username = &quot;John\&quot;&#039;-. Doeäâèéë1234&quot;;
			assert(utils.isUserNameValid(username), &#039;invalid username&#039;);
		});

		it(&#039;rejects empty string&#039;, () =&gt; {
			const username = &#039;&#039;;
			assert.equal(utils.isUserNameValid(username), false, &#039;accepted as valid username&#039;);
		});

		it(&#039;should reject new lines&#039;, () =&gt; {
			assert.equal(utils.isUserNameValid(&#039;myusername\r\n&#039;), false);
		});

		it(&#039;should reject new lines&#039;, () =&gt; {
			assert.equal(utils.isUserNameValid(&#039;myusername\n&#039;), false);
		});

		it(&#039;should reject tabs&#039;, () =&gt; {
			assert.equal(utils.isUserNameValid(&#039;myusername\t&#039;), false);
		});

		it(&#039;accepts square brackets&#039;, () =&gt; {
			const username = &#039;[best clan] julian&#039;;
			assert(utils.isUserNameValid(username), &#039;invalid username&#039;);
		});

		it(&#039;accepts regular username&#039;, () =&gt; {
			assert(utils.isUserNameValid(&#039;myusername&#039;), &#039;invalid username&#039;);
		});

		it(&#039;accepts quotes&#039;, () =&gt; {
			assert(utils.isUserNameValid(&#039;baris &quot;the best&quot; usakli&#039;), &#039;invalid username&#039;);
		});
	});

	describe(&#039;email validation&#039;, () =&gt; {
		it(&#039;accepts sample address&#039;, () =&gt; {
			const email = &#039;sample@example.com&#039;;
			assert(utils.isEmailValid(email), &#039;invalid email&#039;);
		});

		it(&#039;rejects empty address&#039;, () =&gt; {
			const email = &#039;&#039;;
			assert.equal(utils.isEmailValid(email), false, &#039;accepted as valid email&#039;);
		});
	});

	describe(&#039;UUID generation / secureRandom&#039;, () =&gt; {
		it(&#039;return unique random value every time&#039;, () =&gt; {
			delete require.cache[require.resolve(&#039;../src/utils&#039;)];
			const { generateUUID } = require(&#039;../src/utils&#039;);
			const uuid1 = generateUUID();
			const uuid2 = generateUUID();
			assert.notEqual(uuid1, uuid2, &#039;matches&#039;);
		});

		it(&#039;should return a random number between 1-10 inclusive&#039;, () =&gt; {
			const { secureRandom } = require(&#039;../src/utils&#039;);
			const r1 = secureRandom(1, 10);
			assert(r1 &gt;= 1);
			assert(r1 &lt;= 10);
		});

		it(&#039;should always return 3&#039;, () =&gt; {
			const { secureRandom } = require(&#039;../src/utils&#039;);
			const r1 = secureRandom(3, 3);
			assert.strictEqual(r1, 3);
		});
	});

	describe(&#039;cleanUpTag&#039;, () =&gt; {
		it(&#039;should cleanUp a tag&#039;, (done) =&gt; {
			const cleanedTag = utils.cleanUpTag(&#039;,/#!$^*;TaG1:{}=_`&lt;&gt;\&#039;&quot;~()?|&#039;);
			assert.equal(cleanedTag, &#039;tag1&#039;);
			done();
		});

		it(&#039;should return empty string for invalid tags&#039;, (done) =&gt; {
			assert.strictEqual(utils.cleanUpTag(undefined), &#039;&#039;);
			assert.strictEqual(utils.cleanUpTag(null), &#039;&#039;);
			assert.strictEqual(utils.cleanUpTag(false), &#039;&#039;);
			assert.strictEqual(utils.cleanUpTag(1), &#039;&#039;);
			assert.strictEqual(utils.cleanUpTag(0), &#039;&#039;);
			done();
		});
	});

	it(&#039;should remove punctuation&#039;, (done) =&gt; {
		const removed = utils.removePunctuation(&#039;some text with , ! punctuation inside &quot;&#039;);
		assert.equal(removed, &#039;some text with   punctuation inside &#039;);
		done();
	});

	it(&#039;should get language key&#039;, () =&gt; {
		assert.strictEqual(utils.getLanguage(), &#039;en-GB&#039;);
		global.window.utils = {};
		global.window.config = { userLang: &#039;tr&#039; };
		assert.strictEqual(utils.getLanguage(), &#039;tr&#039;);
		global.window.config = { defaultLang: &#039;de&#039; };
		assert.strictEqual(utils.getLanguage(), &#039;de&#039;);
	});

	it(&#039;should return true if string has language key&#039;, (done) =&gt; {
		assert.equal(utils.hasLanguageKey(&#039;some text [[topic:title]] and [[user:reputaiton]]&#039;), true);
		done();
	});

	it(&#039;should return false if string does not have language key&#039;, (done) =&gt; {
		assert.equal(utils.hasLanguageKey(&#039;some text with no language keys&#039;), false);
		done();
	});

	it(&#039;should return bootstrap env&#039;, () =&gt; {
		assert.strictEqual(utils.findBootstrapEnvironment(), &#039;xs&#039;);
	});

	it(&#039;should check if mobile&#039;, () =&gt; {
		assert.strictEqual(utils.isMobile(), true);
	});

	it(&#039;should check password validity&#039;, () =&gt; {
		global.ajaxify = {
			data: {
				minimumPasswordStrength: 1,
				minimumPasswordLength: 6,
			},
		};
		const zxcvbn = require(&#039;zxcvbn&#039;);

		function check(pwd, expectedError) {
			try {
				utils.assertPasswordValidity(pwd, zxcvbn);
				assert(false);
			} catch (err) {
				assert.strictEqual(err.message, expectedError);
			}
		}
		check(&#039;123456&#039;, &#039;[[user:weak-password]]&#039;);
		check(&#039;&#039;, &#039;[[user:change-password-error]]&#039;);
		check(&#039;asd&#039;, &#039;[[reset_password:password-too-short]]&#039;);
		check(new Array(513).fill(&#039;a&#039;).join(&#039;&#039;), &#039;[[error:password-too-long]]&#039;);
		utils.assertPasswordValidity(&#039;Yzsh31j!a&#039;, zxcvbn);
	});

	it(&#039;should generate UUID&#039;, () =&gt; {
		assert(validator.isUUID(utils.generateUUID()));
	});

	it(&#039;should shallow merge two objects&#039;, (done) =&gt; {
		const a = { foo: 1, cat1: &#039;ginger&#039; };
		const b = { baz: 2, cat2: &#039;phoebe&#039; };
		const obj = utils.merge(a, b);
		assert.strictEqual(obj.foo, 1);
		assert.strictEqual(obj.baz, 2);
		assert.strictEqual(obj.cat1, &#039;ginger&#039;);
		assert.strictEqual(obj.cat2, &#039;phoebe&#039;);
		done();
	});

	it(&#039;should return the file extesion&#039;, (done) =&gt; {
		assert.equal(utils.fileExtension(&#039;/path/to/some/file.png&#039;), &#039;png&#039;);
		done();
	});

	it(&#039;should return file mime type&#039;, (done) =&gt; {
		assert.equal(utils.fileMimeType(&#039;/path/to/some/file.png&#039;), &#039;image/png&#039;);
		done();
	});

	it(&#039;should check if url is relative&#039;, (done) =&gt; {
		assert.equal(utils.isRelativeUrl(&#039;/topic/1/slug&#039;), true);
		done();
	});

	it(&#039;should check if url is relative&#039;, (done) =&gt; {
		assert.equal(utils.isRelativeUrl(&#039;https://nodebb.org&#039;), false);
		done();
	});

	it(&#039;should make number human readable&#039;, (done) =&gt; {
		assert.equal(utils.makeNumberHumanReadable(&#039;1000&#039;), &#039;1.0k&#039;);
		done();
	});

	it(&#039;should make number human readable&#039;, (done) =&gt; {
		assert.equal(utils.makeNumberHumanReadable(&#039;1100000&#039;), &#039;1.1m&#039;);
		done();
	});

	it(&#039;should make number human readable&#039;, (done) =&gt; {
		assert.equal(utils.makeNumberHumanReadable(&#039;100&#039;), &#039;100&#039;);
		done();
	});

	it(&#039;should make number human readable&#039;, (done) =&gt; {
		assert.equal(utils.makeNumberHumanReadable(null), &#039;null&#039;);
		done();
	});

	it(&#039;should make numbers human readable on elements&#039;, (done) =&gt; {
		const el = $(&#039;&lt;div title=&quot;100000&quot;&gt;&lt;/div&gt;&#039;);
		utils.makeNumbersHumanReadable(el);
		assert.equal(el.html(), &#039;100.0k&#039;);
		done();
	});

	it(&#039;should add commas to numbers&#039;, (done) =&gt; {
		assert.equal(utils.addCommas(&#039;100&#039;), &#039;100&#039;);
		assert.equal(utils.addCommas(&#039;1000&#039;), &#039;1,000&#039;);
		assert.equal(utils.addCommas(&#039;1000000&#039;), &#039;1,000,000&#039;);
		done();
	});

	it(&#039;should add commas to elements&#039;, (done) =&gt; {
		const el = $(&#039;&lt;div&gt;1000000&lt;/div&gt;&#039;);
		utils.addCommasToNumbers(el);
		assert.equal(el.html(), &#039;1,000,000&#039;);
		done();
	});

	it(&#039;should return passed in value if invalid&#039;, (done) =&gt; {
		// eslint-disable-next-line no-loss-of-precision
		const bigInt = -111111111111111111;
		const result = utils.toISOString(bigInt);
		assert.equal(bigInt, result);
		done();
	});

	it(&#039;should return false if browser is not android&#039;, (done) =&gt; {
		const navigator = {
			userAgent: &#039;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36&#039;,
		};
		assert.equal(utils.isAndroidBrowser(navigator.userAgent), false);
		done();
	});

	it(&#039;should return true if browser is android&#039;, (done) =&gt; {
		const navigator = {
			userAgent: &#039;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Android /58.0.3029.96 Safari/537.36&#039;,
		};
		assert.equal(utils.isAndroidBrowser(navigator.userAgent), true);
		done();
	});

	it(&#039;should check if element is in viewport&#039;, (done) =&gt; {
		const el = $(&#039;&lt;div&gt;some text&lt;/div&gt;&#039;);
		assert(utils.isElementInViewport(el));
		done();
	});

	it(&#039;should get empty object for url params&#039;, (done) =&gt; {
		const params = utils.params();
		assert.equal(Object.keys(params), 0);
		done();
	});

	it(&#039;should get url params&#039;, (done) =&gt; {
		const params = utils.params({ url: &#039;http://nodebb.org?foo=1&amp;bar=test&amp;herp=2&#039; });
		assert.strictEqual(params.foo, 1);
		assert.strictEqual(params.bar, &#039;test&#039;);
		assert.strictEqual(params.herp, 2);
		done();
	});

	it(&#039;should get url params as arrays&#039;, (done) =&gt; {
		const params = utils.params({ url: &#039;http://nodebb.org?foo=1&amp;bar=test&amp;herp[]=2&amp;herp[]=3&#039; });
		assert.strictEqual(params.foo, 1);
		assert.strictEqual(params.bar, &#039;test&#039;);
		assert.deepStrictEqual(params.herp, [2, 3]);
		done();
	});

	it(&#039;should get a single param&#039;, (done) =&gt; {
		assert.equal(utils.param(&#039;somekey&#039;), undefined);
		done();
	});

	it(&#039;should get the full URLSearchParams object&#039;, async () =&gt; {
		const params = utils.params({ url: &#039;http://nodebb.org?foo=1&amp;bar=test&amp;herp[]=2&amp;herp[]=3&#039;, full: true });
		assert(params instanceof URLSearchParams);
		assert.strictEqual(params.get(&#039;foo&#039;), &#039;1&#039;);
		assert.strictEqual(params.get(&#039;bar&#039;), &#039;test&#039;);
		assert.strictEqual(params.get(&#039;herp[]&#039;), &#039;2&#039;);
	});

	describe(&#039;toType&#039;, () =&gt; {
		it(&#039;should return param as is if not string&#039;, (done) =&gt; {
			assert.equal(123, utils.toType(123));
			done();
		});

		it(&#039;should convert return string numbers as numbers&#039;, (done) =&gt; {
			assert.equal(123, utils.toType(&#039;123&#039;));
			done();
		});

		it(&#039;should convert string &quot;false&quot; to boolean false&#039;, (done) =&gt; {
			assert.strictEqual(false, utils.toType(&#039;false&#039;));
			done();
		});

		it(&#039;should convert string &quot;true&quot; to boolean true&#039;, (done) =&gt; {
			assert.strictEqual(true, utils.toType(&#039;true&#039;));
			done();
		});

		it(&#039;should parse json&#039;, (done) =&gt; {
			const data = utils.toType(&#039;{&quot;a&quot;:&quot;1&quot;}&#039;);
			assert.equal(data.a, &#039;1&#039;);
			done();
		});

		it(&#039;should return string as is if its not json,true,false or number&#039;, (done) =&gt; {
			const regularStr = &#039;this is a regular string&#039;;
			assert.equal(regularStr, utils.toType(regularStr));
			done();
		});
	});

	describe(&#039;utils.props&#039;, () =&gt; {
		const data = {};

		it(&#039;should set nested data&#039;, (done) =&gt; {
			assert.equal(10, utils.props(data, &#039;a.b.c.d&#039;, 10));
			done();
		});

		it(&#039;should return nested object&#039;, (done) =&gt; {
			const obj = utils.props(data, &#039;a.b.c&#039;);
			assert.equal(obj.d, 10);
			done();
		});

		it(&#039;should returned undefined without throwing&#039;, (done) =&gt; {
			assert.equal(utils.props(data, &#039;a.b.c.foo.bar&#039;), undefined);
			done();
		});

		it(&#039;should return undefined if second param is null&#039;, (done) =&gt; {
			assert.equal(utils.props(undefined, null), undefined);
			done();
		});
	});

	describe(&#039;isInternalURI&#039;, () =&gt; {
		const target = { host: &#039;&#039;, protocol: &#039;https&#039; };
		const reference = { host: &#039;&#039;, protocol: &#039;https&#039; };

		it(&#039;should return true if they match&#039;, (done) =&gt; {
			assert(utils.isInternalURI(target, reference, &#039;&#039;));
			done();
		});

		it(&#039;should return true if they match&#039;, (done) =&gt; {
			target.host = &#039;nodebb.org&#039;;
			reference.host = &#039;nodebb.org&#039;;
			assert(utils.isInternalURI(target, reference, &#039;&#039;));
			done();
		});

		it(&#039;should handle relative path&#039;, (done) =&gt; {
			target.pathname = &#039;/forum&#039;;
			assert(utils.isInternalURI(target, reference, &#039;/forum&#039;));
			done();
		});

		it(&#039;should return false if they do not match&#039;, (done) =&gt; {
			target.pathname = &#039;&#039;;
			reference.host = &#039;designcreateplay.com&#039;;
			assert(!utils.isInternalURI(target, reference));
			done();
		});
	});

	it(&#039;escape html&#039;, (done) =&gt; {
		const escaped = utils.escapeHTML(&#039;&amp;&lt;&gt;&#039;);
		assert.equal(escaped, &#039;&amp;amp;&amp;lt;&amp;gt;&#039;);
		done();
	});

	it(&#039;should escape regex chars&#039;, (done) =&gt; {
		const escaped = utils.escapeRegexChars(&#039;some text {}&#039;);
		assert.equal(escaped, &#039;some\\ text\\ \\{\\}&#039;);
		done();
	});

	it(&#039;should get hours array&#039;, (done) =&gt; {
		const currentHour = new Date().getHours();
		const hours = utils.getHoursArray();
		let index = hours.length - 1;
		for (let i = currentHour, ii = currentHour - 24; i &gt; ii; i -= 1) {
			const hour = i &lt; 0 ? 24 + i : i;
			assert.equal(hours[index], `${hour}:00`);
			index -= 1;
		}
		done();
	});

	it(&#039;should get days array&#039;, (done) =&gt; {
		const currentDay = new Date(Date.now()).getTime();
		const days = utils.getDaysArray();
		const months = [&#039;Jan&#039;, &#039;Feb&#039;, &#039;Mar&#039;, &#039;Apr&#039;, &#039;May&#039;, &#039;Jun&#039;, &#039;Jul&#039;, &#039;Aug&#039;, &#039;Sep&#039;, &#039;Oct&#039;, &#039;Nov&#039;, &#039;Dec&#039;];
		let index = 0;
		for (let x = 29; x &gt;= 0; x -= 1) {
			const tmpDate = new Date(currentDay - (1000 * 60 * 60 * 24 * x));
			assert.equal(`${months[tmpDate.getMonth()]} ${tmpDate.getDate()}`, days[index]);
			index += 1;
		}
		done();
	});

	it(&#039;`utils.rtrim` should remove trailing space&#039;, (done) =&gt; {
		assert.strictEqual(utils.rtrim(&#039;  thing   &#039;), &#039;  thing&#039;);
		assert.strictEqual(utils.rtrim(&#039;\tthing\t\t&#039;), &#039;\tthing&#039;);
		assert.strictEqual(utils.rtrim(&#039;\t thing \t&#039;), &#039;\t thing&#039;);
		done();
	});

	it(&#039;should profile function&#039;, (done) =&gt; {
		const st = process.hrtime();
		setTimeout(() =&gt; {
			process.profile(&#039;it took&#039;, st);
			done();
		}, 500);
	});

	it(&#039;should return object with data&#039;, async () =&gt; {
		const user = require(&#039;../src/user&#039;);
		const uid1 = await user.create({ username: &#039;promise1&#039; });
		const uid2 = await user.create({ username: &#039;promise2&#039; });
		const result = await utils.promiseParallel({
			user1: user.getUserData(uid1),
			user2: user.getUserData(uid2),
		});
		assert(result.hasOwnProperty(&#039;user1&#039;) &amp;&amp; result.hasOwnProperty(&#039;user2&#039;));
		assert.strictEqual(result.user1.uid, uid1);
		assert.strictEqual(result.user2.uid, uid2);
	});

	describe(&#039;debounce/throttle&#039;, () =&gt; {
		it(&#039;should call function after x milliseconds once&#039;, (done) =&gt; {
			let count = 0;
			const now = Date.now();
			const fn = utils.debounce(() =&gt; {
				count += 1;
				assert.strictEqual(count, 1);
				assert(Date.now() - now &gt; 50);
			}, 100);
			fn();
			fn();
			setTimeout(() =&gt; done(), 200);
		});

		it(&#039;should call function first if immediate=true&#039;, (done) =&gt; {
			let count = 0;
			const now = Date.now();
			const fn = utils.debounce(() =&gt; {
				count += 1;
				assert.strictEqual(count, 1);
				assert(Date.now() - now &lt; 50);
			}, 100, true);
			fn();
			fn();
			setTimeout(() =&gt; done(), 200);
		});

		it(&#039;should call function after x milliseconds once&#039;, (done) =&gt; {
			let count = 0;
			const now = Date.now();
			const fn = utils.throttle(() =&gt; {
				count += 1;
				assert.strictEqual(count, 1);
				assert(Date.now() - now &gt; 50);
			}, 100);
			fn();
			fn();
			setTimeout(() =&gt; done(), 200);
		});

		it(&#039;should call function twice if immediate=true&#039;, (done) =&gt; {
			let count = 0;
			const fn = utils.throttle(() =&gt; {
				count += 1;
			}, 100, true);
			fn();
			fn();
			setTimeout(() =&gt; {
				assert.strictEqual(count, 2);
				done();
			}, 200);
		});
	});

	describe(&#039;Translator&#039;, () =&gt; {
		const shim = require(&#039;../src/translator&#039;);

		const { Translator } = shim;

		it(&#039;should translate in place&#039;, async () =&gt; {
			const translator = Translator.create(&#039;en-GB&#039;);
			const el = $(`&lt;div&gt;&lt;span id=&quot;search&quot; title=&quot;[[global:search]]&quot;&gt;&lt;/span&gt;&lt;span id=&quot;text&quot;&gt;[[global:home]]&lt;/span&gt;&lt;/div&gt;`);
			await translator.translateInPlace(el.get(0));
			assert.strictEqual(el.find(&#039;#text&#039;).text(), &#039;Home&#039;);
			assert.strictEqual(el.find(&#039;#search&#039;).attr(&#039;title&#039;), &#039;Search&#039;);
		});

		it(&#039;should not error&#039;, (done) =&gt; {
			shim.flush();
			shim.flushNamespace();
			done();
		});
	});
});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
