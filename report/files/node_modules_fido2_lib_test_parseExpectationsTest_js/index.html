<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/fido2-lib/test/parseExpectationsTest.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/fido2-lib/test/parseExpectationsTest.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">66.96</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">429</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">38.60</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">5.47</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&quot;use strict&quot;;

const parser = require(&quot;../lib/parser&quot;);
const assert = require(&quot;chai&quot;).assert;
const h = require(&quot;fido2-helpers&quot;);
const coerceToArrayBuffer = h.functions.coerceToArrayBuffer;
const abEqual = h.functions.abEqual;

describe(&quot;parseExpectations&quot;, function() {
	it(&quot;parser is object&quot;, function() {
		assert.isObject(parser);
	});

	it(&quot;returns Map on good expectations&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), exp.challenge);
	});

	it(&quot;doesn&#039;t add extra items to Map&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
			foo: &quot;bar&quot;,
			beer: true,
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), exp.challenge);
	});

	it(&quot;throws on invalid origin&quot;, function() {
		var exp = {
			origin: &quot;asdf&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, TypeError, &quot;Invalid URL&quot;);
	});

	it(&quot;throws if expected origin is https:443&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee:443&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, Error, &quot;origin was malformatted&quot;);
	});

	it(&quot;throws if expected rpId is invalid type&quot;, function() {
		var exp = {
			rpId: 23,
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, Error, &quot;expected &#039;rpId&#039; should be string, got number&quot;);
	});

	it(&quot;throws if expected rpId is invalid&quot;, function() {
		var exp = {
			rpId: &quot;foobar&quot;,
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, Error, &quot;rpId is not a valid eTLD+1&quot;);
	});

	it(&quot;sets rpId properly on successful parsing&quot;, function() {
		var exp = {
			rpId: &quot;google.com&quot;,
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;,
		};
		var ret = parser.parseExpectations(exp);
		assert.strictEqual(ret.get(&quot;rpId&quot;), &quot;google.com&quot;);
		assert.strictEqual(ret.size, 3);
	});

	it(&quot;coerces Array challenge to base64url&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: [
				0xe0, 0x14, 0xb5, 0x60, 0x92, 0x91, 0x09, 0xe0, 0x95, 0xa0, 0xb7, 0x5f, 0x1b, 0xf6, 0xfa, 0xe8,
				0x1b, 0x92, 0x43, 0xe2, 0x36, 0x9f, 0x7e, 0x16, 0xb0, 0xb1, 0x6f, 0xcb, 0xad, 0x9f, 0xa4, 0x85,
				0x45, 0x8e, 0xb9, 0xb7, 0xdb, 0xfb, 0x45, 0x45, 0x08, 0xb1, 0x5f, 0xd5, 0x3c, 0x10, 0x15, 0x53,
				0xae, 0x24, 0xe4, 0xad, 0xe0, 0x29, 0xfb, 0x59, 0xc3, 0xbd, 0x86, 0xe8, 0x44, 0xaf, 0x56, 0x16,
			],
		};
		var base64UrlChallenge = &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;;
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), base64UrlChallenge);
	});


	it(&quot;coerces Uint8Array challenge to base64url&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: Uint8Array.from([
				0xe0, 0x14, 0xb5, 0x60, 0x92, 0x91, 0x09, 0xe0, 0x95, 0xa0, 0xb7, 0x5f, 0x1b, 0xf6, 0xfa, 0xe8,
				0x1b, 0x92, 0x43, 0xe2, 0x36, 0x9f, 0x7e, 0x16, 0xb0, 0xb1, 0x6f, 0xcb, 0xad, 0x9f, 0xa4, 0x85,
				0x45, 0x8e, 0xb9, 0xb7, 0xdb, 0xfb, 0x45, 0x45, 0x08, 0xb1, 0x5f, 0xd5, 0x3c, 0x10, 0x15, 0x53,
				0xae, 0x24, 0xe4, 0xad, 0xe0, 0x29, 0xfb, 0x59, 0xc3, 0xbd, 0x86, 0xe8, 0x44, 0xaf, 0x56, 0x16,
			]),
		};
		var base64UrlChallenge = &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;;
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), base64UrlChallenge);
	});

	it(&quot;coerces ArrayBuffer challenge to base64url&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: Uint8Array.from([
				0xe0, 0x14, 0xb5, 0x60, 0x92, 0x91, 0x09, 0xe0, 0x95, 0xa0, 0xb7, 0x5f, 0x1b, 0xf6, 0xfa, 0xe8,
				0x1b, 0x92, 0x43, 0xe2, 0x36, 0x9f, 0x7e, 0x16, 0xb0, 0xb1, 0x6f, 0xcb, 0xad, 0x9f, 0xa4, 0x85,
				0x45, 0x8e, 0xb9, 0xb7, 0xdb, 0xfb, 0x45, 0x45, 0x08, 0xb1, 0x5f, 0xd5, 0x3c, 0x10, 0x15, 0x53,
				0xae, 0x24, 0xe4, 0xad, 0xe0, 0x29, 0xfb, 0x59, 0xc3, 0xbd, 0x86, 0xe8, 0x44, 0xaf, 0x56, 0x16,
			]).buffer,
		};
		var base64UrlChallenge = &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;;
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), base64UrlChallenge);
	});

	it(&quot;coerces Buffer challenge to base64url&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: Buffer.from([
				0xe0, 0x14, 0xb5, 0x60, 0x92, 0x91, 0x09, 0xe0, 0x95, 0xa0, 0xb7, 0x5f, 0x1b, 0xf6, 0xfa, 0xe8,
				0x1b, 0x92, 0x43, 0xe2, 0x36, 0x9f, 0x7e, 0x16, 0xb0, 0xb1, 0x6f, 0xcb, 0xad, 0x9f, 0xa4, 0x85,
				0x45, 0x8e, 0xb9, 0xb7, 0xdb, 0xfb, 0x45, 0x45, 0x08, 0xb1, 0x5f, 0xd5, 0x3c, 0x10, 0x15, 0x53,
				0xae, 0x24, 0xe4, 0xad, 0xe0, 0x29, 0xfb, 0x59, 0xc3, 0xbd, 0x86, 0xe8, 0x44, 0xaf, 0x56, 0x16,
			]),
		};
		var base64UrlChallenge = &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;;
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), base64UrlChallenge);
	});

	it(&quot;coerces base64 challenge to base64url&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
		};
		var base64UrlChallenge = &quot;4BS1YJKRCeCVoLdfG_b66BuSQ-I2n34WsLFvy62fpIVFjrm32_tFRQixX9U8EBVTriTkreAp-1nDvYboRK9WFg&quot;;
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 2);
		assert.strictEqual(ret.get(&quot;origin&quot;), exp.origin);
		assert.strictEqual(ret.get(&quot;challenge&quot;), base64UrlChallenge);
	});

	it(&quot;empty expectations object returns empty map&quot;, function() {
		var exp = {};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 0);
	});

	it(&quot;adds flags to map when they exist&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			flags: new Set([&quot;UP&quot;, &quot;AT&quot;]),
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 3);
		var flags = ret.get(&quot;flags&quot;);
		assert.instanceOf(flags, Set);
		assert.strictEqual(flags.size, 2);
		assert.isTrue(flags.has(&quot;UP&quot;), &quot;flags has UP&quot;);
		assert.isTrue(flags.has(&quot;AT&quot;), &quot;flags has AT&quot;);
	});

	it(&quot;converts Array of flags to Set&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			flags: [&quot;UP&quot;, &quot;AT&quot;],
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 3);
		var flags = ret.get(&quot;flags&quot;);
		assert.instanceOf(flags, Set);
		assert.strictEqual(flags.size, 2);
		assert.isTrue(flags.has(&quot;UP&quot;), &quot;flags has UP&quot;);
		assert.isTrue(flags.has(&quot;AT&quot;), &quot;flags has AT&quot;);
	});

	it(&quot;throws if flags is something other than Array or Set&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			flags: &quot;foo&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, TypeError, &quot;expected flags to be an Array or a Set, got: string&quot;);
	});

	it(&quot;adds prevCount to map when it exists&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 666,
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 3);
		var prevCounter = ret.get(&quot;prevCounter&quot;);
		assert.isNumber(prevCounter);
		assert.strictEqual(prevCounter, 666);
	});

	it(&quot;adds prevCount to map when it&#039;s zero&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 3);
		var prevCounter = ret.get(&quot;prevCounter&quot;);
		assert.isNumber(prevCounter);
		assert.strictEqual(prevCounter, 0);
	});

	it(&quot;throws when prevCount is not a number&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: &quot;string&quot;,
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, TypeError, &quot;expected &#039;prevCounter&#039; should be Number, got string&quot;);
	});

	it(&quot;adds publicKey to map when it exists&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			publicKey: &quot;-----BEGIN PUBLIC KEY-----\n&quot; +
				&quot;MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAERez9aO2wBAWO54MuGbEqSdWahSnG\n&quot; +
				&quot;MAg35BCNkaE3j8Q+O/ZhhKqTeIKm7El70EG6ejt4sg1ZaoQ5ELg8k3ywTg==\n&quot; +
				&quot;-----END PUBLIC KEY-----\n&quot;,
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 3);
		var publicKey = ret.get(&quot;publicKey&quot;);
		assert.isString(publicKey);
		assert.strictEqual(publicKey, &quot;-----BEGIN PUBLIC KEY-----\n&quot; +
			&quot;MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAERez9aO2wBAWO54MuGbEqSdWahSnG\n&quot; +
			&quot;MAg35BCNkaE3j8Q+O/ZhhKqTeIKm7El70EG6ejt4sg1ZaoQ5ELg8k3ywTg==\n&quot; +
			&quot;-----END PUBLIC KEY-----\n&quot;);
	});


	it(&quot;throws when publicKey is not a string&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			publicKey: {},
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, TypeError, &quot;expected &#039;publicKey&#039; should be String, got object&quot;);
	});

	it(&quot;adds userHandle to map when it exists&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
			userHandle: &quot;YWs&quot;,
		};

		var ret = parser.parseExpectations(exp);
		var userHandle = ret.get(&quot;userHandle&quot;);
		assert.isString(userHandle);
		assert.strictEqual(userHandle.length, 3);
		userHandle = coerceToArrayBuffer(userHandle);
		var expectedUserHandle = new Uint8Array([
			0x61, 0x6B,
		]).buffer;

		assert.isTrue(abEqual(userHandle, expectedUserHandle), &quot;userHandle has correct value&quot;);
	});

	it(&quot;adds userHandle to map when null&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
			userHandle: null,
		};

		var ret = parser.parseExpectations(exp);
		var userHandle = ret.get(&quot;userHandle&quot;);
		assert.isNull(userHandle);
	});

	it(&quot;adds userHandle to map when empty string&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
			userHandle: &quot;&quot;,
		};

		var ret = parser.parseExpectations(exp);
		var userHandle = ret.get(&quot;userHandle&quot;);
		assert.isString(userHandle);
		assert.strictEqual(userHandle.length, 0);
		assert.strictEqual(userHandle, &quot;&quot;);
	});

	it(&quot;adds allowCredentials to map when it exists&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			allowCredentials: [{ id: &quot;dGVzdA==&quot;, transports: [&quot;usb&quot;], type: &quot;public-key&quot; }],
		};

		var ret = parser.parseExpectations(exp);
		var allowCredentials = ret.get(&quot;allowCredentials&quot;);
		assert.isArray(allowCredentials);
		assert.strictEqual(allowCredentials.length, 1);
		allowCredentials[0].id = coerceToArrayBuffer(allowCredentials[0].id);
		var expectedallowCredentialsId = new Uint8Array([
			0x74, 0x65, 0x73, 0x74,
		]).buffer;
		assert.isTrue(abEqual(allowCredentials[0].id, expectedallowCredentialsId), &quot;allowCredentials has correct value&quot;);
	});

	it(&quot;adds allowCredentials to map when null&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
			allowCredentials: null,
		};

		var ret = parser.parseExpectations(exp);
		var allowCredentials = ret.get(&quot;allowCredentials&quot;);
		assert.isNull(allowCredentials);
	});


	it(&quot;works when allowCredentials is undefined&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
		};

		var ret = parser.parseExpectations(exp);
		var allowCredentials = ret.get(&quot;allowCredentials&quot;);
		assert.isUndefined(allowCredentials);
	});

	it(&quot;works when userHandle is undefined&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			prevCounter: 0,
		};

		var ret = parser.parseExpectations(exp);
		var userHandle = ret.get(&quot;userHandle&quot;);
		assert.isUndefined(userHandle);
	});

	it(&quot;throws when allowCredentials is not a array&quot;, function() {
		var exp = {
			origin: &quot;https://webauthn.bin.coffee&quot;,
			challenge: &quot;4BS1YJKRCeCVoLdfG/b66BuSQ+I2n34WsLFvy62fpIVFjrm32/tFRQixX9U8EBVTriTkreAp+1nDvYboRK9WFg&quot;,
			publicKey: &quot;-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAESe3kuy9dZzFYR/uw+exFJxKLt6E+\n3Sp0RamB8J63CxYnbRhv6SF6MwQx/LNHJHw7rrN2xioEu88ArEDdk0jHAQ==\n-----END PUBLIC KEY-----\n&quot;,
			allowCredentials: {},
		};
		assert.throws(() =&gt; {
			parser.parseExpectations(exp);
		}, TypeError, &quot;expected &#039;allowCredentials&#039; to be null or array, got object&quot;);
	});

	it(&quot;works with typical attestation expectations&quot;, function() {
		var exp = {
			challenge: &quot;HcsOvH431SaLt1hc7mpkqohMaub+oTO5ao/hzJOkUwQEdTWDhOYTdp4ejQcOCsIYdB64c1fkeqiblg6EkygpUA==&quot;,
			origin: &quot;https://localhost:8443&quot;,
			publicKey: &quot;-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAESe3kuy9dZzFYR/uw+exFJxKLt6E+\n3Sp0RamB8J63CxYnbRhv6SF6MwQx/LNHJHw7rrN2xioEu88ArEDdk0jHAQ==\n-----END PUBLIC KEY-----\n&quot;,
			prevCounter: 0,
			flags: [&quot;UP-or-UV&quot;],
		};
		var ret = parser.parseExpectations(exp);
		assert.instanceOf(ret, Map);
		assert.strictEqual(ret.size, 5);
	});
});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
