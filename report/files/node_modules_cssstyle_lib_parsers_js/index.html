<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/cssstyle/lib/parsers.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/cssstyle/lib/parsers.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">53.98</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">538</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">67.68</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.24</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/**
 * These are commonly used parsers for CSS Values they take a string to parse
 * and return a string after it&#039;s been converted, if needed
 */
&quot;use strict&quot;;

const { resolve: resolveColor, utils } = require(&quot;@asamuzakjp/css-color&quot;);
const { asciiLowercase } = require(&quot;./utils/strings&quot;);

const { cssCalc, isColor, isGradient, splitValue } = utils;

// CSS global values
// @see https://drafts.csswg.org/css-cascade-5/#defaulting-keywords
const GLOBAL_VALUE = Object.freeze([&quot;initial&quot;, &quot;inherit&quot;, &quot;unset&quot;, &quot;revert&quot;, &quot;revert-layer&quot;]);

// Numeric data types
const NUM_TYPE = Object.freeze({
  UNDEFINED: 0,
  VAR: 1,
  NUMBER: 2,
  PERCENT: 4,
  LENGTH: 8,
  ANGLE: 0x10,
  CALC: 0x20
});

// System colors
// @see https://drafts.csswg.org/css-color/#css-system-colors
// @see https://drafts.csswg.org/css-color/#deprecated-system-colors
const SYS_COLOR = Object.freeze([
  &quot;accentcolor&quot;,
  &quot;accentcolortext&quot;,
  &quot;activeborder&quot;,
  &quot;activecaption&quot;,
  &quot;activetext&quot;,
  &quot;appworkspace&quot;,
  &quot;background&quot;,
  &quot;buttonborder&quot;,
  &quot;buttonface&quot;,
  &quot;buttonhighlight&quot;,
  &quot;buttonshadow&quot;,
  &quot;buttontext&quot;,
  &quot;canvas&quot;,
  &quot;canvastext&quot;,
  &quot;captiontext&quot;,
  &quot;field&quot;,
  &quot;fieldtext&quot;,
  &quot;graytext&quot;,
  &quot;highlight&quot;,
  &quot;highlighttext&quot;,
  &quot;inactiveborder&quot;,
  &quot;inactivecaption&quot;,
  &quot;inactivecaptiontext&quot;,
  &quot;infobackground&quot;,
  &quot;infotext&quot;,
  &quot;linktext&quot;,
  &quot;mark&quot;,
  &quot;marktext&quot;,
  &quot;menu&quot;,
  &quot;menutext&quot;,
  &quot;scrollbar&quot;,
  &quot;selecteditem&quot;,
  &quot;selecteditemtext&quot;,
  &quot;threeddarkshadow&quot;,
  &quot;threedface&quot;,
  &quot;threedhighlight&quot;,
  &quot;threedlightshadow&quot;,
  &quot;threedshadow&quot;,
  &quot;visitedtext&quot;,
  &quot;window&quot;,
  &quot;windowframe&quot;,
  &quot;windowtext&quot;
]);

// Regular expressions
const DIGIT = &quot;(?:0|[1-9]\\d*)&quot;;
const NUMBER = `[+-]?(?:${DIGIT}(?:\\.\\d*)?|\\.\\d+)(?:e-?${DIGIT})?`;
const unitRegEx = new RegExp(`^(${NUMBER})([a-z]+|%)?$`, &quot;i&quot;);
const urlRegEx = /^url\(\s*((?:[^)]|\\\))*)\s*\)$/;
const keywordRegEx = /^[a-z]+(?:-[a-z]+)*$/i;
const stringRegEx = /^(&quot;[^&quot;]*&quot;|&#039;[^&#039;]*&#039;)$/;
const varRegEx = /^var\(/;
const varContainedRegEx = /(?&lt;=[*/\s(])var\(/;
const calcRegEx =
  /^(?:a?(?:cos|sin|tan)|abs|atan2|calc|clamp|exp|hypot|log|max|min|mod|pow|rem|round|sign|sqrt)\(/;
const functionRegEx = /^([a-z][a-z\d]*(?:-[a-z\d]+)*)\(/i;

const getNumericType = function getNumericType(val) {
  if (varRegEx.test(val)) {
    return NUM_TYPE.VAR;
  }
  if (calcRegEx.test(val)) {
    return NUM_TYPE.CALC;
  }
  if (unitRegEx.test(val)) {
    const [, , unit] = unitRegEx.exec(val);
    if (!unit) {
      return NUM_TYPE.NUMBER;
    }
    if (unit === &quot;%&quot;) {
      return NUM_TYPE.PERCENT;
    }
    if (/^(?:[cm]m|[dls]?v(?:[bhiw]|max|min)|in|p[ctx]|q|r?(?:[cl]h|cap|e[mx]|ic))$/i.test(unit)) {
      return NUM_TYPE.LENGTH;
    }
    if (/^(?:deg|g?rad|turn)$/i.test(unit)) {
      return NUM_TYPE.ANGLE;
    }
  }
  return NUM_TYPE.UNDEFINED;
};

// Prepare stringified value.
exports.prepareValue = function prepareValue(value, globalObject = globalThis) {
  // `null` is converted to an empty string.
  // @see https://webidl.spec.whatwg.org/#LegacyNullToEmptyString
  if (value === null) {
    return &quot;&quot;;
  }
  const type = typeof value;
  switch (type) {
    case &quot;string&quot;:
      return value.trim();
    case &quot;number&quot;:
      return value.toString();
    case &quot;undefined&quot;:
      return &quot;undefined&quot;;
    case &quot;symbol&quot;:
      throw new globalObject.TypeError(&quot;Can not convert symbol to string.&quot;);
    default: {
      const str = value.toString();
      if (typeof str === &quot;string&quot;) {
        return str;
      }
      throw new globalObject.TypeError(`Can not convert ${type} to string.`);
    }
  }
};

exports.hasVarFunc = function hasVarFunc(val) {
  return varRegEx.test(val) || varContainedRegEx.test(val);
};

exports.parseNumber = function parseNumber(val, restrictToPositive = false) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  const type = getNumericType(val);
  switch (type) {
    case NUM_TYPE.VAR:
      return val;
    case NUM_TYPE.CALC:
      return cssCalc(val, {
        format: &quot;specifiedValue&quot;
      });
    case NUM_TYPE.NUMBER: {
      const num = parseFloat(val);
      if (restrictToPositive &amp;&amp; num &lt; 0) {
        return;
      }
      return `${num}`;
    }
    default:
      if (varContainedRegEx.test(val)) {
        return val;
      }
  }
};

exports.parseLength = function parseLength(val, restrictToPositive = false) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  const type = getNumericType(val);
  switch (type) {
    case NUM_TYPE.VAR:
      return val;
    case NUM_TYPE.CALC:
      return cssCalc(val, {
        format: &quot;specifiedValue&quot;
      });
    case NUM_TYPE.NUMBER:
      if (parseFloat(val) === 0) {
        return &quot;0px&quot;;
      }
      return;
    case NUM_TYPE.LENGTH: {
      const [, numVal, unit] = unitRegEx.exec(val);
      const num = parseFloat(numVal);
      if (restrictToPositive &amp;&amp; num &lt; 0) {
        return;
      }
      return `${num}${asciiLowercase(unit)}`;
    }
    default:
      if (varContainedRegEx.test(val)) {
        return val;
      }
  }
};

exports.parsePercent = function parsePercent(val, restrictToPositive = false) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  const type = getNumericType(val);
  switch (type) {
    case NUM_TYPE.VAR:
      return val;
    case NUM_TYPE.CALC:
      return cssCalc(val, {
        format: &quot;specifiedValue&quot;
      });
    case NUM_TYPE.NUMBER:
      if (parseFloat(val) === 0) {
        return &quot;0%&quot;;
      }
      return;
    case NUM_TYPE.PERCENT: {
      const [, numVal, unit] = unitRegEx.exec(val);
      const num = parseFloat(numVal);
      if (restrictToPositive &amp;&amp; num &lt; 0) {
        return;
      }
      return `${num}${asciiLowercase(unit)}`;
    }
    default:
      if (varContainedRegEx.test(val)) {
        return val;
      }
  }
};

// Either a length or a percent.
exports.parseMeasurement = function parseMeasurement(val, restrictToPositive = false) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  const type = getNumericType(val);
  switch (type) {
    case NUM_TYPE.VAR:
      return val;
    case NUM_TYPE.CALC:
      return cssCalc(val, {
        format: &quot;specifiedValue&quot;
      });
    case NUM_TYPE.NUMBER:
      if (parseFloat(val) === 0) {
        return &quot;0px&quot;;
      }
      return;
    case NUM_TYPE.LENGTH:
    case NUM_TYPE.PERCENT: {
      const [, numVal, unit] = unitRegEx.exec(val);
      const num = parseFloat(numVal);
      if (restrictToPositive &amp;&amp; num &lt; 0) {
        return;
      }
      return `${num}${asciiLowercase(unit)}`;
    }
    default:
      if (varContainedRegEx.test(val)) {
        return val;
      }
  }
};

exports.parseAngle = function parseAngle(val, normalizeDeg = false) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  const type = getNumericType(val);
  switch (type) {
    case NUM_TYPE.VAR:
      return val;
    case NUM_TYPE.CALC:
      return cssCalc(val, {
        format: &quot;specifiedValue&quot;
      });
    case NUM_TYPE.NUMBER:
      if (parseFloat(val) === 0) {
        return &quot;0deg&quot;;
      }
      return;
    case NUM_TYPE.ANGLE: {
      let [, numVal, unit] = unitRegEx.exec(val);
      numVal = parseFloat(numVal);
      unit = asciiLowercase(unit);
      if (unit === &quot;deg&quot;) {
        if (normalizeDeg &amp;&amp; numVal &lt; 0) {
          while (numVal &lt; 0) {
            numVal += 360;
          }
        }
        numVal %= 360;
      }
      return `${numVal}${unit}`;
    }
    default:
      if (varContainedRegEx.test(val)) {
        return val;
      }
  }
};

exports.parseUrl = function parseUrl(val) {
  if (val === &quot;&quot;) {
    return val;
  }
  const res = urlRegEx.exec(val);
  if (!res) {
    return;
  }
  let str = res[1];
  // If it starts with single or double quotes, does it end with the same?
  if ((str[0] === &#039;&quot;&#039; || str[0] === &quot;&#039;&quot;) &amp;&amp; str[0] !== str[str.length - 1]) {
    return;
  }
  if (str[0] === &#039;&quot;&#039; || str[0] === &quot;&#039;&quot;) {
    str = str.substr(1, str.length - 2);
  }
  let urlstr = &quot;&quot;;
  let escaped = false;
  for (let i = 0; i &lt; str.length; i++) {
    switch (str[i]) {
      case &quot;\\&quot;:
        if (escaped) {
          urlstr += &quot;\\\\&quot;;
          escaped = false;
        } else {
          escaped = true;
        }
        break;
      case &quot;(&quot;:
      case &quot;)&quot;:
      case &quot; &quot;:
      case &quot;\t&quot;:
      case &quot;\n&quot;:
      case &quot;&#039;&quot;:
        if (!escaped) {
          return;
        }
        urlstr += str[i];
        escaped = false;
        break;
      case &#039;&quot;&#039;:
        if (!escaped) {
          return;
        }
        urlstr += &#039;\\&quot;&#039;;
        escaped = false;
        break;
      default:
        urlstr += str[i];
        escaped = false;
    }
  }
  return `url(&quot;${urlstr}&quot;)`;
};

exports.parseString = function parseString(val) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  if (!stringRegEx.test(val)) {
    return;
  }
  val = val.substr(1, val.length - 2);
  let str = &quot;&quot;;
  let escaped = false;
  for (let i = 0; i &lt; val.length; i++) {
    switch (val[i]) {
      case &quot;\\&quot;:
        if (escaped) {
          str += &quot;\\\\&quot;;
          escaped = false;
        } else {
          escaped = true;
        }
        break;
      case &#039;&quot;&#039;:
        str += &#039;\\&quot;&#039;;
        escaped = false;
        break;
      default:
        str += val[i];
        escaped = false;
    }
  }
  return `&quot;${str}&quot;`;
};

exports.parseKeyword = function parseKeyword(val, validKeywords = []) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  if (varRegEx.test(val)) {
    return val;
  }
  val = asciiLowercase(val.toString());
  if (validKeywords.includes(val) || GLOBAL_VALUE.includes(val)) {
    return val;
  }
};

exports.parseColor = function parseColor(val) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  if (varRegEx.test(val)) {
    return val;
  }
  if (/^[a-z]+$/i.test(val)) {
    const v = asciiLowercase(val);
    if (SYS_COLOR.includes(v)) {
      return v;
    }
  }
  const res = resolveColor(val, {
    format: &quot;specifiedValue&quot;
  });
  if (res) {
    return res;
  }
  return exports.parseKeyword(val);
};

exports.parseImage = function parseImage(val) {
  if (val === &quot;&quot;) {
    return &quot;&quot;;
  }
  if (varRegEx.test(val)) {
    return val;
  }
  if (keywordRegEx.test(val)) {
    return exports.parseKeyword(val, [&quot;none&quot;]);
  }
  const values = splitValue(val, {
    delimiter: &quot;,&quot;,
    preserveComment: varContainedRegEx.test(val)
  });
  let isImage = Boolean(values.length);
  for (let i = 0; i &lt; values.length; i++) {
    const image = values[i];
    if (image === &quot;&quot;) {
      return &quot;&quot;;
    }
    if (isGradient(image) || /^(?:none|inherit)$/i.test(image)) {
      continue;
    }
    const imageUrl = exports.parseUrl(image);
    if (imageUrl) {
      values[i] = imageUrl;
    } else {
      isImage = false;
      break;
    }
  }
  if (isImage) {
    return values.join(&quot;, &quot;);
  }
};

exports.parseFunction = function parseFunction(val) {
  if (val === &quot;&quot;) {
    return {
      name: null,
      value: &quot;&quot;
    };
  }
  if (functionRegEx.test(val) &amp;&amp; val.endsWith(&quot;)&quot;)) {
    if (varRegEx.test(val) || varContainedRegEx.test(val)) {
      return {
        name: &quot;var&quot;,
        value: val
      };
    }
    const [, name] = functionRegEx.exec(val);
    const value = val
      .replace(new RegExp(`^${name}\\(`), &quot;&quot;)
      .replace(/\)$/, &quot;&quot;)
      .trim();
    return {
      name,
      value
    };
  }
};

exports.parseShorthand = function parseShorthand(val, shorthandFor, preserve = false) {
  const obj = {};
  if (val === &quot;&quot; || exports.hasVarFunc(val)) {
    for (const [property] of shorthandFor) {
      obj[property] = &quot;&quot;;
    }
    return obj;
  }
  const key = exports.parseKeyword(val);
  if (key) {
    if (key === &quot;inherit&quot;) {
      return obj;
    }
    return;
  }
  const parts = splitValue(val);
  const shorthandArr = [...shorthandFor];
  for (const part of parts) {
    let partValid = false;
    for (let i = 0; i &lt; shorthandArr.length; i++) {
      const [property, value] = shorthandArr[i];
      if (value.isValid(part)) {
        partValid = true;
        obj[property] = value.parse(part);
        if (!preserve) {
          shorthandArr.splice(i, 1);
          break;
        }
      }
    }
    if (!partValid) {
      return;
    }
  }
  return obj;
};

// Returns `false` for global values, e.g. &quot;inherit&quot;.
exports.isValidColor = function isValidColor(val) {
  if (SYS_COLOR.includes(asciiLowercase(val))) {
    return true;
  }
  return isColor(val);
};

// Splits value into an array.
// @see https://github.com/asamuzaK/cssColor/blob/main/src/js/util.ts
exports.splitValue = splitValue;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
