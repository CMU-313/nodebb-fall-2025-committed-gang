<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/resolve/test/resolver.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/resolve/test/resolver.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">72.73</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">598</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">98.90</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">8.28</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var path = require(&#039;path&#039;);
var fs = require(&#039;fs&#039;);
var test = require(&#039;tape&#039;);
var resolve = require(&#039;../&#039;);
var async = require(&#039;../async&#039;);

test(&#039;`./async` entry point&#039;, function (t) {
    t.equal(resolve, async, &#039;`./async` entry point is the same as `main`&#039;);
    t.end();
});

test(&#039;async foo&#039;, function (t) {
    t.plan(12);
    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./foo&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo.js&#039;));
        t.equal(pkg &amp;&amp; pkg.name, &#039;resolve&#039;);
    });

    resolve(&#039;./foo.js&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo.js&#039;));
        t.equal(pkg &amp;&amp; pkg.name, &#039;resolve&#039;);
    });

    resolve(&#039;./foo&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;resolver&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo.js&#039;));
        t.equal(pkg &amp;&amp; pkg.main, &#039;resolver&#039;);
    });

    resolve(&#039;./foo.js&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;resolver&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo.js&#039;));
        t.equal(pkg.main, &#039;resolver&#039;);
    });

    resolve(&#039;./foo&#039;, { basedir: dir, filename: path.join(dir, &#039;baz.js&#039;) }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo.js&#039;));
    });

    resolve(&#039;foo&#039;, { basedir: dir }, function (err) {
        t.equal(err.message, &quot;Cannot find module &#039;foo&#039; from &#039;&quot; + path.resolve(dir) + &quot;&#039;&quot;);
        t.equal(err.code, &#039;MODULE_NOT_FOUND&#039;);
    });

    // Test that filename is reported as the &quot;from&quot; value when passed.
    resolve(&#039;foo&#039;, { basedir: dir, filename: path.join(dir, &#039;baz.js&#039;) }, function (err) {
        t.equal(err.message, &quot;Cannot find module &#039;foo&#039; from &#039;&quot; + path.join(dir, &#039;baz.js&#039;) + &quot;&#039;&quot;);
    });
});

test(&#039;bar&#039;, function (t) {
    t.plan(6);
    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;foo&#039;, { basedir: dir + &#039;/bar&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;bar/node_modules/foo/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;foo&#039;, { basedir: dir + &#039;/bar&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;bar/node_modules/foo/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;foo&#039;, { basedir: dir + &#039;/bar&#039;, &#039;package&#039;: { main: &#039;bar&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;bar/node_modules/foo/index.js&#039;));
        t.equal(pkg.main, &#039;bar&#039;);
    });
});

test(&#039;baz&#039;, function (t) {
    t.plan(4);
    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./baz&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;baz/quux.js&#039;));
        t.equal(pkg.main, &#039;quux.js&#039;);
    });

    resolve(&#039;./baz&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;resolver&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;baz/quux.js&#039;));
        t.equal(pkg.main, &#039;quux.js&#039;);
    });
});

test(&#039;biz&#039;, function (t) {
    t.plan(24);
    var dir = path.join(__dirname, &#039;resolver/biz/node_modules&#039;);

    resolve(&#039;./grux&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;grux/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;./grux&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;biz&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;grux/index.js&#039;));
        t.equal(pkg.main, &#039;biz&#039;);
    });

    resolve(&#039;./garply&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;garply/lib/index.js&#039;));
        t.equal(pkg.main, &#039;./lib&#039;);
    });

    resolve(&#039;./garply&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;biz&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;garply/lib/index.js&#039;));
        t.equal(pkg.main, &#039;./lib&#039;);
    });

    resolve(&#039;tiv&#039;, { basedir: dir + &#039;/grux&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;tiv/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;tiv&#039;, { basedir: dir + &#039;/grux&#039;, &#039;package&#039;: { main: &#039;grux&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;tiv/index.js&#039;));
        t.equal(pkg.main, &#039;grux&#039;);
    });

    resolve(&#039;tiv&#039;, { basedir: dir + &#039;/garply&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;tiv/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;tiv&#039;, { basedir: dir + &#039;/garply&#039;, &#039;package&#039;: { main: &#039;./lib&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;tiv/index.js&#039;));
        t.equal(pkg.main, &#039;./lib&#039;);
    });

    resolve(&#039;grux&#039;, { basedir: dir + &#039;/tiv&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;grux/index.js&#039;));
        t.equal(pkg, undefined);
    });

    resolve(&#039;grux&#039;, { basedir: dir + &#039;/tiv&#039;, &#039;package&#039;: { main: &#039;tiv&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;grux/index.js&#039;));
        t.equal(pkg.main, &#039;tiv&#039;);
    });

    resolve(&#039;garply&#039;, { basedir: dir + &#039;/tiv&#039; }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;garply/lib/index.js&#039;));
        t.equal(pkg.main, &#039;./lib&#039;);
    });

    resolve(&#039;garply&#039;, { basedir: dir + &#039;/tiv&#039;, &#039;package&#039;: { main: &#039;tiv&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;garply/lib/index.js&#039;));
        t.equal(pkg.main, &#039;./lib&#039;);
    });
});

test(&#039;quux&#039;, function (t) {
    t.plan(2);
    var dir = path.join(__dirname, &#039;resolver/quux&#039;);

    resolve(&#039;./foo&#039;, { basedir: dir, &#039;package&#039;: { main: &#039;quux&#039; } }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;foo/index.js&#039;));
        t.equal(pkg.main, &#039;quux&#039;);
    });
});

test(&#039;normalize&#039;, function (t) {
    t.plan(2);
    var dir = path.join(__dirname, &#039;resolver/biz/node_modules/grux&#039;);

    resolve(&#039;../grux&#039;, { basedir: dir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;index.js&#039;));
        t.equal(pkg, undefined);
    });
});

test(&#039;cup&#039;, function (t) {
    t.plan(5);
    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./cup&#039;, { basedir: dir, extensions: [&#039;.js&#039;, &#039;.coffee&#039;] }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;cup.coffee&#039;));
    });

    resolve(&#039;./cup.coffee&#039;, { basedir: dir }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;cup.coffee&#039;));
    });

    resolve(&#039;./cup&#039;, { basedir: dir, extensions: [&#039;.js&#039;] }, function (err, res) {
        t.equal(err.message, &quot;Cannot find module &#039;./cup&#039; from &#039;&quot; + path.resolve(dir) + &quot;&#039;&quot;);
        t.equal(err.code, &#039;MODULE_NOT_FOUND&#039;);
    });

    // Test that filename is reported as the &quot;from&quot; value when passed.
    resolve(&#039;./cup&#039;, { basedir: dir, extensions: [&#039;.js&#039;], filename: path.join(dir, &#039;cupboard.js&#039;) }, function (err, res) {
        t.equal(err.message, &quot;Cannot find module &#039;./cup&#039; from &#039;&quot; + path.join(dir, &#039;cupboard.js&#039;) + &quot;&#039;&quot;);
    });
});

test(&#039;mug&#039;, function (t) {
    t.plan(3);
    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./mug&#039;, { basedir: dir }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;mug.js&#039;));
    });

    resolve(&#039;./mug&#039;, { basedir: dir, extensions: [&#039;.coffee&#039;, &#039;.js&#039;] }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;/mug.coffee&#039;));
    });

    resolve(&#039;./mug&#039;, { basedir: dir, extensions: [&#039;.js&#039;, &#039;.coffee&#039;] }, function (err, res) {
        t.equal(res, path.join(dir, &#039;/mug.js&#039;));
    });
});

test(&#039;other path&#039;, function (t) {
    t.plan(6);
    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(resolverDir, &#039;bar&#039;);
    var otherDir = path.join(resolverDir, &#039;other_path&#039;);

    resolve(&#039;root&#039;, { basedir: dir, paths: [otherDir] }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(resolverDir, &#039;other_path/root.js&#039;));
    });

    resolve(&#039;lib/other-lib&#039;, { basedir: dir, paths: [otherDir] }, function (err, res) {
        if (err) t.fail(err);
        t.equal(res, path.join(resolverDir, &#039;other_path/lib/other-lib.js&#039;));
    });

    resolve(&#039;root&#039;, { basedir: dir }, function (err, res) {
        t.equal(err.message, &quot;Cannot find module &#039;root&#039; from &#039;&quot; + path.resolve(dir) + &quot;&#039;&quot;);
        t.equal(err.code, &#039;MODULE_NOT_FOUND&#039;);
    });

    resolve(&#039;zzz&#039;, { basedir: dir, paths: [otherDir] }, function (err, res) {
        t.equal(err.message, &quot;Cannot find module &#039;zzz&#039; from &#039;&quot; + path.resolve(dir) + &quot;&#039;&quot;);
        t.equal(err.code, &#039;MODULE_NOT_FOUND&#039;);
    });
});

test(&#039;path iterator&#039;, function (t) {
    t.plan(2);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    var exactIterator = function (x, start, getPackageCandidates, opts) {
        return [path.join(resolverDir, x)];
    };

    resolve(&#039;baz&#039;, { packageIterator: exactIterator }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(resolverDir, &#039;baz/quux.js&#039;));
        t.equal(pkg &amp;&amp; pkg.name, &#039;baz&#039;);
    });
});

test(&#039;incorrect main&#039;, function (t) {
    t.plan(1);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(resolverDir, &#039;incorrect_main&#039;);

    resolve(&#039;./incorrect_main&#039;, { basedir: resolverDir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;index.js&#039;));
    });
});

test(&#039;missing index&#039;, function (t) {
    t.plan(2);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);
    resolve(&#039;./missing_index&#039;, { basedir: resolverDir }, function (err, res, pkg) {
        t.ok(err instanceof Error);
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    });
});

test(&#039;missing main&#039;, function (t) {
    t.plan(1);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./missing_main&#039;, { basedir: resolverDir }, function (err, res, pkg) {
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    });
});

test(&#039;null main&#039;, function (t) {
    t.plan(1);

    var resolverDir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./null_main&#039;, { basedir: resolverDir }, function (err, res, pkg) {
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error has correct error code&#039;);
    });
});

test(&#039;main: false&#039;, function (t) {
    t.plan(2);

    var basedir = path.join(__dirname, &#039;resolver&#039;);
    var dir = path.join(basedir, &#039;false_main&#039;);
    resolve(&#039;./false_main&#039;, { basedir: basedir }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(
            res,
            path.join(dir, &#039;index.js&#039;),
            &#039;`&quot;main&quot;: false`: resolves to `index.js`&#039;
        );
        t.deepEqual(pkg, {
            name: &#039;false_main&#039;,
            main: false
        });
    });
});

test(&#039;without basedir&#039;, function (t) {
    t.plan(1);

    var dir = path.join(__dirname, &#039;resolver/without_basedir&#039;);
    var tester = require(path.join(dir, &#039;main.js&#039;)); // eslint-disable-line global-require

    tester(t, function (err, res, pkg) {
        if (err) {
            t.fail(err);
        } else {
            t.equal(res, path.join(dir, &#039;node_modules/mymodule.js&#039;));
        }
    });
});

test(&#039;#52 - incorrectly resolves module-paths like &quot;./someFolder/&quot; when there is a file of the same name&#039;, function (t) {
    t.plan(2);

    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./foo&#039;, { basedir: path.join(dir, &#039;same_names&#039;) }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;same_names/foo.js&#039;));
    });

    resolve(&#039;./foo/&#039;, { basedir: path.join(dir, &#039;same_names&#039;) }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;same_names/foo/index.js&#039;));
    });
});

test(&#039;#211 - incorrectly resolves module-paths like &quot;.&quot; when from inside a folder with a sibling file of the same name&#039;, function (t) {
    t.plan(2);

    var dir = path.join(__dirname, &#039;resolver&#039;);

    resolve(&#039;./&#039;, { basedir: path.join(dir, &#039;same_names/foo&#039;) }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;same_names/foo/index.js&#039;));
    });

    resolve(&#039;.&#039;, { basedir: path.join(dir, &#039;same_names/foo&#039;) }, function (err, res, pkg) {
        if (err) t.fail(err);
        t.equal(res, path.join(dir, &#039;same_names/foo/index.js&#039;));
    });
});

test(&#039;async: #121 - treating an existing file as a dir when no basedir&#039;, function (t) {
    var testFile = path.basename(__filename);

    t.test(&#039;sanity check&#039;, function (st) {
        st.plan(1);
        resolve(&#039;./&#039; + testFile, function (err, res, pkg) {
            if (err) t.fail(err);
            st.equal(res, __filename, &#039;sanity check&#039;);
        });
    });

    t.test(&#039;with a fake directory&#039;, function (st) {
        st.plan(4);

        resolve(&#039;./&#039; + testFile + &#039;/blah&#039;, function (err, res, pkg) {
            st.ok(err, &#039;there is an error&#039;);
            st.notOk(res, &#039;no result&#039;);

            st.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;, &#039;error code matches require.resolve&#039;);
            st.equal(
                err &amp;&amp; err.message,
                &#039;Cannot find module \&#039;./&#039; + testFile + &#039;/blah\&#039; from \&#039;&#039; + __dirname + &#039;\&#039;&#039;,
                &#039;can not find nonexistent module&#039;
            );
            st.end();
        });
    });

    t.end();
});

test(&#039;async dot main&#039;, function (t) {
    var start = new Date();
    t.plan(3);
    resolve(&#039;./resolver/dot_main&#039;, function (err, ret) {
        t.notOk(err);
        t.equal(ret, path.join(__dirname, &#039;resolver/dot_main/index.js&#039;));
        t.ok(new Date() - start &lt; 50, &#039;resolve.sync timedout&#039;);
        t.end();
    });
});

test(&#039;async dot slash main&#039;, function (t) {
    var start = new Date();
    t.plan(3);
    resolve(&#039;./resolver/dot_slash_main&#039;, function (err, ret) {
        t.notOk(err);
        t.equal(ret, path.join(__dirname, &#039;resolver/dot_slash_main/index.js&#039;));
        t.ok(new Date() - start &lt; 50, &#039;resolve.sync timedout&#039;);
        t.end();
    });
});

test(&#039;not a directory&#039;, function (t) {
    t.plan(6);
    var path = &#039;./foo&#039;;
    resolve(path, { basedir: __filename }, function (err, res, pkg) {
        t.ok(err, &#039;a non-directory errors&#039;);
        t.equal(arguments.length, 1);
        t.equal(res, undefined);
        t.equal(pkg, undefined);

        t.equal(err &amp;&amp; err.message, &#039;Cannot find module \&#039;&#039; + path + &#039;\&#039; from \&#039;&#039; + __filename + &#039;\&#039;&#039;);
        t.equal(err &amp;&amp; err.code, &#039;MODULE_NOT_FOUND&#039;);
    });
});

test(&#039;non-string &quot;main&quot; field in package.json&#039;, function (t) {
    t.plan(5);

    var dir = path.join(__dirname, &#039;resolver&#039;);
    resolve(&#039;./invalid_main&#039;, { basedir: dir }, function (err, res, pkg) {
        t.ok(err, &#039;errors on non-string main&#039;);
        t.equal(err.message, &#039;package “invalid_main” `main` must be a string&#039;);
        t.equal(err.code, &#039;INVALID_PACKAGE_MAIN&#039;);
        t.equal(res, undefined, &#039;res is undefined&#039;);
        t.equal(pkg, undefined, &#039;pkg is undefined&#039;);
    });
});

test(&#039;non-string &quot;main&quot; field in package.json&#039;, function (t) {
    t.plan(5);

    var dir = path.join(__dirname, &#039;resolver&#039;);
    resolve(&#039;./invalid_main&#039;, { basedir: dir }, function (err, res, pkg) {
        t.ok(err, &#039;errors on non-string main&#039;);
        t.equal(err.message, &#039;package “invalid_main” `main` must be a string&#039;);
        t.equal(err.code, &#039;INVALID_PACKAGE_MAIN&#039;);
        t.equal(res, undefined, &#039;res is undefined&#039;);
        t.equal(pkg, undefined, &#039;pkg is undefined&#039;);
    });
});

test(&#039;browser field in package.json&#039;, function (t) {
    t.plan(3);

    var dir = path.join(__dirname, &#039;resolver&#039;);
    resolve(
        &#039;./browser_field&#039;,
        {
            basedir: dir,
            packageFilter: function packageFilter(pkg) {
                if (pkg.browser) {
                    pkg.main = pkg.browser; // eslint-disable-line no-param-reassign
                    delete pkg.browser; // eslint-disable-line no-param-reassign
                }
                return pkg;
            }
        },
        function (err, res, pkg) {
            if (err) t.fail(err);
            t.equal(res, path.join(dir, &#039;browser_field&#039;, &#039;b.js&#039;));
            t.equal(pkg &amp;&amp; pkg.main, &#039;b&#039;);
            t.equal(pkg &amp;&amp; pkg.browser, undefined);
        }
    );
});

test(&#039;absolute paths&#039;, function (t) {
    t.plan(4);

    var extensionless = __filename.slice(0, -path.extname(__filename).length);

    resolve(__filename, function (err, res) {
        t.equal(
            res,
            __filename,
            &#039;absolute path to this file resolves&#039;
        );
    });
    resolve(extensionless, function (err, res) {
        t.equal(
            res,
            __filename,
            &#039;extensionless absolute path to this file resolves&#039;
        );
    });
    resolve(__filename, { basedir: process.cwd() }, function (err, res) {
        t.equal(
            res,
            __filename,
            &#039;absolute path to this file with a basedir resolves&#039;
        );
    });
    resolve(extensionless, { basedir: process.cwd() }, function (err, res) {
        t.equal(
            res,
            __filename,
            &#039;extensionless absolute path to this file with a basedir resolves&#039;
        );
    });
});

var malformedDir = path.join(__dirname, &#039;resolver/malformed_package_json&#039;);
test(&#039;malformed package.json&#039;, { skip: !fs.existsSync(malformedDir) }, function (t) {
    /* eslint operator-linebreak: [&quot;error&quot;, &quot;before&quot;], function-paren-newline: &quot;off&quot; */
    t.plan(
        (3 * 3) // 3 sets of 3 assertions in the final callback
        + 2 // 1 readPackage call with malformed package.json
    );

    var basedir = malformedDir;
    var expected = path.join(basedir, &#039;index.js&#039;);

    resolve(&#039;./index.js&#039;, { basedir: basedir }, function (err, res, pkg) {
        t.error(err, &#039;no error&#039;);
        t.equal(res, expected, &#039;malformed package.json is silently ignored&#039;);
        t.equal(pkg, undefined, &#039;malformed package.json gives an undefined `pkg` argument&#039;);
    });

    resolve(
        &#039;./index.js&#039;,
        {
            basedir: basedir,
            packageFilter: function (pkg, pkgfile, dir) {
                t.fail(&#039;should not reach here&#039;);
            }
        },
        function (err, res, pkg) {
            t.error(err, &#039;with packageFilter: no error&#039;);
            t.equal(res, expected, &#039;with packageFilter: malformed package.json is silently ignored&#039;);
            t.equal(pkg, undefined, &#039;with packageFilter: malformed package.json gives an undefined `pkg` argument&#039;);
        }
    );

    resolve(
        &#039;./index.js&#039;,
        {
            basedir: basedir,
            readPackage: function (readFile, pkgfile, cb) {
                t.equal(pkgfile, path.join(basedir, &#039;package.json&#039;), &#039;readPackageSync: `pkgfile` is package.json path&#039;);
                readFile(pkgfile, function (err, result) {
                    try {
                        cb(null, JSON.parse(result));
                    } catch (e) {
                        t.ok(e instanceof SyntaxError, &#039;readPackage: malformed package.json parses as a syntax error&#039;);
                        cb(null);
                    }
                });
            }
        },
        function (err, res, pkg) {
            t.error(err, &#039;with readPackage: no error&#039;);
            t.equal(res, expected, &#039;with readPackage: malformed package.json is silently ignored&#039;);
            t.equal(pkg, undefined, &#039;with readPackage: malformed package.json gives an undefined `pkg` argument&#039;);
        }
    );
});
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
