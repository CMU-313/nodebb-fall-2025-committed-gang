<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/buffer-builder/test/buffer-builder-test.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/buffer-builder/test/buffer-builder-test.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">65.71</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">295</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">76.22</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.72</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var assert = require(&#039;assert&#039;);
var BufferBuilder = require(&#039;../buffer-builder&#039;);

/* Build 1   2 3   3 4 5  4 5 6 7 ... and make sure it comes out right */
(function() {
  var builder = new BufferBuilder(7);
  var top = 100;
  for (var base = 1; base &lt; top; base++) {
    var xs = [];
    for (var offset = 0; offset &lt; base; offset++) {
      xs.push(base + offset);
    }
    builder.appendBuffer(new Buffer(xs));
  }
  
  var result = builder.get();
  var idx = 0;
  for (var base = 1; base &lt; top; base++) {
    for (var offset = 0; offset &lt; base; offset++) {
      assert.equal(result[idx++], base+offset);
    }
  }
})();

/* Build 1  2 2  3 3 3  4 4 4 4  5 5 5 5 5 ... and make sure it comes out right. */
(function() {
  var builder = new BufferBuilder(3);
  var top = 20;
  for (var i = 1; i &lt; top; i++) {
    builder.appendFill(i, i);
  }
  
  var result = builder.get();
  var idx = 0;
  for (var i = 1; i &lt; top; i++) {
    for (var j = 0; j &lt; i; j++) {
      assert.equal(result[idx], i);
      idx++;
    }
  }
})();

/* Numeric types come out like they went in */
(function() {
  var builder = new BufferBuilder();
  var n = 500;
  
  var buildFns = BufferBuilder.prototype;
  var readFns = Buffer.prototype;
  var entries = [];
  
  function Entry(buildFn, readFn, length, value) {
    this.buildFn = buildFn;
    this.readFn = readFn;
    this.length = length;
    this.value = value;
  }
  
  for (var i = -n; i &lt;= n; i++) {
    entries.push(new Entry(buildFns.appendInt32LE, readFns.readInt32LE, 4, i));
    entries.push(new Entry(buildFns.appendInt32BE, readFns.readInt32BE, 4, i));
    entries.push(new Entry(buildFns.appendUInt32LE, readFns.readUInt32LE, 4, Math.abs(i)));
    entries.push(new Entry(buildFns.appendUInt32BE, readFns.readUInt32BE, 4, Math.abs(i)));
    entries.push(new Entry(buildFns.appendInt16LE, readFns.readInt16LE, 2, i));
    entries.push(new Entry(buildFns.appendInt16BE, readFns.readInt16BE, 2, i));
    entries.push(new Entry(buildFns.appendUInt16LE, readFns.readUInt16LE, 2, Math.abs(i)));
    entries.push(new Entry(buildFns.appendUInt16BE, readFns.readUInt16BE, 2, Math.abs(i)));
    entries.push(new Entry(buildFns.appendInt8, readFns.readInt8, 1, Math.round(i/50)));
    entries.push(new Entry(buildFns.appendUInt8, readFns.readUInt8, 1, Math.abs(Math.round(i/50))));
    entries.push(new Entry(buildFns.appendFloatLE, readFns.readFloatLE, 4, i));
    entries.push(new Entry(buildFns.appendFloatBE, readFns.readFloatBE, 4, i));
    entries.push(new Entry(buildFns.appendDoubleLE, readFns.readDoubleLE, 8, i));
    entries.push(new Entry(buildFns.appendDoubleBE, readFns.readDoubleBE, 8, i));
  }
  
  for (var i = 0; i &lt; entries.length; i++) {
    var entry = entries[i];
    entry.buildFn.call(builder, entry.value);
  }
  
  var result = builder.get();
  var idx = 0;
  for (var i = 0; i &lt; entries.length; i++) {
    var entry = entries[i];
    var read = entry.readFn.call(result, idx);
    assert.equal(read, entry.value);
    idx += entry.length;
  }
})();

/* Newly-created buffer should be empty */
(function() {
  assert.equal(new BufferBuilder().get().length, 0)
})();

/* It should concatenating strings. */
(function() {
  var words = [&#039;This&#039;, &#039;is&#039;, &#039;a&#039;, &#039;test&#039;];
  var builder = new BufferBuilder();
  for (var i = 0; i &lt; words.length; i++) {
    builder.appendString(words[i]);
  }
  
  assert.equal(builder.get().toString(), words.join(&#039;&#039;));
})();

/* Test appendStringZero */
(function() {
  var words = [&#039;alpha&#039;, &#039;bravo&#039;, &#039;charlie&#039;, &#039;delta&#039;];
  var builder = new BufferBuilder();
  for (var i = 0; i &lt; words.length; i++) {
    builder.appendStringZero(words[i]);
  }
  
  function appendZero(str) { return str + &#039;\0&#039;; }
  assert.equal(builder.get().toString() , words.map(appendZero).join(&#039;&#039;));
})();

/* copy() sanity checks */
(function() {
  var check = function(low, high,  targetStart, sourceStart, sourceEnd) {
    var source = new BufferBuilder();
    source.appendFill(1, 10);
    var dest = new Buffer(20);
    dest.fill(0);
    
    
    source.copy(dest, targetStart, sourceStart, sourceEnd);
    for (var i = 0; i &lt; 20; i++) {
      assert.equal(dest[i], low&lt;=i &amp;&amp; i&lt;high ? 1 : 0);
    }
  };
  
  check(0, 10);
  check(3, 13,  3);
  check(3, 10,  3, 3);
  check(10, 14,  10, 0, 4);
})();

/* copy() applied over ranges */
(function() {
  var source = new BufferBuilder(3);
  for (var i = 1; i &lt; 100; i++) {
    source.appendUInt8(i);
  }
  
  for (var i = 0; i &lt; 20; i++) {
    var sourceStart = i*3;
    var sourceEnd = source.length - i*5;
    var targetStart = i*20;
    
    var target = new Buffer(1000);
    target.fill(0);
    source.copy(target, targetStart, sourceStart, sourceEnd);
    
    for (var i = 0; i &lt; target.length; i++) {
      var expected;
      if (i &gt;= targetStart &amp;&amp; i &lt; targetStart + sourceEnd - sourceStart) {
        expected = i - targetStart + sourceStart + 1;
      } else {
        expected = 0;
      }
      assert.equal(expected, target[i]);
    }
  }
})();

/* Overlap small chunks over one large copy, making sure that does not change anything. */
(function() {
  var n = 1000;
  var builder = new BufferBuilder(10);
  var x = .4;
  for (var i = 0; i &lt; n; i++) {
    builder.appendDoubleLE(x);
    x = x * (1-x) * 4;
  }
  
  var buffersMatchOneOff = function(b1, b2) {
    // Why one off? Because then sourceStart != targetStart, so I can&#039;t have mixed those up in copy().
    assert.equal(b1.length+1, b2.length);
    for (var i = 0; i &lt; b1.length; i++) {
      assert.equal(b1[i], b2[i+1], &#039;byte &#039; + i + &#039; mismatch&#039;);
    }
  }
  
  var original = builder.get();
  var copyTarget = new Buffer(original.length+1);
  original.copy(copyTarget, 1);
  
  buffersMatchOneOff(original, copyTarget);
  var copyLength = 105;
  var copyStart = 4;
  var copyOffset = 143;
  for (var i = copyStart; i+copyLength &lt; builder.length; i += copyOffset) {
    builder.copy(copyTarget, i+1, i, i + copyLength);
    //console.log(copyTarget);
    buffersMatchOneOff(original, copyTarget);
  }
  
})();


/* Try a copy that starts right on a buffer boundary */
(function() {
  var builder = new BufferBuilder(3);
  for (var i = 0; i &lt; 10; i++) {
    builder.appendUInt8(i);
  }
  
  var dest = new Buffer(7);
  builder.copy(dest, 0, 3);
  for (var i = 0; i &lt; 7; i++) {
    assert.equal(dest[i], i+3);
  }
})();

/* BufferBuilder.copy() should behave just like Buffer.copy(), including the exceptions thrown */
(function() {
  var builder = new BufferBuilder(5);
  for (var i = 0; i &lt; 100; i++) {
    builder.appendUInt8(i);
  }
  var buffer = builder.get();
  
  var dest = new Buffer(50);
  
  var behavesSame = function(f) {
    var bufferException, bufferResult, builderException, builderResult;
    try {
      bufferResult = f(buffer);
    } catch (e) {
      bufferException = e;
    }
    try {
      builderResult = f(buffer);
    } catch (e) {
      builderException = e;
    }
    
    assert.equal(bufferResult, builderResult);
    assert.equal(&#039;&#039;+bufferException, &#039;&#039;+builderException);
  };
  
  // copies that get cut off because target is small
  behavesSame(function(b) { return b.copy(new Buffer(50), 20) });
  behavesSame(function(b) { return b.copy(new Buffer(50)) });
  behavesSame(function(b) { return b.copy(new Buffer(50)) });
  
  // targetStart too low
  behavesSame(function(b) { return b.copy(new Buffer(50, -1)) });
  // targetStart too high
  behavesSame(function(b) { return b.copy(new Buffer(50, 50)) });
  behavesSame(function(b) { return b.copy(new Buffer(50, 51)) });
  
  // sourceStart too low
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, -4)) });
  // sourceStart too high
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 130)) });
  
  // copy cut off by end of source
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 99)) });
  
  // degenerate copy
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 99, 99)) });
  
  // sourceEnd after sourceStart
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 99, 90)) });
  
  // sourceEnd too high
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 99, 150)) });
  
  // sourceStart and sourceEnd too high
  behavesSame(function(b) { return b.copy(new Buffer(50, 0, 120, 150)) });
  
})();

/* Make sure functions are chainable */
(function() {
  var x = new BufferBuilder();
  assert.equal(x, x.appendString(&#039;hello&#039;));
  assert.equal(x, x.appendUInt16LE(0x7720));
  assert.equal(x, x.appendBuffer(new Buffer([111, 114, 108, 100])));
  assert.equal(x, x.appendFill(33, 3));
})();

/* Test the degenerate copy */
(function() {
  var x = new BufferBuilder();
  x.appendBuffer(new Buffer([2,4,6,8]));
  var b = new Buffer(7);
  b.fill(0);
  x.copy(b, 0,0,0);
  assert.equal(b[0], 0);
})();
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
