<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/webpack/lib/sharing/ConsumeSharedRuntimeModule.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/webpack/lib/sharing/ConsumeSharedRuntimeModule.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">59.71</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">356</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">22.93</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.14</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

&quot;use strict&quot;;

const RuntimeGlobals = require(&quot;../RuntimeGlobals&quot;);
const RuntimeModule = require(&quot;../RuntimeModule&quot;);
const Template = require(&quot;../Template&quot;);
const {
	parseVersionRuntimeCode,
	versionLtRuntimeCode,
	rangeToStringRuntimeCode,
	satisfyRuntimeCode
} = require(&quot;../util/semver&quot;);

/** @typedef {import(&quot;webpack-sources&quot;).Source} Source */
/** @typedef {import(&quot;../Chunk&quot;)} Chunk */
/** @typedef {import(&quot;../Chunk&quot;).ChunkId} ChunkId */
/** @typedef {import(&quot;../ChunkGraph&quot;)} ChunkGraph */
/** @typedef {import(&quot;../ChunkGraph&quot;).ModuleId} ModuleId */
/** @typedef {import(&quot;../Compilation&quot;)} Compilation */
/** @typedef {import(&quot;../Module&quot;)} Module */
/** @typedef {import(&quot;../Module&quot;).ReadOnlyRuntimeRequirements} ReadOnlyRuntimeRequirements */
/** @typedef {import(&quot;./ConsumeSharedModule&quot;)} ConsumeSharedModule */

class ConsumeSharedRuntimeModule extends RuntimeModule {
	/**
	 * @param {ReadOnlyRuntimeRequirements} runtimeRequirements runtime requirements
	 */
	constructor(runtimeRequirements) {
		super(&quot;consumes&quot;, RuntimeModule.STAGE_ATTACH);
		this._runtimeRequirements = runtimeRequirements;
	}

	/**
	 * @returns {string | null} runtime code
	 */
	generate() {
		const compilation = /** @type {Compilation} */ (this.compilation);
		const chunkGraph = /** @type {ChunkGraph} */ (this.chunkGraph);
		const { runtimeTemplate, codeGenerationResults } = compilation;
		/** @type {Record&lt;ChunkId, (string | number)[]&gt;} */
		const chunkToModuleMapping = {};
		/** @type {Map&lt;string | number, Source&gt;} */
		const moduleIdToSourceMapping = new Map();
		/** @type {(string | number)[]} */
		const initialConsumes = [];
		/**
		 * @param {Iterable&lt;Module&gt;} modules modules
		 * @param {Chunk} chunk the chunk
		 * @param {(string | number)[]} list list of ids
		 */
		const addModules = (modules, chunk, list) =&gt; {
			for (const m of modules) {
				const module = m;
				const id = /** @type {ModuleId} */ (chunkGraph.getModuleId(module));
				list.push(id);
				moduleIdToSourceMapping.set(
					id,
					codeGenerationResults.getSource(
						module,
						chunk.runtime,
						&quot;consume-shared&quot;
					)
				);
			}
		};
		for (const chunk of /** @type {Chunk} */ (
			this.chunk
		).getAllReferencedChunks()) {
			const modules = chunkGraph.getChunkModulesIterableBySourceType(
				chunk,
				&quot;consume-shared&quot;
			);
			if (!modules) continue;
			addModules(
				modules,
				chunk,
				(chunkToModuleMapping[/** @type {ChunkId} */ (chunk.id)] = [])
			);
		}
		for (const chunk of /** @type {Chunk} */ (
			this.chunk
		).getAllInitialChunks()) {
			const modules = chunkGraph.getChunkModulesIterableBySourceType(
				chunk,
				&quot;consume-shared&quot;
			);
			if (!modules) continue;
			addModules(modules, chunk, initialConsumes);
		}
		if (moduleIdToSourceMapping.size === 0) return null;
		return Template.asString([
			parseVersionRuntimeCode(runtimeTemplate),
			versionLtRuntimeCode(runtimeTemplate),
			rangeToStringRuntimeCode(runtimeTemplate),
			satisfyRuntimeCode(runtimeTemplate),
			`var exists = ${runtimeTemplate.basicFunction(&quot;scope, key&quot;, [
				`return scope &amp;&amp; ${RuntimeGlobals.hasOwnProperty}(scope, key);`
			])}`,
			`var get = ${runtimeTemplate.basicFunction(&quot;entry&quot;, [
				&quot;entry.loaded = 1;&quot;,
				&quot;return entry.get()&quot;
			])};`,
			`var eagerOnly = ${runtimeTemplate.basicFunction(&quot;versions&quot;, [
				`return Object.keys(versions).reduce(${runtimeTemplate.basicFunction(
					&quot;filtered, version&quot;,
					Template.indent([
						&quot;if (versions[version].eager) {&quot;,
						Template.indent([&quot;filtered[version] = versions[version];&quot;]),
						&quot;}&quot;,
						&quot;return filtered;&quot;
					])
				)}, {});`
			])};`,
			`var findLatestVersion = ${runtimeTemplate.basicFunction(
				&quot;scope, key, eager&quot;,
				[
					&quot;var versions = eager ? eagerOnly(scope[key]) : scope[key];&quot;,
					`var key = Object.keys(versions).reduce(${runtimeTemplate.basicFunction(
						&quot;a, b&quot;,
						[&quot;return !a || versionLt(a, b) ? b : a;&quot;]
					)}, 0);`,
					&quot;return key &amp;&amp; versions[key];&quot;
				]
			)};`,
			`var findSatisfyingVersion = ${runtimeTemplate.basicFunction(
				&quot;scope, key, requiredVersion, eager&quot;,
				[
					&quot;var versions = eager ? eagerOnly(scope[key]) : scope[key];&quot;,
					`var key = Object.keys(versions).reduce(${runtimeTemplate.basicFunction(
						&quot;a, b&quot;,
						[
							&quot;if (!satisfy(requiredVersion, b)) return a;&quot;,
							&quot;return !a || versionLt(a, b) ? b : a;&quot;
						]
					)}, 0);`,
					&quot;return key &amp;&amp; versions[key]&quot;
				]
			)};`,
			`var findSingletonVersionKey = ${runtimeTemplate.basicFunction(
				&quot;scope, key, eager&quot;,
				[
					&quot;var versions = eager ? eagerOnly(scope[key]) : scope[key];&quot;,
					`return Object.keys(versions).reduce(${runtimeTemplate.basicFunction(
						&quot;a, b&quot;,
						[&quot;return !a || (!versions[a].loaded &amp;&amp; versionLt(a, b)) ? b : a;&quot;]
					)}, 0);`
				]
			)};`,
			`var getInvalidSingletonVersionMessage = ${runtimeTemplate.basicFunction(
				&quot;scope, key, version, requiredVersion&quot;,
				[
					&#039;return &quot;Unsatisfied version &quot; + version + &quot; from &quot; + (version &amp;&amp; scope[key][version].from) + &quot; of shared singleton module &quot; + key + &quot; (required &quot; + rangeToString(requiredVersion) + &quot;)&quot;&#039;
				]
			)};`,
			`var getInvalidVersionMessage = ${runtimeTemplate.basicFunction(
				&quot;scope, scopeName, key, requiredVersion, eager&quot;,
				[
					&quot;var versions = scope[key];&quot;,
					&#039;return &quot;No satisfying version (&quot; + rangeToString(requiredVersion) + &quot;)&quot; + (eager ? &quot; for eager consumption&quot; : &quot;&quot;) + &quot; of shared module &quot; + key + &quot; found in shared scope &quot; + scopeName + &quot;.\\n&quot; +&#039;,
					`\t&quot;Available versions: &quot; + Object.keys(versions).map(${runtimeTemplate.basicFunction(
						&quot;key&quot;,
						[&#039;return key + &quot; from &quot; + versions[key].from;&#039;]
					)}).join(&quot;, &quot;);`
				]
			)};`,
			`var fail = ${runtimeTemplate.basicFunction(&quot;msg&quot;, [
				&quot;throw new Error(msg);&quot;
			])}`,
			`var failAsNotExist = ${runtimeTemplate.basicFunction(&quot;scopeName, key&quot;, [
				&#039;return fail(&quot;Shared module &quot; + key + &quot; doesn\&#039;t exist in shared scope &quot; + scopeName);&#039;
			])}`,
			`var warn = /*#__PURE__*/ ${
				compilation.outputOptions.ignoreBrowserWarnings
					? runtimeTemplate.basicFunction(&quot;&quot;, &quot;&quot;)
					: runtimeTemplate.basicFunction(&quot;msg&quot;, [
							&#039;if (typeof console !== &quot;undefined&quot; &amp;&amp; console.warn) console.warn(msg);&#039;
						])
			};`,
			`var init = ${runtimeTemplate.returningFunction(
				Template.asString([
					&quot;function(scopeName, key, eager, c, d) {&quot;,
					Template.indent([
						`var promise = ${RuntimeGlobals.initializeSharing}(scopeName);`,
						// if we require eager shared, we expect it to be already loaded before it requested, no need to wait the whole scope loaded.
						&quot;if (promise &amp;&amp; promise.then &amp;&amp; !eager) { &quot;,
						Template.indent([
							`return promise.then(fn.bind(fn, scopeName, ${RuntimeGlobals.shareScopeMap}[scopeName], key, false, c, d));`
						]),
						&quot;}&quot;,
						`return fn(scopeName, ${RuntimeGlobals.shareScopeMap}[scopeName], key, eager, c, d);`
					]),
					&quot;}&quot;
				]),
				&quot;fn&quot;
			)};`,
			&quot;&quot;,
			`var useFallback = ${runtimeTemplate.basicFunction(
				&quot;scopeName, key, fallback&quot;,
				[&quot;return fallback ? fallback() : failAsNotExist(scopeName, key);&quot;]
			)}`,
			`var load = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;return get(findLatestVersion(scope, key, eager));&quot;
				]
			)});`,
			`var loadVersion = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, requiredVersion, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;var satisfyingVersion = findSatisfyingVersion(scope, key, requiredVersion, eager);&quot;,
					&quot;if (satisfyingVersion) return get(satisfyingVersion);&quot;,
					&quot;warn(getInvalidVersionMessage(scope, scopeName, key, requiredVersion, eager))&quot;,
					&quot;return get(findLatestVersion(scope, key, eager));&quot;
				]
			)});`,
			`var loadStrictVersion = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, requiredVersion, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;var satisfyingVersion = findSatisfyingVersion(scope, key, requiredVersion, eager);&quot;,
					&quot;if (satisfyingVersion) return get(satisfyingVersion);&quot;,
					&quot;if (fallback) return fallback();&quot;,
					&quot;fail(getInvalidVersionMessage(scope, scopeName, key, requiredVersion, eager));&quot;
				]
			)});`,
			`var loadSingleton = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;var version = findSingletonVersionKey(scope, key, eager);&quot;,
					&quot;return get(scope[key][version]);&quot;
				]
			)});`,
			`var loadSingletonVersion = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, requiredVersion, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;var version = findSingletonVersionKey(scope, key, eager);&quot;,
					&quot;if (!satisfy(requiredVersion, version)) {&quot;,
					Template.indent([
						&quot;warn(getInvalidSingletonVersionMessage(scope, key, version, requiredVersion));&quot;
					]),
					&quot;}&quot;,
					&quot;return get(scope[key][version]);&quot;
				]
			)});`,
			`var loadStrictSingletonVersion = /*#__PURE__*/ init(${runtimeTemplate.basicFunction(
				&quot;scopeName, scope, key, eager, requiredVersion, fallback&quot;,
				[
					&quot;if (!exists(scope, key)) return useFallback(scopeName, key, fallback);&quot;,
					&quot;var version = findSingletonVersionKey(scope, key, eager);&quot;,
					&quot;if (!satisfy(requiredVersion, version)) {&quot;,
					Template.indent([
						&quot;fail(getInvalidSingletonVersionMessage(scope, key, version, requiredVersion));&quot;
					]),
					&quot;}&quot;,
					&quot;return get(scope[key][version]);&quot;
				]
			)});`,
			&quot;var installedModules = {};&quot;,
			&quot;var moduleToHandlerMapping = {&quot;,
			Template.indent(
				Array.from(
					moduleIdToSourceMapping,
					([key, source]) =&gt; `${JSON.stringify(key)}: ${source.source()}`
				).join(&quot;,\n&quot;)
			),
			&quot;};&quot;,

			initialConsumes.length &gt; 0
				? Template.asString([
						`var initialConsumes = ${JSON.stringify(initialConsumes)};`,
						`initialConsumes.forEach(${runtimeTemplate.basicFunction(&quot;id&quot;, [
							`${
								RuntimeGlobals.moduleFactories
							}[id] = ${runtimeTemplate.basicFunction(&quot;module&quot;, [
								&quot;// Handle case when module is used sync&quot;,
								&quot;installedModules[id] = 0;&quot;,
								`delete ${RuntimeGlobals.moduleCache}[id];`,
								&quot;var factory = moduleToHandlerMapping[id]();&quot;,
								&#039;if(typeof factory !== &quot;function&quot;) throw new Error(&quot;Shared module is not available for eager consumption: &quot; + id);&#039;,
								&quot;module.exports = factory();&quot;
							])}`
						])});`
					])
				: &quot;// no consumes in initial chunks&quot;,
			this._runtimeRequirements.has(RuntimeGlobals.ensureChunkHandlers)
				? Template.asString([
						`var chunkMapping = ${JSON.stringify(
							chunkToModuleMapping,
							null,
							&quot;\t&quot;
						)};`,
						&quot;var startedInstallModules = {};&quot;,
						`${
							RuntimeGlobals.ensureChunkHandlers
						}.consumes = ${runtimeTemplate.basicFunction(&quot;chunkId, promises&quot;, [
							`if(${RuntimeGlobals.hasOwnProperty}(chunkMapping, chunkId)) {`,
							Template.indent([
								`chunkMapping[chunkId].forEach(${runtimeTemplate.basicFunction(
									&quot;id&quot;,
									[
										`if(${RuntimeGlobals.hasOwnProperty}(installedModules, id)) return promises.push(installedModules[id]);`,
										&quot;if(!startedInstallModules[id]) {&quot;,
										`var onFactory = ${runtimeTemplate.basicFunction(
											&quot;factory&quot;,
											[
												&quot;installedModules[id] = 0;&quot;,
												`${
													RuntimeGlobals.moduleFactories
												}[id] = ${runtimeTemplate.basicFunction(&quot;module&quot;, [
													`delete ${RuntimeGlobals.moduleCache}[id];`,
													&quot;module.exports = factory();&quot;
												])}`
											]
										)};`,
										&quot;startedInstallModules[id] = true;&quot;,
										`var onError = ${runtimeTemplate.basicFunction(&quot;error&quot;, [
											&quot;delete installedModules[id];&quot;,
											`${
												RuntimeGlobals.moduleFactories
											}[id] = ${runtimeTemplate.basicFunction(&quot;module&quot;, [
												`delete ${RuntimeGlobals.moduleCache}[id];`,
												&quot;throw error;&quot;
											])}`
										])};`,
										&quot;try {&quot;,
										Template.indent([
											&quot;var promise = moduleToHandlerMapping[id]();&quot;,
											&quot;if(promise.then) {&quot;,
											Template.indent(
												&quot;promises.push(installedModules[id] = promise.then(onFactory)[&#039;catch&#039;](onError));&quot;
											),
											&quot;} else onFactory(promise);&quot;
										]),
										&quot;} catch(e) { onError(e); }&quot;,
										&quot;}&quot;
									]
								)});`
							]),
							&quot;}&quot;
						])}`
					])
				: &quot;// no chunk loading of consumes&quot;
		]);
	}
}

module.exports = ConsumeSharedRuntimeModule;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
