<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/clean-css/lib/optimizer/level-1/tidy-rules.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/clean-css/lib/optimizer/level-1/tidy-rules.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">46.00</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">214</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">50.52</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.25</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var Spaces = require(&#039;../../options/format&#039;).Spaces;
var Marker = require(&#039;../../tokenizer/marker&#039;);
var formatPosition = require(&#039;../../utils/format-position&#039;);

var CASE_ATTRIBUTE_PATTERN = /[\s&quot;&#039;][iI]\s*\]/;
var CASE_RESTORE_PATTERN = /([\d\w])([iI])\]/g;
var DOUBLE_QUOTE_CASE_PATTERN = /=&quot;([a-zA-Z][a-zA-Z\d\-_]+)&quot;([iI])/g;
var DOUBLE_QUOTE_PATTERN = /=&quot;([a-zA-Z][a-zA-Z\d\-_]+)&quot;(\s|\])/g;
var HTML_COMMENT_PATTERN = /^(?:(?:&lt;!--|--&gt;)\s*)+/;
var SINGLE_QUOTE_CASE_PATTERN = /=&#039;([a-zA-Z][a-zA-Z\d\-_]+)&#039;([iI])/g;
var SINGLE_QUOTE_PATTERN = /=&#039;([a-zA-Z][a-zA-Z\d\-_]+)&#039;(\s|\])/g;
var RELATION_PATTERN = /[&gt;\+~]/;
var WHITESPACE_PATTERN = /\s/;

var ASTERISK_PLUS_HTML_HACK = &#039;*+html &#039;;
var ASTERISK_FIRST_CHILD_PLUS_HTML_HACK = &#039;*:first-child+html &#039;;
var LESS_THAN = &#039;&lt;&#039;;

function hasInvalidCharacters(value) {
  var isEscaped;
  var isInvalid = false;
  var character;
  var isQuote = false;
  var i, l;

  for (i = 0, l = value.length; i &lt; l; i++) {
    character = value[i];

    if (isEscaped) {
      // continue as always
    } else if (character == Marker.SINGLE_QUOTE || character == Marker.DOUBLE_QUOTE) {
      isQuote = !isQuote;
    } else if (!isQuote &amp;&amp; (character == Marker.CLOSE_CURLY_BRACKET || character == Marker.EXCLAMATION || character == LESS_THAN || character == Marker.SEMICOLON)) {
      isInvalid = true;
      break;
    } else if (!isQuote &amp;&amp; i === 0 &amp;&amp; RELATION_PATTERN.test(character)) {
      isInvalid = true;
      break;
    }

    isEscaped = character == Marker.BACK_SLASH;
  }

  return isInvalid;
}

function removeWhitespace(value, format) {
  var stripped = [];
  var character;
  var isNewLineNix;
  var isNewLineWin;
  var isEscaped;
  var wasEscaped;
  var isQuoted;
  var isSingleQuoted;
  var isDoubleQuoted;
  var isAttribute;
  var isRelation;
  var isWhitespace;
  var roundBracketLevel = 0;
  var wasRelation = false;
  var wasWhitespace = false;
  var withCaseAttribute = CASE_ATTRIBUTE_PATTERN.test(value);
  var spaceAroundRelation = format &amp;&amp; format.spaces[Spaces.AroundSelectorRelation];
  var i, l;

  for (i = 0, l = value.length; i &lt; l; i++) {
    character = value[i];

    isNewLineNix = character == Marker.NEW_LINE_NIX;
    isNewLineWin = character == Marker.NEW_LINE_NIX &amp;&amp; value[i - 1] == Marker.CARRIAGE_RETURN;
    isQuoted = isSingleQuoted || isDoubleQuoted;
    isRelation = !isAttribute &amp;&amp; !isEscaped &amp;&amp; roundBracketLevel === 0 &amp;&amp; RELATION_PATTERN.test(character);
    isWhitespace = WHITESPACE_PATTERN.test(character);

    if (wasEscaped &amp;&amp; isQuoted &amp;&amp; isNewLineWin) {
      // swallow escaped new windows lines in comments
      stripped.pop();
      stripped.pop();
    } else if (isEscaped &amp;&amp; isQuoted &amp;&amp; isNewLineNix) {
      // swallow escaped new *nix lines in comments
      stripped.pop();
    } else if (isEscaped) {
      stripped.push(character);
    } else if (character == Marker.OPEN_SQUARE_BRACKET &amp;&amp; !isQuoted) {
      stripped.push(character);
      isAttribute = true;
    } else if (character == Marker.CLOSE_SQUARE_BRACKET &amp;&amp; !isQuoted) {
      stripped.push(character);
      isAttribute = false;
    } else if (character == Marker.OPEN_ROUND_BRACKET &amp;&amp; !isQuoted) {
      stripped.push(character);
      roundBracketLevel++;
    } else if (character == Marker.CLOSE_ROUND_BRACKET &amp;&amp; !isQuoted) {
      stripped.push(character);
      roundBracketLevel--;
    } else if (character == Marker.SINGLE_QUOTE &amp;&amp; !isQuoted) {
      stripped.push(character);
      isSingleQuoted = true;
    } else if (character == Marker.DOUBLE_QUOTE &amp;&amp; !isQuoted) {
      stripped.push(character);
      isDoubleQuoted = true;
    } else if (character == Marker.SINGLE_QUOTE &amp;&amp; isQuoted) {
      stripped.push(character);
      isSingleQuoted = false;
    } else if (character == Marker.DOUBLE_QUOTE &amp;&amp; isQuoted) {
      stripped.push(character);
      isDoubleQuoted = false;
    } else if (isWhitespace &amp;&amp; wasRelation &amp;&amp; !spaceAroundRelation) {
      continue;
    } else if (!isWhitespace &amp;&amp; wasRelation &amp;&amp; spaceAroundRelation) {
      stripped.push(Marker.SPACE);
      stripped.push(character);
    } else if (isWhitespace &amp;&amp; (isAttribute || roundBracketLevel &gt; 0) &amp;&amp; !isQuoted) {
      // skip space
    } else if (isWhitespace &amp;&amp; wasWhitespace &amp;&amp; !isQuoted) {
      // skip extra space
    } else if ((isNewLineWin || isNewLineNix) &amp;&amp; (isAttribute || roundBracketLevel &gt; 0) &amp;&amp; isQuoted) {
      // skip newline
    } else if (isRelation &amp;&amp; wasWhitespace &amp;&amp; !spaceAroundRelation) {
      stripped.pop();
      stripped.push(character);
    } else if (isRelation &amp;&amp; !wasWhitespace &amp;&amp; spaceAroundRelation) {
      stripped.push(Marker.SPACE);
      stripped.push(character);
    } else if (isWhitespace) {
      stripped.push(Marker.SPACE);
    } else {
      stripped.push(character);
    }

    wasEscaped = isEscaped;
    isEscaped = character == Marker.BACK_SLASH;
    wasRelation = isRelation;
    wasWhitespace = isWhitespace;
  }

  return withCaseAttribute ?
    stripped.join(&#039;&#039;).replace(CASE_RESTORE_PATTERN, &#039;$1 $2]&#039;) :
    stripped.join(&#039;&#039;);
}

function removeQuotes(value) {
  if (value.indexOf(&#039;\&#039;&#039;) == -1 &amp;&amp; value.indexOf(&#039;&quot;&#039;) == -1) {
    return value;
  }

  return value
    .replace(SINGLE_QUOTE_CASE_PATTERN, &#039;=$1 $2&#039;)
    .replace(SINGLE_QUOTE_PATTERN, &#039;=$1$2&#039;)
    .replace(DOUBLE_QUOTE_CASE_PATTERN, &#039;=$1 $2&#039;)
    .replace(DOUBLE_QUOTE_PATTERN, &#039;=$1$2&#039;);
}

function tidyRules(rules, removeUnsupported, adjacentSpace, format, warnings) {
  var list = [];
  var repeated = [];

  function removeHTMLComment(rule, match) {
    warnings.push(&#039;HTML comment \&#039;&#039; + match + &#039;\&#039; at &#039; + formatPosition(rule[2][0]) + &#039;. Removing.&#039;);
    return &#039;&#039;;
  }

  for (var i = 0, l = rules.length; i &lt; l; i++) {
    var rule = rules[i];
    var reduced = rule[1];

    reduced = reduced.replace(HTML_COMMENT_PATTERN, removeHTMLComment.bind(null, rule));

    if (hasInvalidCharacters(reduced)) {
      warnings.push(&#039;Invalid selector \&#039;&#039; + rule[1] + &#039;\&#039; at &#039; + formatPosition(rule[2][0]) + &#039;. Ignoring.&#039;);
      continue;
    }

    reduced = removeWhitespace(reduced, format);
    reduced = removeQuotes(reduced);

    if (adjacentSpace &amp;&amp; reduced.indexOf(&#039;nav&#039;) &gt; 0) {
      reduced = reduced.replace(/\+nav(\S|$)/, &#039;+ nav$1&#039;);
    }

    if (removeUnsupported &amp;&amp; reduced.indexOf(ASTERISK_PLUS_HTML_HACK) &gt; -1) {
      continue;
    }

    if (removeUnsupported &amp;&amp; reduced.indexOf(ASTERISK_FIRST_CHILD_PLUS_HTML_HACK) &gt; -1) {
      continue;
    }

    if (reduced.indexOf(&#039;*&#039;) &gt; -1) {
      reduced = reduced
        .replace(/\*([:#\.\[])/g, &#039;$1&#039;)
        .replace(/^(\:first\-child)?\+html/, &#039;*$1+html&#039;);
    }

    if (repeated.indexOf(reduced) &gt; -1) {
      continue;
    }

    rule[1] = reduced;
    repeated.push(reduced);
    list.push(rule);
  }

  if (list.length == 1 &amp;&amp; list[0][1].length === 0) {
    warnings.push(&#039;Empty selector \&#039;&#039; + list[0][1] + &#039;\&#039; at &#039; + formatPosition(list[0][2][0]) + &#039;. Ignoring.&#039;);
    list = [];
  }

  return list;
}

module.exports = tidyRules;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
