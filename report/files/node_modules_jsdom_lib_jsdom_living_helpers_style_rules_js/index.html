<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/jsdom/lib/jsdom/living/helpers/style-rules.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/jsdom/lib/jsdom/living/helpers/style-rules.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">72.06</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">244</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">35.10</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.43</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&quot;use strict&quot;;
const cssom = require(&quot;rrweb-cssom&quot;);
const { CSSStyleDeclaration } = require(&quot;cssstyle&quot;);
const defaultStyleSheet = require(&quot;../../browser/default-stylesheet&quot;);
const { getSpecifiedColor, getComputedOrUsedColor } = require(&quot;./colors&quot;);
const { matchesDontThrow } = require(&quot;./selectors&quot;);

const { forEach, indexOf } = Array.prototype;

let parsedDefaultStyleSheet;

// Properties for which getResolvedValue is implemented. This is less than
// every supported property.
// https://drafts.csswg.org/indexes/#properties
exports.propertiesWithResolvedValueImplemented = {
  &quot;__proto__&quot;: null,

  // https://drafts.csswg.org/css2/visufx.html#visibility
  &quot;visibility&quot;: {
    inherited: true,
    initial: &quot;visible&quot;,
    computedValue: &quot;as-specified&quot;
  },
  // https://svgwg.org/svg2-draft/interact.html#PointerEventsProperty
  &quot;pointer-events&quot;: {
    inherited: true,
    initial: &quot;auto&quot;,
    computedValue: &quot;as-specified&quot;
  },
  // https://drafts.csswg.org/css-backgrounds-3/#propdef-background-color
  &quot;background-color&quot;: {
    inherited: false,
    initial: &quot;transparent&quot;,
    computedValue: &quot;computed-color&quot;
  },
  // https://drafts.csswg.org/css-logical-1/#propdef-border-block-end-color
  &quot;border-block-start-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-block-end-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-inline-start-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-inline-end-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  // https://drafts.csswg.org/css-backgrounds-3/#propdef-border-bottom-color
  &quot;border-top-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-right-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-bottom-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  &quot;border-left-color&quot;: {
    inherited: false,
    initial: &quot;currentcolor&quot;,
    computedValue: &quot;computed-color&quot;
  },
  // https://drafts.csswg.org/css-ui-4/#propdef-caret-color
  &quot;caret-color&quot;: {
    inherited: true,
    initial: &quot;auto&quot;,
    computedValue: &quot;computed-color&quot;
  },
  // https://drafts.csswg.org/css-color-4/#propdef-color
  &quot;color&quot;: {
    inherited: true,
    initial: &quot;CanvasText&quot;,
    computedValue: &quot;computed-color&quot;
  },
  // https://drafts.csswg.org/css-ui-4/#propdef-outline-color
  &quot;outline-color&quot;: {
    inherited: false,
    initial: &quot;invert&quot;,
    computedValue: &quot;computed-color&quot;
  }
};

function forEachMatchingSheetRuleOfElement(elementImpl, handleRule) {
  function handleSheet(sheet) {
    forEach.call(sheet.cssRules, rule =&gt; {
      if (rule.media) {
        if (indexOf.call(rule.media, &quot;screen&quot;) !== -1) {
          forEach.call(rule.cssRules, innerRule =&gt; {
            if (matches(innerRule, elementImpl)) {
              handleRule(innerRule);
            }
          });
        }
      } else if (matches(rule, elementImpl)) {
        handleRule(rule);
      }
    });
  }

  if (!parsedDefaultStyleSheet) {
    parsedDefaultStyleSheet = cssom.parse(defaultStyleSheet);
  }

  handleSheet(parsedDefaultStyleSheet);
  forEach.call(elementImpl._ownerDocument.styleSheets._list, handleSheet);
}

exports.invalidateStyleCache = elementImpl =&gt; {
  if (elementImpl._attached) {
    elementImpl._ownerDocument._styleCache = null;
  }
};

exports.getDeclarationForElement = elementImpl =&gt; {
  let styleCache = elementImpl._ownerDocument._styleCache;
  if (!styleCache) {
    styleCache = elementImpl._ownerDocument._styleCache = new WeakMap();
  }

  const cachedDeclaration = styleCache.get(elementImpl);
  if (cachedDeclaration) {
    return cachedDeclaration;
  }

  const declaration = new CSSStyleDeclaration();

  function handleProperty(style, property) {
    const value = style.getPropertyValue(property);
    // https://drafts.csswg.org/css-cascade-4/#valdef-all-unset
    if (value === &quot;unset&quot;) {
      declaration.removeProperty(property);
    } else {
      declaration.setProperty(
        property,
        value,
        style.getPropertyPriority(property)
      );
    }
  }

  forEachMatchingSheetRuleOfElement(elementImpl, rule =&gt; {
    forEach.call(rule.style, property =&gt; {
      handleProperty(rule.style, property);
    });
  });

  forEach.call(elementImpl.style, property =&gt; {
    handleProperty(elementImpl.style, property);
  });

  styleCache.set(elementImpl, declaration);

  return declaration;
};

function matches(rule, element) {
  return matchesDontThrow(element, rule.selectorText);
}

// Naive implementation of https://drafts.csswg.org/css-cascade-4/#cascading
// based on the previous jsdom implementation of getComputedStyle.
// Does not implement https://drafts.csswg.org/css-cascade-4/#cascade-specificity,
// or rather specificity is only implemented by the order in which the matching
// rules appear. The last rule is the most specific while the first rule is
// the least specific.
function getCascadedPropertyValue(element, property) {
  return exports.getDeclarationForElement(element).getPropertyValue(property);
}

// https://drafts.csswg.org/css-cascade-4/#specified-value
function getSpecifiedValue(element, property) {
  const { initial, inherited, computedValue } = exports.propertiesWithResolvedValueImplemented[property];
  const cascade = getCascadedPropertyValue(element, property);

  if (cascade !== &quot;&quot;) {
    if (computedValue === &quot;computed-color&quot;) {
      return getSpecifiedColor(cascade);
    }

    return cascade;
  }

  // Defaulting
  if (inherited &amp;&amp; element.parentElement !== null) {
    return getComputedValue(element.parentElement, property);
  }

  // root element without parent element or inherited property
  return initial;
}

// https://drafts.csswg.org/css-cascade-4/#computed-value
function getComputedValue(element, property) {
  const { computedValue, initial } = exports.propertiesWithResolvedValueImplemented[property];
  if (computedValue === &quot;as-specified&quot;) {
    return getSpecifiedValue(element, property);
  } else if (computedValue === &quot;computed-color&quot;) {
    const specifiedValue = getSpecifiedValue(element, property);

    // https://drafts.csswg.org/css-color-4/#resolving-other-colors
    if (specifiedValue === &quot;currentcolor&quot;) {
      if (property === &quot;color&quot;) {
        if (element.parentElement !== null) {
          return getComputedValue(element.parentElement, &quot;color&quot;);
        }
        return initial;
      }

      return getComputedValue(element, &quot;color&quot;);
    }

    return getComputedOrUsedColor(specifiedValue);
  }

  throw new TypeError(`Internal error: unrecognized computed value instruction &#039;${computedValue}&#039;`);
}

// https://drafts.csswg.org/cssom/#resolved-value
// Only implements the properties that are defined in propertiesWithResolvedValueImplemented.
exports.getResolvedValue = (element, property) =&gt; {
  // We can always use the computed value with the current set of propertiesWithResolvedValueImplemented:
  // * Color properties end up with the used value, but we don&#039;t implement any actual differences between used and
  //   computed that https://drafts.csswg.org/css-cascade-5/#used-value gestures at.
  // * The other properties fall back to the &quot;any other property: The resolved value is the computed value.&quot; case.
  return getComputedValue(element, property);
};

exports.SHADOW_DOM_PSEUDO_REGEXP = /^::(?:part|slotted)\(/i;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
