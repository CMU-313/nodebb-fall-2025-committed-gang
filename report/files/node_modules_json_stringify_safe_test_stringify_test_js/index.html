<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/json-stringify-safe/test/stringify_test.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/json-stringify-safe/test/stringify_test.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">64.50</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">247</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">67.61</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.31</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var Sinon = require(&quot;sinon&quot;)
var stringify = require(&quot;..&quot;)
function jsonify(obj) { return JSON.stringify(obj, null, 2) }

describe(&quot;Stringify&quot;, function() {
  it(&quot;must stringify circular objects&quot;, function() {
    var obj = {name: &quot;Alice&quot;}
    obj.self = obj
    var json = stringify(obj, null, 2)
    json.must.eql(jsonify({name: &quot;Alice&quot;, self: &quot;[Circular ~]&quot;}))
  })

  it(&quot;must stringify circular objects with intermediaries&quot;, function() {
    var obj = {name: &quot;Alice&quot;}
    obj.identity = {self: obj}
    var json = stringify(obj, null, 2)
    json.must.eql(jsonify({name: &quot;Alice&quot;, identity: {self: &quot;[Circular ~]&quot;}}))
  })

  it(&quot;must stringify circular objects deeper&quot;, function() {
    var obj = {name: &quot;Alice&quot;, child: {name: &quot;Bob&quot;}}
    obj.child.self = obj.child

    stringify(obj, null, 2).must.eql(jsonify({
      name: &quot;Alice&quot;,
      child: {name: &quot;Bob&quot;, self: &quot;[Circular ~.child]&quot;}
    }))
  })

  it(&quot;must stringify circular objects deeper with intermediaries&quot;, function() {
    var obj = {name: &quot;Alice&quot;, child: {name: &quot;Bob&quot;}}
    obj.child.identity = {self: obj.child}

    stringify(obj, null, 2).must.eql(jsonify({
      name: &quot;Alice&quot;,
      child: {name: &quot;Bob&quot;, identity: {self: &quot;[Circular ~.child]&quot;}}
    }))
  })

  it(&quot;must stringify circular objects in an array&quot;, function() {
    var obj = {name: &quot;Alice&quot;}
    obj.self = [obj, obj]

    stringify(obj, null, 2).must.eql(jsonify({
      name: &quot;Alice&quot;, self: [&quot;[Circular ~]&quot;, &quot;[Circular ~]&quot;]
    }))
  })

  it(&quot;must stringify circular objects deeper in an array&quot;, function() {
    var obj = {name: &quot;Alice&quot;, children: [{name: &quot;Bob&quot;}, {name: &quot;Eve&quot;}]}
    obj.children[0].self = obj.children[0]
    obj.children[1].self = obj.children[1]

    stringify(obj, null, 2).must.eql(jsonify({
      name: &quot;Alice&quot;,
      children: [
        {name: &quot;Bob&quot;, self: &quot;[Circular ~.children.0]&quot;},
        {name: &quot;Eve&quot;, self: &quot;[Circular ~.children.1]&quot;}
      ]
    }))
  })

  it(&quot;must stringify circular arrays&quot;, function() {
    var obj = []
    obj.push(obj)
    obj.push(obj)
    var json = stringify(obj, null, 2)
    json.must.eql(jsonify([&quot;[Circular ~]&quot;, &quot;[Circular ~]&quot;]))
  })

  it(&quot;must stringify circular arrays with intermediaries&quot;, function() {
    var obj = []
    obj.push({name: &quot;Alice&quot;, self: obj})
    obj.push({name: &quot;Bob&quot;, self: obj})

    stringify(obj, null, 2).must.eql(jsonify([
      {name: &quot;Alice&quot;, self: &quot;[Circular ~]&quot;},
      {name: &quot;Bob&quot;, self: &quot;[Circular ~]&quot;}
    ]))
  })

  it(&quot;must stringify repeated objects in objects&quot;, function() {
    var obj = {}
    var alice = {name: &quot;Alice&quot;}
    obj.alice1 = alice
    obj.alice2 = alice

    stringify(obj, null, 2).must.eql(jsonify({
      alice1: {name: &quot;Alice&quot;},
      alice2: {name: &quot;Alice&quot;}
    }))
  })

  it(&quot;must stringify repeated objects in arrays&quot;, function() {
    var alice = {name: &quot;Alice&quot;}
    var obj = [alice, alice]
    var json = stringify(obj, null, 2)
    json.must.eql(jsonify([{name: &quot;Alice&quot;}, {name: &quot;Alice&quot;}]))
  })

  it(&quot;must call given decycler and use its output&quot;, function() {
    var obj = {}
    obj.a = obj
    obj.b = obj

    var decycle = Sinon.spy(function() { return decycle.callCount })
    var json = stringify(obj, null, 2, decycle)
    json.must.eql(jsonify({a: 1, b: 2}, null, 2))

    decycle.callCount.must.equal(2)
    decycle.thisValues[0].must.equal(obj)
    decycle.args[0][0].must.equal(&quot;a&quot;)
    decycle.args[0][1].must.equal(obj)
    decycle.thisValues[1].must.equal(obj)
    decycle.args[1][0].must.equal(&quot;b&quot;)
    decycle.args[1][1].must.equal(obj)
  })

  it(&quot;must call replacer and use its output&quot;, function() {
    var obj = {name: &quot;Alice&quot;, child: {name: &quot;Bob&quot;}}

    var replacer = Sinon.spy(bangString)
    var json = stringify(obj, replacer, 2)
    json.must.eql(jsonify({name: &quot;Alice!&quot;, child: {name: &quot;Bob!&quot;}}))

    replacer.callCount.must.equal(4)
    replacer.args[0][0].must.equal(&quot;&quot;)
    replacer.args[0][1].must.equal(obj)
    replacer.thisValues[1].must.equal(obj)
    replacer.args[1][0].must.equal(&quot;name&quot;)
    replacer.args[1][1].must.equal(&quot;Alice&quot;)
    replacer.thisValues[2].must.equal(obj)
    replacer.args[2][0].must.equal(&quot;child&quot;)
    replacer.args[2][1].must.equal(obj.child)
    replacer.thisValues[3].must.equal(obj.child)
    replacer.args[3][0].must.equal(&quot;name&quot;)
    replacer.args[3][1].must.equal(&quot;Bob&quot;)
  })

  it(&quot;must call replacer after describing circular references&quot;, function() {
    var obj = {name: &quot;Alice&quot;}
    obj.self = obj

    var replacer = Sinon.spy(bangString)
    var json = stringify(obj, replacer, 2)
    json.must.eql(jsonify({name: &quot;Alice!&quot;, self: &quot;[Circular ~]!&quot;}))

    replacer.callCount.must.equal(3)
    replacer.args[0][0].must.equal(&quot;&quot;)
    replacer.args[0][1].must.equal(obj)
    replacer.thisValues[1].must.equal(obj)
    replacer.args[1][0].must.equal(&quot;name&quot;)
    replacer.args[1][1].must.equal(&quot;Alice&quot;)
    replacer.thisValues[2].must.equal(obj)
    replacer.args[2][0].must.equal(&quot;self&quot;)
    replacer.args[2][1].must.equal(&quot;[Circular ~]&quot;)
  })

  it(&quot;must call given decycler and use its output for nested objects&quot;,
    function() {
    var obj = {}
    obj.a = obj
    obj.b = {self: obj}

    var decycle = Sinon.spy(function() { return decycle.callCount })
    var json = stringify(obj, null, 2, decycle)
    json.must.eql(jsonify({a: 1, b: {self: 2}}))

    decycle.callCount.must.equal(2)
    decycle.args[0][0].must.equal(&quot;a&quot;)
    decycle.args[0][1].must.equal(obj)
    decycle.args[1][0].must.equal(&quot;self&quot;)
    decycle.args[1][1].must.equal(obj)
  })

  it(&quot;must use decycler&#039;s output when it returned null&quot;, function() {
    var obj = {a: &quot;b&quot;}
    obj.self = obj
    obj.selves = [obj, obj]

    function decycle() { return null }
    stringify(obj, null, 2, decycle).must.eql(jsonify({
      a: &quot;b&quot;,
      self: null,
      selves: [null, null]
    }))
  })

  it(&quot;must use decycler&#039;s output when it returned undefined&quot;, function() {
    var obj = {a: &quot;b&quot;}
    obj.self = obj
    obj.selves = [obj, obj]

    function decycle() {}
    stringify(obj, null, 2, decycle).must.eql(jsonify({
      a: &quot;b&quot;,
      selves: [null, null]
    }))
  })

  it(&quot;must throw given a decycler that returns a cycle&quot;, function() {
    var obj = {}
    obj.self = obj
    var err
    function identity(key, value) { return value }
    try { stringify(obj, null, 2, identity) } catch (ex) { err = ex }
    err.must.be.an.instanceof(TypeError)
  })

  describe(&quot;.getSerialize&quot;, function() {
    it(&quot;must stringify circular objects&quot;, function() {
      var obj = {a: &quot;b&quot;}
      obj.circularRef = obj
      obj.list = [obj, obj]

      var json = JSON.stringify(obj, stringify.getSerialize(), 2)
      json.must.eql(jsonify({
        &quot;a&quot;: &quot;b&quot;,
        &quot;circularRef&quot;: &quot;[Circular ~]&quot;,
        &quot;list&quot;: [&quot;[Circular ~]&quot;, &quot;[Circular ~]&quot;]
      }))
    })

    // This is the behavior as of Mar 3, 2015.
    // The serializer function keeps state inside the returned function and
    // so far I&#039;m not sure how to not do that. JSON.stringify&#039;s replacer is not
    // called _after_ serialization.
    xit(&quot;must return a function that could be called twice&quot;, function() {
      var obj = {name: &quot;Alice&quot;}
      obj.self = obj

      var json
      var serializer = stringify.getSerialize()

      json = JSON.stringify(obj, serializer, 2)
      json.must.eql(jsonify({name: &quot;Alice&quot;, self: &quot;[Circular ~]&quot;}))

      json = JSON.stringify(obj, serializer, 2)
      json.must.eql(jsonify({name: &quot;Alice&quot;, self: &quot;[Circular ~]&quot;}))
    })
  })
})

function bangString(key, value) {
  return typeof value == &quot;string&quot; ? value + &quot;!&quot; : value
}
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
